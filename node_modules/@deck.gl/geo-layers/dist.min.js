!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("deck"),require("h3"),require("luma")):"function"==typeof define&&define.amd?define(["deck","h3","luma"],e):"object"==typeof exports?exports.deck=e(require("deck"),require("h3"),require("luma")):t.deck=e(t.deck,t.h3,t.luma)}(window,(function(t,e,r){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=34)}([function(t,e,r){t.exports=r(51)},function(e,r){e.exports=t},function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e,r){var n=r(45),i=r(46),a=r(47);t.exports=function(t,e){return n(t)||i(t,e)||a()}},function(t,e,r){var n=r(16),i=r(42);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?i(t):e}},function(t,e,r){var n=r(44);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,r){t.exports=e},function(t,e,r){var n=r(48),i=r(49),a=r(50);t.exports=function(t){return n(t)||i(t)||a()}},function(t,e,r){var n=r(43);function i(e,r,a){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=i=Reflect.get:t.exports=i=function(t,e,r){var i=n(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(r):a.value}},i(e,r,a||e)}t.exports=i},,function(t,e,r){var n,i,a;
/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */i=[],void 0===(a="function"==typeof(n=function(){"use strict";function t(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function e(t){return!0===(t&&t.__isLong__)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var r={},n={};function i(t,e){var i,a,s;return e?(s=0<=(t>>>=0)&&t<256)&&(a=n[t])?a:(i=o(t,(0|t)<0?-1:0,!0),s&&(n[t]=i),i):(s=-128<=(t|=0)&&t<128)&&(a=r[t])?a:(i=o(t,t<0?-1:0,!1),s&&(r[t]=i),i)}function a(t,e){if(isNaN(t)||!isFinite(t))return e?p:y;if(e){if(t<0)return p;if(t>=l)return w}else{if(t<=-f)return k;if(t+1>=f)return b}return t<0?a(-t,e).neg():o(t%h|0,t/h|0,e)}function o(e,r,n){return new t(e,r,n)}t.fromInt=i,t.fromNumber=a,t.fromBits=o;var s=Math.pow;function u(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return y;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return u(t.substring(1),e,r).neg();for(var i=a(s(r,8)),o=y,c=0;c<t.length;c+=8){var h=Math.min(8,t.length-c),l=parseInt(t.substring(c,c+h),r);if(h<8){var f=a(s(r,h));o=o.mul(f).add(a(l))}else o=(o=o.mul(i)).add(a(l))}return o.unsigned=e,o}function c(e){return e instanceof t?e:"number"==typeof e?a(e):"string"==typeof e?u(e):o(e.low,e.high,e.unsigned)}t.fromString=u,t.fromValue=c;var h=4294967296,l=h*h,f=l/2,d=i(1<<24),y=i(0);t.ZERO=y;var p=i(0,!0);t.UZERO=p;var v=i(1);t.ONE=v;var g=i(1,!0);t.UONE=g;var m=i(-1);t.NEG_ONE=m;var b=o(-1,2147483647,!1);t.MAX_VALUE=b;var w=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=w;var k=o(0,-2147483648,!1);t.MIN_VALUE=k;var x=t.prototype;return x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},x.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(k)){var e=a(t),r=this.div(e),n=r.mul(e).sub(this);return r.toString(t)+n.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=a(s(t,6),this.unsigned),o=this,u="";;){var c=o.div(i),h=(o.sub(c.mul(i)).toInt()>>>0).toString(t);if((o=c).isZero())return h+u;for(;h.length<6;)h="0"+h;u=""+h+u}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(k)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},x.isZero=function(){return 0===this.high&&0===this.low},x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1==(1&this.low)},x.isEven=function(){return 0==(1&this.low)},x.equals=function(t){return e(t)||(t=c(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},x.eq=x.equals,x.notEquals=function(t){return!this.eq(t)},x.neq=x.notEquals,x.lessThan=function(t){return this.comp(t)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(t){return this.comp(t)<=0},x.lte=x.lessThanOrEqual,x.greaterThan=function(t){return this.comp(t)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(t){return this.comp(t)>=0},x.gte=x.greaterThanOrEqual,x.compare=function(t){if(e(t)||(t=c(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(k)?k:this.not().add(v)},x.neg=x.negate,x.add=function(t){e(t)||(t=c(t));var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,a=65535&this.low,s=t.high>>>16,u=65535&t.high,h=t.low>>>16,l=0,f=0,d=0,y=0;return d+=(y+=a+(65535&t.low))>>>16,f+=(d+=i+h)>>>16,l+=(f+=n+u)>>>16,l+=r+s,o((d&=65535)<<16|(y&=65535),(l&=65535)<<16|(f&=65535),this.unsigned)},x.subtract=function(t){return e(t)||(t=c(t)),this.add(t.neg())},x.sub=x.subtract,x.multiply=function(t){if(this.isZero())return y;if(e(t)||(t=c(t)),t.isZero())return y;if(this.eq(k))return t.isOdd()?k:y;if(t.eq(k))return this.isOdd()?k:y;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(d)&&t.lt(d))return a(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,s=65535&this.low,u=t.high>>>16,h=65535&t.high,l=t.low>>>16,f=65535&t.low,p=0,v=0,g=0,m=0;return g+=(m+=s*f)>>>16,v+=(g+=i*f)>>>16,g&=65535,v+=(g+=s*l)>>>16,p+=(v+=n*f)>>>16,v&=65535,p+=(v+=i*l)>>>16,v&=65535,p+=(v+=s*h)>>>16,p+=r*f+n*l+i*h+s*u,o((g&=65535)<<16|(m&=65535),(p&=65535)<<16|(v&=65535),this.unsigned)},x.mul=x.multiply,x.divide=function(t){if(e(t)||(t=c(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?p:y;var r,n,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return p;if(t.gt(this.shru(1)))return g;i=p}else{if(this.eq(k))return t.eq(v)||t.eq(m)?k:t.eq(k)?v:(r=this.shr(1).div(t).shl(1)).eq(y)?t.isNegative()?v:m:(n=this.sub(t.mul(r)),i=r.add(n.div(t)));if(t.eq(k))return this.unsigned?p:y;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=y}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),u=o<=48?1:s(2,o-48),h=a(r),l=h.mul(t);l.isNegative()||l.gt(n);)l=(h=a(r-=u,this.unsigned)).mul(t);h.isZero()&&(h=v),i=i.add(h),n=n.sub(l)}return i},x.div=x.divide,x.modulo=function(t){return e(t)||(t=c(t)),this.sub(this.div(t).mul(t))},x.mod=x.modulo,x.not=function(){return o(~this.low,~this.high,this.unsigned)},x.and=function(t){return e(t)||(t=c(t)),o(this.low&t.low,this.high&t.high,this.unsigned)},x.or=function(t){return e(t)||(t=c(t)),o(this.low|t.low,this.high|t.high,this.unsigned)},x.xor=function(t){return e(t)||(t=c(t)),o(this.low^t.low,this.high^t.high,this.unsigned)},x.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):o(0,this.low<<t-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):o(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0==(t&=63))return this;var r=this.high;return t<32?o(this.low>>>t|r<<32-t,r>>>t,this.unsigned):o(32===t?r:r>>>t-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},x.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},x.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t})?n.apply(e,i):n)||(t.exports=a)},,function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},,function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r},function(t,e){},,,,function(t,e,r){"use strict";var n=r(22);function i(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(a,this,e),this.length=this._features.length}function a(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}t.exports=i,i.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,e,this.extent,this._keys,this._values)}},function(t,e,r){"use strict";var n=r(53);function i(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(a,this,e)}function a(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function o(t){for(var e,r,n=0,i=0,a=t.length,o=a-1;i<a;o=i++)e=t[i],n+=((r=t[o]).x-e.x)*(e.y+r.y);return n}t.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,a=0,o=0,s=0,u=[];t.pos<r;){if(a<=0){var c=t.readVarint();i=7&c,a=c>>3}if(a--,1===i||2===i)o+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new n(o,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},i.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,a=0,o=1/0,s=-1/0,u=1/0,c=-1/0;t.pos<e;){if(n<=0){var h=t.readVarint();r=7&h,n=h>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=t.readSVarint())<u&&(u=a),a>c&&(c=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,u,s,c]},i.prototype.toGeoJSON=function(t,e,r){var n,a,s=this.extent*Math.pow(2,r),u=this.extent*t,c=this.extent*e,h=this.loadGeometry(),l=i.types[this.type];function f(t){for(var e=0;e<t.length;e++){var r=t[e],n=180-360*(r.y+c)/s;t[e]=[360*(r.x+u)/s-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(n=0;n<h.length;n++)d[n]=h[n][0];f(h=d);break;case 2:for(n=0;n<h.length;n++)f(h[n]);break;case 3:for(h=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],a=0;a<e;a++){var s=o(t[a]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(r&&i.push(r),r=[t[a]]):r.push(t[a]))}r&&i.push(r);return i}(h),n=0;n<h.length;n++)for(a=0;a<h[n].length;a++)f(h[n][a])}1===h.length?h=h[0]:l="Multi"+l;var y={type:"Feature",geometry:{type:l,coordinates:h},properties:this.properties};return"id"in this&&(y.id=this.id),y}},function(t,e){function r(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var o=t.apply(e,n);function s(t){r(o,i,a,s,u,"next",t)}function u(t){r(o,i,a,s,u,"throw",t)}s(void 0)}))}}},function(t,e){t.exports=r},function(t,e,r){t.exports.VectorTile=r(52),t.exports.VectorTileFeature=r(22),t.exports.VectorTileLayer=r(21)},function(t,e,r){"use strict";t.exports=i;var n=r(54);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var a="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function o(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function s(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function u(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function c(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function h(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function l(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function f(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function v(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function m(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function b(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=7&n,t(i,e,this),this.pos===a&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=m(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=m(this.buf,this.pos)+4294967296*m(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=m(this.buf,this.pos)+4294967296*w(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,a=r.buf;if(i=a[r.pos++],n=(112&i)>>4,i<128)return s(t,n,e);if(i=a[r.pos++],n|=(127&i)<<3,i<128)return s(t,n,e);if(i=a[r.pos++],n|=(127&i)<<10,i<128)return s(t,n,e);if(i=a[r.pos++],n|=(127&i)<<17,i<128)return s(t,n,e);if(i=a[r.pos++],n|=(127&i)<<24,i<128)return s(t,n,e);if(i=a[r.pos++],n|=(1&i)<<31,i<128)return s(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&a?function(t,e,r){return a.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var n="",i=e;for(;i<r;){var a,o,s,u=t[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h>r)break;1===h?u<128&&(c=u):2===h?128==(192&(a=t[i+1]))&&(c=(31&u)<<6|63&a)<=127&&(c=null):3===h?(a=t[i+1],o=t[i+2],128==(192&a)&&128==(192&o)&&((c=(15&u)<<12|(63&a)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===h&&(a=t[i+1],o=t[i+2],s=t[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&((c=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,h=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),i+=h}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==i.Bytes)return t.push(this.readVarint(e));var r=o(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==i.Bytes)return t.push(this.readSVarint());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==i.Bytes)return t.push(this.readBoolean());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==i.Bytes)return t.push(this.readFloat());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==i.Bytes)return t.push(this.readDouble());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed32());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed32());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed64());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed64());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,a=0;a<e.length;a++){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){n>56319||a+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&u(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&u(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,i.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,g,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},,,,,,,,function(t,e,r){var n=r(55),i=("undefined"==typeof window?global:window).deck||{};if(!i.LineLayer)throw new Error("@deck.gl/layers is not found");t.exports=Object.assign(i,n)},,,,,,,,function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,r){var n=r(2);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,n)}t.exports=r},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,r){var n=function(t){"use strict";var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),o=new x(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return T()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=b(o,r);if(s){if(s===c)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var h=u(t,e,r);if("normal"===h.type){if(n=r.done?"completed":"suspendedYield",h.arg===c)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(n="completed",r.method="throw",r.arg=h.arg)}}}(t,r,o),a}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var c={};function h(){}function l(){}function f(){}var d={};d[i]=function(){return this};var y=Object.getPrototypeOf,p=y&&y(y(_([])));p&&p!==e&&r.call(p,i)&&(d=p);var v=f.prototype=h.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function m(t){var e;this._invoke=function(n,i){function a(){return new Promise((function(e,a){!function e(n,i,a,o){var s=u(t[n],t,i);if("throw"!==s.type){var c=s.arg,h=c.value;return h&&"object"==typeof h&&r.call(h,"__await")?Promise.resolve(h.__await).then((function(t){e("next",t,a,o)}),(function(t){e("throw",t,a,o)})):Promise.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return e("throw",t,a,o)}))}o(s.arg)}(n,i,e,a)}))}return e=e?e.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return c;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,c;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,c):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,c)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function _(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:T}}function T(){return{value:void 0,done:!0}}return l.prototype=v.constructor=f,f.constructor=l,f[o]=l.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,o in t||(t[o]="GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},g(m.prototype),m.prototype[a]=function(){return this},t.AsyncIterator=m,t.async=function(e,r,n,i){var a=new m(s(e,r,n,i));return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(v),v[o]="Generator",v[i]=function(){return this},v.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=_,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),c},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),c}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:_(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e,r){"use strict";var n=r(21);function i(t,e,r){if(3===t){var i=new n(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}t.exports=function(t,e){this.layers=t.readFields(i,{},e)}},function(t,e,r){"use strict";function n(t,e){this.x=t,this.y=e}t.exports=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,i=r*this.x+e*this.y;return this.x=n,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this.x-e.x)-n*(this.y-e.y),a=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=i,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t}},function(t,e){e.read=function(t,e,r,n,i){var a,o,s=8*i-n-1,u=(1<<s)-1,c=u>>1,h=-7,l=r?i-1:0,f=r?-1:1,d=t[e+l];for(l+=f,a=d&(1<<-h)-1,d>>=-h,h+=s;h>0;a=256*a+t[e+l],l+=f,h-=8);for(o=a&(1<<-h)-1,a>>=-h,h+=n;h>0;o=256*o+t[e+l],l+=f,h-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),a-=c}return(d?-1:1)*o*Math.pow(2,a-n)},e.write=function(t,e,r,n,i,a){var o,s,u,c=8*a-i-1,h=(1<<c)-1,l=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,y=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+l>=1?f/u:f*Math.pow(2,1-l))*u>=2&&(o++,u/=2),o+l>=h?(s=0,o=h):o+l>=1?(s=(e*u-1)*Math.pow(2,i),o+=l):(s=e*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;t[r+d]=255&s,d+=y,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;t[r+d]=255&o,d+=y,o/=256,c-=8);t[r+d-y]|=128*p}},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"dirname",(function(){return Ji}));var i={};r.r(i),r.d(i,"decode",(function(){return eh})),r.d(i,"encode",(function(){return nh}));var a={};r.r(a),r.d(a,"decode",(function(){return ch})),r.d(a,"encode",(function(){return hh}));var o={};r.r(o),r.d(o,"decode",(function(){return lh})),r.d(o,"encode",(function(){return fh}));var s={};r.r(s),r.d(s,"decode",(function(){return dh})),r.d(s,"encode",(function(){return yh}));var u=r(3),c=r.n(u),h=r(4),l=r.n(h),f=r(6),d=r.n(f),y=r(2),p=r.n(y),v=r(10),g=r.n(v),m=r(7),b=r.n(m),w=r(1),k=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}return b()(e,t),l()(e,[{key:"getShaders",value:function(){return Object.assign({},g()(p()(e.prototype),"getShaders",this).call(this),{vs:"#define SHADER_NAME great-circle-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  if(abs(angularDist - PI) < 0.001) {\n    return (1.0 - t) * source + t * target;\n  }\n\n  float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n  float b = sin(t * angularDist) / sin(angularDist);\n  vec2 sin_source = sin(source);\n  vec2 cos_source = cos(source);\n  vec2 sin_target = sin(target);\n  vec2 cos_target = cos(target);\n\n  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n  float z = a * sin_source.y + b * sin_target.y;\n  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  uv = vec2(segmentRatio, positions.y);\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  \n  vec2 source = radians(instanceSourcePositions.xy);\n  vec2 target = radians(instanceTargetPositions.xy);\n  \n  float angularDist = getAngularDist(source, target);\n\n  vec3 currPos = vec3(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0);\n  vec3 nextPos = vec3(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0);\n\n  vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\n  vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\n\n  vec4 curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\n  vec4 next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec3 offset = vec3(\n    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\n  vColor = vec4(color.rgb, color.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",modules:[w.picking,w.project32]})}}]),e}(w.ArcLayer);k.layerName="GreatCircleLayer";var x=r(5),_=r.n(x),T=r(12),O=r.n(T),S=180/Math.PI;function M(t,e,r){var n=1<<e;return[(t[0]+r[0])/n,(t[1]+r[1])/n]}function E(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function P(t){return[E(t[0]),E(t[1])]}function L(t,e){var r=_()(e,2),n=r[0],i=r[1];switch(t){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw new Error("Invalid face")}}function A(t,e,r,n){if(0===n){1===r&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);var i=e[0];e[0]=e[1],e[1]=i}}function j(t){if("string"==typeof t){if(t.indexOf("/")>0)return t;t=function(t){var e=t.padEnd(16,"0");return O.a.fromString(e,16)}(t)}return function(t){for(var e=O.a.fromString(t,!0,10).toString(2);e.length<64;)e="0"+e;for(var r=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,r),a=i.length/2,o=O.a.fromString(n,!0,2).toString(10),s=O.a.fromString(i,!0,2).toString(4);s.length<a;)s="0"+s;return"".concat(o,"/").concat(s)}(t.toString())}function N(t){return function(t){for(var e,r,n,i,a,o,s=t.face,u=t.ij,c=t.level,h=[[0,0],[0,1],[1,1],[1,0],[0,0]],l=Math.max(1,Math.ceil(100*Math.pow(2,-c))),f=new Float64Array(4*l*2+2),d=0,y=0;y<4;y++)for(var p=h[y].slice(0),v=h[y+1],g=(v[0]-p[0])/l,m=(v[1]-p[1])/l,b=0;b<l;b++){p[0]+=g,p[1]+=m;var w=L(s,P(M(u,c,p))),k=(e=w,r=void 0,n=void 0,i=void 0,a=void 0,o=void 0,r=_()(e,3),n=r[0],i=r[1],a=r[2],o=Math.atan2(a,Math.sqrt(n*n+i*i)),[Math.atan2(i,n)*S,o*S]);f[d++]=k[0],f[d++]=k[1]}return f[d++]=f[0],f[d++]=f[1],f}(function(t){for(var e,r=t.split("/"),n=parseInt(r[0],10),i=r[1],a=i.length,o=[0,0],s=a-1;s>=0;s--){e=a-s;var u=i[s],c=0,h=0;"1"===u?h=1:"2"===u?(c=1,h=1):"3"===u&&(c=1);var l=Math.pow(2,e-1);A(l,o,c,h),o[0]+=l*c,o[1]+=l*h}if(n%2==1){var f=o[0];o[0]=o[1],o[1]=f}return{face:n,ij:o,level:e}}(j(t)))}var I=Object.assign({getS2Token:{type:"accessor",value:function(t){return t.token}}},w.PolygonLayer.defaultProps),R=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}return b()(e,t),l()(e,[{key:"renderLayers",value:function(){var t=this.props,e=t.data,r=t.getS2Token,n=this.props,i=n.elevationScale,a=n.extruded,o=n.wireframe,s=n.filled,u=n.stroked,c=n.lineWidthUnits,h=n.lineWidthScale,l=n.lineWidthMinPixels,f=n.lineWidthMaxPixels,d=n.lineJointRounded,y=n.lineMiterLimit,p=n.lineDashJustified,v=n.getElevation,g=n.getFillColor,m=n.getLineColor,b=n.getLineWidth,k=n.getLineDashArray,x=this.props,_=x.updateTriggers,T=x.material;return new(this.getSubLayerClass("cell",w.PolygonLayer))({filled:s,wireframe:o,extruded:a,elevationScale:i,stroked:u,lineWidthUnits:c,lineWidthScale:h,lineWidthMinPixels:l,lineWidthMaxPixels:f,lineJointRounded:d,lineMiterLimit:y,lineDashJustified:p,material:T,getElevation:v,getFillColor:g,getLineColor:m,getLineWidth:b,getLineDashArray:k},this.getSubLayerProps({id:"cell",updateTriggers:{getElevation:_.getElevation,getFillColor:_.getFillColor,getLineColor:_.getLineColor,getLineWidth:_.getLineWidth,getLineDashArray:_.getLineDashArray}}),{data:e,_normalize:!1,positionFormat:"XY",getPolygon:function(t,e){return N(r(t,e))}})}}]),e}(w.CompositeLayer);R.layerName="S2Layer",R.defaultProps=I;var C=function(){function t(e){var r=e.x,n=e.y,i=e.z,a=e.onTileLoad,o=e.onTileError;c()(this,t),this.x=r,this.y=n,this.z=i,this.isVisible=!1,this.parent=null,this.children=[],this.content=null,this._isLoaded=!1,this.onTileLoad=a,this.onTileError=o}return l()(t,[{key:"loadData",value:function(t){var e=this,r=this.x,n=this.y,i=this.z,a=this.bbox;t&&(this._loader=Promise.resolve(t({x:r,y:n,z:i,bbox:a})).then((function(t){return e.content=t,e._isLoaded=!0,e.onTileLoad(e),t})).catch((function(t){e._isLoaded=!0,e.onTileError(t)})))}},{key:"data",get:function(){return this._isLoaded?this.content:this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}},{key:"byteLength",get:function(){var t=this.content?this.content.byteLength:0;return Number.isFinite(t)||w.log.error("byteLength not defined in tile data")(),t}}]),t}(),D=r(9),B=r.n(D);function V(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function U(t,e,r){return e&&F(t.prototype,e),r&&F(t,r),t}function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t){return(z="function"==typeof Symbol&&"symbol"===q(Symbol.iterator)?function(t){return q(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":q(t)})(t)}function G(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function W(t,e){return!e||"object"!==z(e)&&"function"!=typeof e?G(t):e}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Z(t,e){return(Z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function K(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Z(t,e)}function Y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Q="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function J(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var X,$;X=new Q(4),Q!=Float32Array&&(X[0]=0,X[1]=0,X[2]=0,X[3]=0),$=X;function tt(t,e){var r=J([],e,t);return function(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r}(r,r,1/r[3]),r}function et(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],d=e[11],y=e[12],p=e[13],v=e[14],g=e[15],m=r*s-n*o,b=r*u-i*o,w=r*c-a*o,k=n*u-i*s,x=n*c-a*s,_=i*c-a*u,T=h*p-l*y,O=h*v-f*y,S=h*g-d*y,M=l*v-f*p,E=l*g-d*p,P=f*g-d*v,L=m*P-b*E+w*M+k*S-x*O+_*T;return L?(L=1/L,t[0]=(s*P-u*E+c*M)*L,t[1]=(i*E-n*P-a*M)*L,t[2]=(p*_-v*x+g*k)*L,t[3]=(f*x-l*_-d*k)*L,t[4]=(u*S-o*P-c*O)*L,t[5]=(r*P-i*S+a*O)*L,t[6]=(v*w-y*_-g*b)*L,t[7]=(h*_-f*w+d*b)*L,t[8]=(o*E-s*S+c*T)*L,t[9]=(n*S-r*E-a*T)*L,t[10]=(y*x-p*w+g*m)*L,t[11]=(l*w-h*x-d*m)*L,t[12]=(s*O-o*M-u*T)*L,t[13]=(r*M-n*O+i*T)*L,t[14]=(p*b-y*k-v*m)*L,t[15]=(h*k-l*b+f*m)*L,t):null}function rt(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],y=e[11],p=e[12],v=e[13],g=e[14],m=e[15],b=r[0],w=r[1],k=r[2],x=r[3];return t[0]=b*n+w*s+k*l+x*p,t[1]=b*i+w*u+k*f+x*v,t[2]=b*a+w*c+k*d+x*g,t[3]=b*o+w*h+k*y+x*m,b=r[4],w=r[5],k=r[6],x=r[7],t[4]=b*n+w*s+k*l+x*p,t[5]=b*i+w*u+k*f+x*v,t[6]=b*a+w*c+k*d+x*g,t[7]=b*o+w*h+k*y+x*m,b=r[8],w=r[9],k=r[10],x=r[11],t[8]=b*n+w*s+k*l+x*p,t[9]=b*i+w*u+k*f+x*v,t[10]=b*a+w*c+k*d+x*g,t[11]=b*o+w*h+k*y+x*m,b=r[12],w=r[13],k=r[14],x=r[15],t[12]=b*n+w*s+k*l+x*p,t[13]=b*i+w*u+k*f+x*v,t[14]=b*a+w*c+k*d+x*g,t[15]=b*o+w*h+k*y+x*m,t}function nt(t,e,r){var n,i,a,o,s,u,c,h,l,f,d,y,p=r[0],v=r[1],g=r[2];return e===t?(t[12]=e[0]*p+e[4]*v+e[8]*g+e[12],t[13]=e[1]*p+e[5]*v+e[9]*g+e[13],t[14]=e[2]*p+e[6]*v+e[10]*g+e[14],t[15]=e[3]*p+e[7]*v+e[11]*g+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],y=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=f,t[10]=d,t[11]=y,t[12]=n*p+s*v+l*g+e[12],t[13]=i*p+u*v+f*g+e[13],t[14]=a*p+c*v+d*g+e[14],t[15]=o*p+h*v+y*g+e[15]),t}function it(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function at(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+c*n,t[5]=o*i+h*n,t[6]=s*i+l*n,t[7]=u*i+f*n,t[8]=c*i-a*n,t[9]=h*i-o*n,t[10]=l*i-s*n,t[11]=f*i-u*n,t}function ot(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],c=e[4],h=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+c*n,t[1]=o*i+h*n,t[2]=s*i+l*n,t[3]=u*i+f*n,t[4]=c*i-a*n,t[5]=h*i-o*n,t[6]=l*i-s*n,t[7]=f*i-u*n,t}function st(t,e){var r=e[0],n=e[1],i=e[2],a=e[4],o=e[5],s=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(u,c,h),t}function ut(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}function ct(t,e,r,n){var i,a,o,s,u,c,h,l,f,d,y=e[0],p=e[1],v=e[2],g=n[0],m=n[1],b=n[2],w=r[0],k=r[1],x=r[2];return Math.abs(y-w)<1e-6&&Math.abs(p-k)<1e-6&&Math.abs(v-x)<1e-6?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=y-w,l=p-k,f=v-x,i=m*(f*=d=1/Math.hypot(h,l,f))-b*(l*=d),a=b*(h*=d)-g*f,o=g*l-m*h,(d=Math.hypot(i,a,o))?(i*=d=1/d,a*=d,o*=d):(i=0,a=0,o=0),s=l*o-f*a,u=f*i-h*o,c=h*a-l*i,(d=Math.hypot(s,u,c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=a,t[5]=u,t[6]=l,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*y+a*p+o*v),t[13]=-(s*y+u*p+c*v),t[14]=-(h*y+l*p+f*v),t[15]=1,t)}function ht(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],h=t[8],l=t[9],f=t[10],d=t[11],y=t[12],p=t[13],v=t[14],g=t[15],m=e[0],b=e[1],w=e[2],k=e[3],x=e[4],_=e[5],T=e[6],O=e[7],S=e[8],M=e[9],E=e[10],P=e[11],L=e[12],A=e[13],j=e[14],N=e[15];return Math.abs(r-m)<=1e-6*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-b)<=1e-6*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-w)<=1e-6*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(a-k)<=1e-6*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(o-x)<=1e-6*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-_)<=1e-6*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(u-T)<=1e-6*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-O)<=1e-6*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(h-S)<=1e-6*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(l-M)<=1e-6*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(f-E)<=1e-6*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(d-P)<=1e-6*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(y-L)<=1e-6*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(p-A)<=1e-6*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(v-j)<=1e-6*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(g-N)<=1e-6*Math.max(1,Math.abs(g),Math.abs(N))}function lt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function ft(t,e,r,n){var i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t}!function(){var t=function(){var t=new Q(2);return Q!=Float32Array&&(t[0]=0,t[1]=0),t}()}();function dt(t,e,r){var n=new Q(3);return n[0]=t,n[1]=e,n[2]=r,n}function yt(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function pt(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,t[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,t}function vt(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t}!function(){var t=function(){var t=new Q(3);return Q!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}()}();function gt(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var mt=Math.PI,bt=mt/4,wt=mt/180,kt=180/mt;function xt(t){return Math.pow(2,t)}function _t(t){var e=Y(t,2),r=e[0],n=e[1];gt(Number.isFinite(r)),gt(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=n*wt;return[512*(r*wt+mt)/(2*mt),512*(mt+Math.log(Math.tan(bt+.5*i)))/(2*mt)]}function Tt(t){var e=Y(t,2),r=e[0],n=e[1],i=r/512*(2*mt)-mt,a=2*(Math.atan(Math.exp(n/512*(2*mt)-mt))-bt);return[i*kt,a*kt]}function Ot(t){var e=t.latitude,r=t.longitude,n=t.highPrecision,i=void 0!==n&&n;gt(Number.isFinite(e)&&Number.isFinite(r));var a={},o=Math.cos(e*wt),s=512/360/o,u=512/4003e4/o;if(a.unitsPerMeter=[u,u,u],a.metersPerUnit=[1/u,1/u,1/u],a.unitsPerDegree=[512/360,s,u],a.degreesPerUnit=[.703125,1/s,1/u],i){var c=wt*Math.tan(e*wt)/o,h=512/360*c/2,l=512/4003e4*c,f=l/s*u;a.unitsPerDegree2=[0,h,l],a.unitsPerMeter2=[f,0,f]}return a}function St(t){var e=t.height,r=t.pitch,n=t.bearing,i=t.altitude,a=t.scale,o=t.center,s=void 0===o?null:o,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return nt(u,u,[0,0,-i]),at(u,u,-r*wt),ot(u,u,n*wt),it(u,u,[a/=e,a,a]),s&&nt(u,u,function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}([],s)),u}function Mt(t){var e=t.width,r=t.height,n=t.pitch,i=function(t){var e=t.width,r=t.height,n=t.altitude,i=void 0===n?1.5:n,a=t.pitch,o=void 0===a?0:a,s=t.nearZMultiplier,u=void 0===s?1:s,c=t.farZMultiplier,h=void 0===c?1:c,l=o*wt,f=Math.atan(.5/i),d=Math.sin(f)*i/Math.sin(Math.min(Math.max(Math.PI/2-l-f,.01),Math.PI-.01));return{fov:2*f,aspect:e/r,focalDistance:i,near:u,far:(Math.sin(l)*d+i)*h}}({width:e,height:r,altitude:t.altitude,pitch:n,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier});return ut([],i.fov,i.aspect,i.near,i.far)}function Et(t,e){var r=Y(t,3),n=r[0],i=r[1],a=r[2],o=void 0===a?0:a;return gt(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),tt(e,[n,i,o,1])}function Pt(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Y(t,3),i=n[0],a=n[1],o=n[2];if(gt(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var s=tt(e,[i,a,o,1]);return s}var u=tt(e,[i,a,0,1]),c=tt(e,[i,a,1,1]),h=u[2],l=c[2],f=h===l?0:((r||0)-h)/(l-h);return ft([],u,c,f)}var Lt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function At(t){var e=t.width,r=t.height,n=t.bounds,i=t.minExtent,a=void 0===i?0:i,o=t.maxZoom,s=void 0===o?24:o,u=t.padding,c=void 0===u?0:u,h=t.offset,l=void 0===h?[0,0]:h,f=Y(n,2),d=Y(f[0],2),y=d[0],p=d[1],v=Y(f[1],2),g=v[0],m=v[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else gt(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var b=new jt({width:e,height:r,longitude:0,latitude:0,zoom:0}),w=b.project([y,m]),k=b.project([g,p]),x=[Math.max(Math.abs(k[0]-w[0]),a),Math.max(Math.abs(k[1]-w[1]),a)],_=[e-c.left-c.right-2*Math.abs(l[0]),r-c.top-c.bottom-2*Math.abs(l[1])];gt(_[0]>0&&_[1]>0);var T=_[0]/x[0],O=_[1]/x[1],S=(c.right-c.left)/2/T,M=(c.bottom-c.top)/2/O,E=[(k[0]+w[0])/2+S,(k[1]+w[1])/2+M],P=b.unproject(E),L=Math.min(s,b.zoom+Math.log2(Math.abs(Math.min(T,O))));return gt(Number.isFinite(L)),{longitude:P[0],latitude:P[1],zoom:L}}var jt=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.width,i=r.height,a=r.latitude,o=void 0===a?0:a,s=r.longitude,u=void 0===s?0:s,c=r.zoom,h=void 0===c?0:c,l=r.pitch,f=void 0===l?0:l,d=r.bearing,y=void 0===d?0:d,p=r.altitude,v=void 0===p?1.5:p,g=r.nearZMultiplier,m=void 0===g?.02:g,b=r.farZMultiplier,w=void 0===b?1.01:b;V(this,e),n=n||1,i=i||1;var k=xt(h);v=Math.max(.75,v);var x=_t([u,o]);x[2]=0;var _=Mt({width:n,height:i,pitch:f,bearing:y,altitude:v,nearZMultiplier:m,farZMultiplier:w}),T=St({height:i,scale:k,center:x,pitch:f,bearing:y,altitude:v});return(t=W(this,H(e).call(this,{width:n,height:i,scale:k,viewMatrix:T,projectionMatrix:_}))).latitude=o,t.longitude=u,t.zoom=h,t.pitch=f,t.bearing=y,t.altitude=v,t.center=x,t.unitsPerMeter=Ot(G(t)).unitsPerMeter[2],Object.freeze(G(t)),t}return K(e,t),U(e,[{key:"projectFlat",value:function(t){return _t(t)}},{key:"unprojectFlat",value:function(t){return Tt(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,r=Pt(t.pos,this.pixelUnprojectionMatrix),n=lt([],_t(e),function(t,e){return t[0]=-e[0],t[1]=-e[1],t}([],r));return Tt(lt([],this.center,n),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,r=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}},{key:"fitBounds",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,i=this.height,a=At(Object.assign({width:n,height:i,bounds:t},r)),o=a.longitude,s=a.latitude,u=a.zoom;return new e({width:n,height:i,longitude:o,latitude:s,zoom:u})}}]),e}(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.width,n=e.height,i=e.scale,a=e.viewMatrix,o=void 0===a?Lt:a,s=e.projectionMatrix,u=void 0===s?Lt:s;V(this,t),this.width=r||1,this.height=n||1,this.scale=i,this.unitsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=u;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];rt(c,c,this.projectionMatrix),rt(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];it(h,h,[this.width/2,-this.height/2,1]),nt(h,h,[1,-1,0]),rt(h,h,this.viewProjectionMatrix);var l=et([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],h);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=h,this.pixelUnprojectionMatrix=l,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return U(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&ht(e.projectionMatrix,this.projectionMatrix)&&ht(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,i=this.projectPosition(t),a=Et(i,this.pixelProjectionMatrix),o=Y(a,2),s=o[0],u=o[1],c=n?u:this.height-u;return 2===t.length?[s,c]:[s,c,a[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,i=e.targetZ,a=Y(t,3),o=a[0],s=a[1],u=a[2],c=n?s:this.height-s,h=i&&i*this.unitsPerMeter,l=Pt([o,c,u],this.pixelUnprojectionMatrix,h),f=this.unprojectPosition(l),d=Y(f,3),y=d[0],p=d[1],v=d[2];return Number.isFinite(u)?[y,p,v]:Number.isFinite(i)?[y,p,i]:[y,p]}},{key:"projectPosition",value:function(t){var e=Y(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.unitsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=Y(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.unitsPerMeter]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}}]),t}());var Nt={type:"url",value:"",validate:function(t){return"string"==typeof t||Array.isArray(t)&&t.every((function(t){return"string"==typeof t}))},equals:function(t,e){if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}};function It(t,e){if(!t||!t.length)return null;Array.isArray(t)&&(t=t[Math.abs(e.x+e.y)%t.length]);return t.replace(/\{ *([\w_-]+) *\}/g,(function(t,r){return e[r]}))}function Rt(t,e){var r;if(e&&2===e.length){var n=_()(e,2),i={targetZ:n[0]},a={targetZ:n[1]};r=[t.unproject([0,0],i),t.unproject([t.width,0],i),t.unproject([0,t.height],i),t.unproject([t.width,t.height],i),t.unproject([0,0],a),t.unproject([t.width,0],a),t.unproject([0,t.height],a),t.unproject([t.width,t.height],a)]}else r=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])];return[Math.min.apply(Math,B()(r.map((function(t){return t[0]})))),Math.min.apply(Math,B()(r.map((function(t){return t[1]})))),Math.max.apply(Math,B()(r.map((function(t){return t[0]})))),Math.max.apply(Math,B()(r.map((function(t){return t[1]}))))]}function Ct(t,e){var r=_t(t),n=_()(r,2),i=n[0],a=n[1];return[i*=e/512,a=(1-a/512)*e]}function Dt(t,e){var r=_()(t,2);return[r[0]*e/512,r[1]*e/512]}function Bt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512;return 512*Math.pow(2,t)/e}function Vt(t,e,r){var n=Bt(r),i=t/n*360-180,a=Math.PI-2*Math.PI*e/n;return[i,180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)))]}function Ft(t,e,r,n){var i=Bt(r,n);return[t/i*512,e/i*512]}function Ut(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:512;if(t.isGeospatial){var a=Vt(e,r,n),o=_()(a,2),s=o[0],u=o[1],c=Vt(e+1,r+1,n),h=_()(c,2),l=h[0],f=h[1];return{west:s,north:u,east:l,south:f}}var d=Ft(e,r,n,i),y=_()(d,2),p=y[0],v=y[1],g=Ft(e+1,r+1,n,i),m=_()(g,2),b=m[0],w=m[1];return{left:p,top:v,right:b,bottom:w}}function qt(t,e,r){for(var n=Rt(t),i=Bt(e,r),a=Dt([n[0],n[1]],i),o=_()(a,2),s=o[0],u=o[1],c=Dt([n[2],n[3]],i),h=_()(c,2),l=h[0],f=h[1],d=[],y=Math.floor(s);y<l;y++)for(var p=Math.floor(u);p<f;p++)d.push({x:y,y:p,z:e});return d}function zt(t,e,r){var n=Rt(t,r),i=Bt(e),a=Ct([n[0],n[3]],i),o=_()(a,2),s=o[0],u=o[1],c=Ct([n[2],n[1]],i),h=_()(c,2),l=h[0],f=h[1],d=[];s=Math.floor(s),l=Math.min(s+i,l),u=Math.max(0,Math.floor(u)),f=Math.min(i,f);for(var y=s;y<l;y++)for(var p=u;p<f;p++){var v=y-Math.floor(y/i)*i;d.push({x:v,y:p,z:e})}return d}var Gt=function(){function t(e){var r=this;c()(this,t),this.opts=e,this._getTileData=e.getTileData,this.onTileError=e.onTileError,this.onTileLoad=function(t){e.onTileLoad(t),r.opts.maxCacheByteSize&&(r._cacheByteSize+=t.byteLength,r._resizeCache())},this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this.setOptions(e)}return l()(t,[{key:"setOptions",value:function(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}},{key:"update",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.zRange;if(t!==this._viewport){this._viewport=t;var i=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n});this._selectedTiles=i.map((function(t){return e._getTile(t,!0)})),this._dirty&&this._rebuildTree()}var a=this.updateTileStates();return this._dirty&&this._resizeCache(),a&&this._frameNumber++,this._frameNumber}},{key:"getTileIndices",value:function(t){return function(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:512,a=Math.ceil(t.zoom);return Number.isFinite(r)&&a<r?[]:(Number.isFinite(e)&&a>e&&(a=e),t.isGeospatial?zt(t,a,n):qt(t,a,i))}(t.viewport,t.maxZoom,t.minZoom,t.zRange,this.opts.tileSize)}},{key:"getTileMetadata",value:function(t){var e=t.x,r=t.y,n=t.z;return{bbox:Ut(this._viewport,e,r,n,this.opts.tileSize)}}},{key:"getParentIndex",value:function(t){return t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),t.z-=1,t}},{key:"updateTileStates",value:function(){this._updateTileStates(this.selectedTiles);var t=!1,e=!0,r=!1,n=void 0;try{for(var i,a=this._cache.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value,s=Boolean(1&o.state);o.isVisible!==s&&(t=!0,o.isVisible=s)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}return t}},{key:"_rebuildTree",value:function(){var t=this._cache,e=!0,r=!1,n=void 0;try{for(var i,a=t.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.parent=null,o.children.length=0}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}var s=!0,u=!1,c=void 0;try{for(var h,l=t.values()[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var f=h.value,d=this._getNearestAncestor(f.x,f.y,f.z);f.parent=d,d&&d.children.push(f)}}catch(t){u=!0,c=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw c}}}},{key:"_updateTileStates",value:function(t){var e=this._cache,r=this.opts.refinementStrategy||"best-available",n=!0,i=!1,a=void 0;try{for(var o,s=e.values()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){o.value.state=0}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}var u=!0,c=!1,h=void 0;try{for(var l,f=t[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){l.value.state=5}}catch(t){c=!0,h=t}finally{try{u||null==f.return||f.return()}finally{if(c)throw h}}if("never"!==r){var d=!0,y=!1,p=void 0;try{for(var v,g=t[Symbol.iterator]();!(d=(v=g.next()).done);d=!0){Ht(v.value,r)}}catch(t){y=!0,p=t}finally{try{d||null==g.return||g.return()}finally{if(y)throw p}}var m=!0,b=!1,w=void 0;try{for(var k,x=t[Symbol.iterator]();!(m=(k=x.next()).done);m=!0){var _=k.value;Wt(_)&&Zt(_)}}catch(t){b=!0,w=t}finally{try{m||null==x.return||x.return()}finally{if(b)throw w}}}}},{key:"_resizeCache",value:function(){var t=this._cache,e=this.opts,r=e.maxCacheSize||(e.maxCacheByteSize?1/0:5*this.selectedTiles.length),n=e.maxCacheByteSize||1/0;if(t.size>r||this._cacheByteSize>n){var i=!0,a=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=_()(s.value,2),h=c[0],l=c[1];if(l.isVisible||(this._cacheByteSize-=e.maxCacheByteSize?l.byteLength:0,t.delete(h)),t.size<=r&&this._cacheByteSize<=n)break}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((function(t,e){return t.z-e.z})),this._dirty=!1)}},{key:"_getTile",value:function(t,e){var r=t.x,n=t.y,i=t.z,a="".concat(r,",").concat(n,",").concat(i),o=this._cache.get(a);return!o&&e&&(o=new C({x:r,y:n,z:i,onTileLoad:this.onTileLoad,onTileError:this.onTileError}),Object.assign(o,this.getTileMetadata(o)),o.loadData(this._getTileData),this._cache.set(a,o),this._dirty=!0),o}},{key:"_getNearestAncestor",value:function(t,e,r){for(var n=this._minZoom,i=void 0===n?0:n,a={x:t,y:e,z:r};a.z>i;){a=this.getParentIndex(a);var o=this._getTile(a);if(o)return o}return null}},{key:"tiles",get:function(){return this._tiles}},{key:"selectedTiles",get:function(){return this._selectedTiles}},{key:"isLoaded",get:function(){return this._selectedTiles.every((function(t){return t.isLoaded}))}}]),t}();function Wt(t){for(var e=t;e;){if(!1&e.state)return!0;if(e.isLoaded)return!1;e=e.parent}return!0}function Ht(t,e){for(var r,n=3;r=t.parent;){if(t.isLoaded&&(n=4,"best-available"===e))return;r.state=Math.max(r.state,n),t=r}}function Zt(t){var e=!0,r=!1,n=void 0;try{for(var i,a=t.children[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.state=Math.max(o.state,3),o.isLoaded||Zt(o)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}}var Kt={data:[],dataComparator:Nt.equals,renderSubLayers:{type:"function",value:function(t){return new w.GeoJsonLayer(t)},compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:function(t){},compare:!1},onTileError:{type:"function",value:function(t){return console.error(t)},compare:!1},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null},Yt=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}return b()(e,t),l()(e,[{key:"initializeState",value:function(){this.state={tiles:[],isLoaded:!1}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,r=(t.oldProps,t.context,t.changeFlags),n=this.state.tileset,i=!n||r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getTileData);if(i){var a=e.maxZoom,o=e.minZoom,s=e.tileSize,u=e.maxCacheSize,c=e.maxCacheByteSize,h=e.refinementStrategy;n=new Gt({getTileData:this.getTileData.bind(this),maxCacheSize:u,maxCacheByteSize:c,maxZoom:a,minZoom:o,tileSize:s,refinementStrategy:h,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this)}),this.setState({tileset:n})}else r.propsChanged&&(n.setOptions(e),this.state.tileset.tiles.forEach((function(t){t.layers=null})));(i||r.viewportChanged)&&this._updateTileset()}},{key:"_updateTileset",value:function(){var t=this.state.tileset,e=this.props,r=e.onViewportLoad,n=e.zRange,i=t.update(this.context.viewport,{zRange:n}),a=t.isLoaded,o=this.state.isLoaded!==a,s=this.state.frameNumber!==i;a&&r&&(o||s)&&r(t.selectedTiles.map((function(t){return t.data}))),s&&this.setState({frameNumber:i}),this.state.isLoaded=a}},{key:"_onTileLoad",value:function(t){var e=this.getCurrentLayer();e.props.onTileLoad(t),e._updateTileset()}},{key:"_onTileError",value:function(t){var e=this.getCurrentLayer();e.props.onTileError(t),e._updateTileset()}},{key:"getTileData",value:function(t){var e=this.props,r=e.getTileData,n=e.fetch,i=e.data;return t.url=It(i,t),r?r(t):t.url?n(t.url,{layer:this}):null}},{key:"renderSubLayers",value:function(t){return this.props.renderSubLayers(t)}},{key:"getPickingInfo",value:function(t){var e=t.info,r=t.sourceLayer;return e.sourceLayer=r,e.tile=r.props.tile,e}},{key:"renderLayers",value:function(){var t=this,e=this.props.visible;return this.state.tileset.tiles.map((function(r){var n=e&&r.isVisible;if(r.layers)r.layers[0]&&r.layers[0].props.visible!==n&&(r.layers=r.layers.map((function(t){return t.clone({visible:n})})));else{var i=t.renderSubLayers(Object.assign({},t.props,{id:"".concat(t.id,"-").concat(r.x,"-").concat(r.y,"-").concat(r.z),data:r.data,visible:n,_offset:0,tile:r}));r.layers=Object(w._flatten)(i,Boolean)}return r.layers}))}},{key:"isLoaded",get:function(){return this.state.tileset.selectedTiles.every((function(t){return t.layers&&t.layers.every((function(t){return t.isLoaded}))}))}}]),e}(w.CompositeLayer);Yt.layerName="TileLayer",Yt.defaultProps=Kt;var Qt=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}return b()(e,t),l()(e,[{key:"getShaders",value:function(){var t=g()(p()(e.prototype),"getShaders",this).call(this);return t.inject={"vs:#decl":"uniform float trailLength;\nattribute float instanceTimestamps;\nattribute float instanceNextTimestamps;\nvarying float vTime;\n","vs:#main-end":"vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform float trailLength;\nuniform float currentTime;\nvarying float vTime;\n","fs:#main-start":"if(vTime > currentTime || vTime < currentTime - trailLength) {\n  discard;\n}\n","fs:DECKGL_FILTER_COLOR":"color.a *= 1.0 - (currentTime - vTime) / trailLength;"},t}},{key:"initializeState",value:function(t){g()(p()(e.prototype),"initializeState",this).call(this,t),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}},{key:"draw",value:function(t){var r=this.props,n=r.trailLength,i=r.currentTime;t.uniforms=Object.assign({},t.uniforms,{trailLength:n,currentTime:i}),g()(p()(e.prototype),"draw",this).call(this,t)}}]),e}(w.PathLayer);Qt.layerName="TripsLayer",Qt.defaultProps={trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:null}};var Jt=r(8),Xt=Object.assign({getHexagons:{type:"accessor",value:function(t){return t.hexagons}}},w.PolygonLayer.defaultProps),$t=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}return b()(e,t),l()(e,[{key:"updateState",value:function(t){var e=t.props,r=(t.oldProps,t.changeFlags);if(r.dataChanged||r.updateTriggers&&r.updateTriggers.getHexagons){var n=e.data,i=e.getHexagons,a=[],o=Object(w.createIterable)(n),s=o.iterable,u=o.objectInfo,c=!0,h=!1,l=void 0;try{for(var f,d=s[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value;u.index++;var p=i(y,u),v=Object(Jt.h3SetToMultiPolygon)(p,!0),g=!0,m=!1,b=void 0;try{for(var k,x=v[Symbol.iterator]();!(g=(k=x.next()).done);g=!0){var _=k.value;a.push(this.getSubLayerRow({polygon:_},y,u.index))}}catch(t){m=!0,b=t}finally{try{g||null==x.return||x.return()}finally{if(m)throw b}}}}catch(t){h=!0,l=t}finally{try{c||null==d.return||d.return()}finally{if(h)throw l}}this.setState({polygons:a})}}},{key:"renderLayers",value:function(){var t=this.props,e=t.elevationScale,r=t.extruded,n=t.wireframe,i=t.filled,a=t.stroked,o=t.lineWidthScale,s=t.lineWidthMinPixels,u=t.lineWidthMaxPixels,c=t.lineJointRounded,h=t.lineMiterLimit,l=t.lineDashJustified,f=t.material,d=t.getFillColor,y=t.getLineColor,p=t.getLineWidth,v=t.getLineDashArray,g=t.getElevation,m=t.updateTriggers;return new(this.getSubLayerClass("cluster-region",w.PolygonLayer))({filled:i,wireframe:n,extruded:r,elevationScale:e,stroked:a,lineWidthScale:o,lineWidthMinPixels:s,lineWidthMaxPixels:u,lineJointRounded:c,lineMiterLimit:h,lineDashJustified:l,material:f,getFillColor:this.getSubLayerAccessor(d),getLineColor:this.getSubLayerAccessor(y),getLineWidth:this.getSubLayerAccessor(p),getLineDashArray:this.getSubLayerAccessor(v),getElevation:this.getSubLayerAccessor(g)},this.getSubLayerProps({id:"cluster-region",updateTriggers:m}),{data:this.state.polygons,getPolygon:function(t){return t.polygon}})}}]),e}(w.CompositeLayer);$t.defaultProps=Xt,$t.layerName="H3ClusterLayer";var te=r(16),ee=r.n(te);function re(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ie(t,e,r){return e&&ne(t.prototype,e),r&&ne(t,r),t}function ae(t){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function oe(t,e){return!e||"object"!==ae(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function se(t){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ue(t,e){return(ue=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ce(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ue(t,e)}function he(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function le(t,e,r){return(le=he()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&ue(i,r.prototype),i}).apply(null,arguments)}function fe(t){var e="function"==typeof Map?new Map:void 0;return(fe=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return le(t,arguments,se(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ue(n,t)})(t)}function de(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ye(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}var pe=1/Math.PI*180,ve=1/180*Math.PI,ge={};function me(t){return Math.round(t/ge.EPSILON)*ge.EPSILON}function be(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.precision,n=void 0===r?ge.precision||4:r;return t=me(t),"".concat(parseFloat(t.toPrecision(n)))}function we(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function ke(t,e,r){if(we(t)){r=r||((i=t).clone?i.clone():new Array(i.length));for(var n=0;n<r.length&&n<t.length;++n)r[n]=e(t[n],n,r);return r}var i;return e(t)}function xe(t){return function(t,e){return ke(t,(function(t){return t*ve}),e)}(t)}function _e(t){return Te(t)}function Te(t,e){return ke(t,(function(t){return t*pe}),e)}function Oe(t,e,r){return ke(t,(function(t){return Math.max(e,Math.min(r,t))}))}function Se(t,e,r){return we(t)?t.map((function(t,n){return Se(t,e[n],r)})):r*e+(1-r)*t}function Me(t,e,r){var n=ge.EPSILON;r&&(ge.EPSILON=r);try{if(t===e)return!0;if(we(t)&&we(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!Me(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=ge.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{ge.EPSILON=n}}ge.EPSILON=1e-12,ge.debug=!1,ge.precision=4,ge.printTypes=!1,ge.printDegrees=!1,ge.printRowMajor=!0;var Ee=function(t){function e(){return re(this,e),oe(this,se(e).apply(this,arguments))}return ce(e,t),ie(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}},{key:"to",value:function(t){return t===this?this:we(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(ge)}},{key:"formatString",value:function(t){for(var e="",r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+be(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Me(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,r){void 0===r&&(r=e,e=t,t=this);for(var n=0;n<this.ELEMENTS;++n){var i=t[n];this[n]=i+r*(e[n]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]+=a[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]-=a[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(ge.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"elements",get:function(){return this}}]),e}(fe(Array));function Pe(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Le(t,e,r){if(ge.debug&&!function(t,e){if(t.length!==e)return!1;for(var r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(""|r," some fields set to invalid numbers'"));return t}var Ae={};function je(t,e){Ae[t]||(Ae[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}var Ne=function(t){function e(){return re(this,e),oe(this,se(e).apply(this,arguments))}return ce(e,t),ie(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-t[r];e+=n*n}return Pe(e)}},{key:"dot",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Pe(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]*=a[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]/=a[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return ye(t>=0&&t<this.ELEMENTS,"index is out of range"),Pe(this[t])}},{key:"setComponent",value:function(t,e){return ye(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Pe(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Pe(t)}}]),e}(Ee),Ie="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function Re(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function Ce(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});!function(){var t=function(){var t=new Ie(2);return Ie!=Float32Array&&(t[0]=0,t[1]=0),t}()}();function De(t,e,r){var n=e[0],i=e[1],a=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/a,t[1]=(r[1]*n+r[5]*i)/a,t}function Be(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a||1;return t[0]=(r[0]*n+r[4]*i+r[8]*a)/o,t[1]=(r[1]*n+r[5]*i+r[9]*a)/o,t[2]=(r[2]*n+r[6]*i+r[10]*a)/o,t}var Ve=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return re(this,e),t=oe(this,se(e).call(this,2)),we(r)&&1===arguments.length?t.copy(r):(ge.debug&&(Pe(r),Pe(n)),t[0]=r,t[1]=n),t}return ce(e,t),ie(e,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this.check()}},{key:"fromObject",value:function(t){return ge.debug&&(Pe(t.x),Pe(t.y)),this[0]=t.x,this[1]=t.y,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return Ce(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return De(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return Re(this,this,t),this.check()}},{key:"transformByMatrix2x3",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5]}(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i}(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 2}}]),e}(Ne);function Fe(){var t=new Ie(3);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ue(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function qe(t,e,r){var n=new Ie(3);return n[0]=t,n[1]=e,n[2]=r,n}function ze(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function Ge(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function We(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t}function He(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,t[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,t}function Ze(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t}var Ke=Ue,Ye=(function(){var t=Fe()}(),[0,0,0]),Qe=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return re(this,e),t=oe(this,se(e).call(this,-0,-0,-0)),1===arguments.length&&we(r)?t.copy(r):(ge.debug&&(Pe(r),Pe(n),Pe(i)),t[0]=r,t[1]=n,t[2]=i),t}return ce(e,t),ie(e,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return ge.debug&&(Pe(t.x),Pe(t.y),Pe(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return function(t,e){var r=qe(t[0],t[1],t[2]),n=qe(e[0],e[1],e[2]);ze(r,r),ze(n,n);var i=Ge(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}(this,t)}},{key:"cross",value:function(t){return We(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,n){var i=[],a=[];i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2]}(this,this,void 0===r?Ye:r,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,n){var i=[],a=[];i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2]}(this,this,void 0===r?Ye:r,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,n){var i=[],a=[];i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2]}(this,this,void 0===r?Ye:r,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return He(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return Be(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return Ze(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return function(t,e,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1],c=e[2],h=i*c-a*u,l=a*s-n*c,f=n*u-i*s,d=i*f-a*l,y=a*h-n*f,p=n*l-i*h,v=2*o;h*=v,l*=v,f*=v,d*=2,y*=2,p*=2,t[0]=s+h+d,t[1]=u+l+y,t[2]=c+f+p}(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Pe(t)}}]),e}(Ne);function Je(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Xe=function(t){function e(){return re(this,e),oe(this,se(e).apply(this,arguments))}return ce(e,t),ie(e,[{key:"toString",value:function(){var t="[";if(ge.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(var n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,r){return this[e*this.RANK+t]=Pe(r),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),r=t*this.RANK,n=0;n<this.RANK;++n)e[n]=this[r+n];return e}},{key:"setColumn",value:function(t,e){for(var r=t*this.RANK,n=0;n<this.RANK;++n)this[r+n]=e[n];return this}}]),e}(Ee);function $e(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],y=e[11],p=e[12],v=e[13],g=e[14],m=e[15],b=r[0],w=r[1],k=r[2],x=r[3];return t[0]=b*n+w*s+k*l+x*p,t[1]=b*i+w*u+k*f+x*v,t[2]=b*a+w*c+k*d+x*g,t[3]=b*o+w*h+k*y+x*m,b=r[4],w=r[5],k=r[6],x=r[7],t[4]=b*n+w*s+k*l+x*p,t[5]=b*i+w*u+k*f+x*v,t[6]=b*a+w*c+k*d+x*g,t[7]=b*o+w*h+k*y+x*m,b=r[8],w=r[9],k=r[10],x=r[11],t[8]=b*n+w*s+k*l+x*p,t[9]=b*i+w*u+k*f+x*v,t[10]=b*a+w*c+k*d+x*g,t[11]=b*o+w*h+k*y+x*m,b=r[12],w=r[13],k=r[14],x=r[15],t[12]=b*n+w*s+k*l+x*p,t[13]=b*i+w*u+k*f+x*v,t[14]=b*a+w*c+k*d+x*g,t[15]=b*o+w*h+k*y+x*m,t}function tr(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function er(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}function rr(t,e,r,n){var i,a,o,s,u,c,h,l,f,d,y=e[0],p=e[1],v=e[2],g=n[0],m=n[1],b=n[2],w=r[0],k=r[1],x=r[2];return Math.abs(y-w)<1e-6&&Math.abs(p-k)<1e-6&&Math.abs(v-x)<1e-6?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=y-w,l=p-k,f=v-x,i=m*(f*=d=1/Math.hypot(h,l,f))-b*(l*=d),a=b*(h*=d)-g*f,o=g*l-m*h,(d=Math.hypot(i,a,o))?(i*=d=1/d,a*=d,o*=d):(i=0,a=0,o=0),s=l*o-f*a,u=f*i-h*o,c=h*a-l*i,(d=Math.hypot(s,u,c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=a,t[5]=u,t[6]=l,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*y+a*p+o*v),t[13]=-(s*y+u*p+c*v),t[14]=-(h*y+l*p+f*v),t[15]=1,t)}function nr(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.hypot(e,r,n,i)}function ir(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function ar(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2],c=r[3],h=c*n+s*a-u*i,l=c*i+u*n-o*a,f=c*a+o*i-s*n,d=-o*n-s*i-u*a;return t[0]=h*c+d*-o+l*-u-f*-s,t[1]=l*c+d*-s+f*-o-h*-u,t[2]=f*c+d*-u+h*-s-l*-o,t[3]=e[3],t}!function(){var t=function(){var t=new Ie(4);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();var or=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),sr=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),ur=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),cr={},hr=function(t){function e(t){var r;return re(this,e),r=oe(this,se(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return ce(e,t),ie(e,[{key:"INDICES",get:function(){return ur}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return cr.IDENTITY=cr.IDENTITY||Object.freeze(new e(or)),cr.IDENTITY}},{key:"ZERO",get:function(){return cr.ZERO=cr.ZERO||Object.freeze(new e(sr)),cr.ZERO}}]),ie(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u,c,h,l,f,d,y,p){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this[9]=c,this[10]=h,this[11]=l,this[12]=f,this[13]=d,this[14]=y,this[15]=p,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u,c,h,l,f,d,y,p){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=a,this[6]=c,this[7]=d,this[8]=r,this[9]=o,this[10]=h,this[11]=y,this[12]=n,this[13]=s,this[14]=l,this[15]=p,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(or)}},{key:"fromQuaternion",value:function(t){return function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,c=r*o,h=n*o,l=n*s,f=i*o,d=i*s,y=i*u,p=a*o,v=a*s,g=a*u;t[0]=1-l-y,t[1]=h+g,t[2]=f-v,t[3]=0,t[4]=h-g,t[5]=1-c-y,t[6]=d+p,t[7]=0,t[8]=f+v,t[9]=d-p,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}},{key:"frustum",value:function(t){var r=t.left,n=t.right,i=t.bottom,a=t.top,o=t.near,s=t.far;return s===1/0?e._computeInfinitePerspectiveOffCenter(this,r,n,i,a,o):function(t,e,r,n,i,a,o){var s=1/(r-e),u=1/(i-n),c=1/(a-o);t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*c,t[15]=0}(this,r,n,i,a,o,s),this.check()}},{key:"lookAt",value:function(t,e,r){if(1===arguments.length){var n=t;t=n.eye,e=n.center,r=n.up}return rr(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.left,r=t.right,n=t.bottom,i=t.top,a=t.near,o=void 0===a?.1:a,s=t.far;return function(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),c=1/(a-o);t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*c,t[15]=1}(this,e,r,n,i,o,void 0===s?500:s),this.check()}},{key:"orthographic",value:function(t){var r=t.fovy,n=void 0===r?45*Math.PI/180:r,i=t.aspect,a=void 0===i?1:i,o=t.focalDistance,s=void 0===o?1:o,u=t.near,c=void 0===u?.1:u,h=t.far,l=void 0===h?500:h;if(n>2*Math.PI)throw Error("radians");var f=n/2,d=s*Math.tan(f),y=d*a;return(new e).ortho({left:-y,right:y,bottom:-d,top:d,near:c,far:l})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,r=t.fov,n=void 0===r?45*Math.PI/180:r,i=t.aspect,a=void 0===i?1:i,o=t.near,s=void 0===o?.1:o,u=t.far,c=void 0===u?500:u;if((e=e||n)>2*Math.PI)throw Error("radians");return er(this,e,a,s,c),this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],d=t[12],y=t[13],p=t[14],v=t[15],(e*o-r*a)*(l*v-f*p)-(e*s-n*a)*(h*v-f*y)+(e*u-i*a)*(h*p-l*y)+(r*s-n*o)*(c*v-f*d)-(r*u-i*o)*(c*p-l*d)+(n*u-i*s)*(c*y-h*d);var t,e,r,n,i,a,o,s,u,c,h,l,f,d,y,p,v}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*i,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*i,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=this[4]*n,t[4]=this[5]*i,t[5]=this[6]*a,t[6]=this[8]*n,t[7]=this[9]*i,t[8]=this[10]*a,t}},{key:"transpose",value:function(){return function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],d=e[11],y=e[12],p=e[13],v=e[14],g=e[15],m=r*s-n*o,b=r*u-i*o,w=r*c-a*o,k=n*u-i*s,x=n*c-a*s,_=i*c-a*u,T=h*p-l*y,O=h*v-f*y,S=h*g-d*y,M=l*v-f*p,E=l*g-d*p,P=f*g-d*v,L=m*P-b*E+w*M+k*S-x*O+_*T;L&&(L=1/L,t[0]=(s*P-u*E+c*M)*L,t[1]=(i*E-n*P-a*M)*L,t[2]=(p*_-v*x+g*k)*L,t[3]=(f*x-l*_-d*k)*L,t[4]=(u*S-o*P-c*O)*L,t[5]=(r*P-i*S+a*O)*L,t[6]=(v*w-y*_-g*b)*L,t[7]=(h*_-f*w+d*b)*L,t[8]=(o*E-s*S+c*T)*L,t[9]=(n*S-r*E-a*T)*L,t[10]=(y*x-p*w+g*m)*L,t[11]=(l*w-h*x-d*m)*L,t[12]=(s*O-o*M-u*T)*L,t[13]=(r*M-n*O+i*T)*L,t[14]=(p*b-y*k-v*m)*L,t[15]=(h*k-l*b+f*m)*L)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return $e(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return $e(this,this,t),this.check()}},{key:"rotateX",value:function(t){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],h=e[9],l=e[10],f=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+c*n,t[5]=o*i+h*n,t[6]=s*i+l*n,t[7]=u*i+f*n,t[8]=c*i-a*n,t[9]=h*i-o*n,t[10]=l*i-s*n,t[11]=f*i-u*n}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],c=e[8],h=e[9],l=e[10],f=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-c*n,t[1]=o*i-h*n,t[2]=s*i-l*n,t[3]=u*i-f*n,t[8]=a*n+c*i,t[9]=o*n+h*i,t[10]=s*n+l*i,t[11]=u*n+f*i}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],c=e[4],h=e[5],l=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+c*n,t[1]=o*i+h*n,t[2]=s*i+l*n,t[3]=u*i+f*n,t[4]=c*i-a*n,t[5]=h*i-o*n,t[6]=l*i-s*n,t[7]=f*i-u*n}(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=Je(t,3),r=e[0],n=e[1],i=e[2];return this.rotateX(r).rotateY(n).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return function(t,e,r,n){var i,a,o,s,u,c,h,l,f,d,y,p,v,g,m,b,w,k,x,_,T,O,S,M,E=n[0],P=n[1],L=n[2],A=Math.hypot(E,P,L);A<1e-6||(E*=A=1/A,P*=A,L*=A,i=Math.sin(r),o=1-(a=Math.cos(r)),s=e[0],u=e[1],c=e[2],h=e[3],l=e[4],f=e[5],d=e[6],y=e[7],p=e[8],v=e[9],g=e[10],m=e[11],b=E*E*o+a,w=P*E*o+L*i,k=L*E*o-P*i,x=E*P*o-L*i,_=P*P*o+a,T=L*P*o+E*i,O=E*L*o+P*i,S=P*L*o-E*i,M=L*L*o+a,t[0]=s*b+l*w+p*k,t[1]=u*b+f*w+v*k,t[2]=c*b+d*w+g*k,t[3]=h*b+y*w+m*k,t[4]=s*x+l*_+p*T,t[5]=u*x+f*_+v*T,t[6]=c*x+d*_+g*T,t[7]=h*x+y*_+m*T,t[8]=s*O+l*S+p*M,t[9]=u*O+f*S+v*M,t[10]=c*O+d*S+g*M,t[11]=h*O+y*S+m*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?tr(this,this,t):tr(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,r){var n,i,a,o,s,u,c,h,l,f,d,y,p=r[0],v=r[1],g=r[2];e===t?(t[12]=e[0]*p+e[4]*v+e[8]*g+e[12],t[13]=e[1]*p+e[5]*v+e[9]*g+e[13],t[14]=e[2]*p+e[6]*v+e[10]*g+e[14],t[15]=e[3]*p+e[7]*v+e[11]*g+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],y=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=f,t[10]=d,t[11]=y,t[12]=n*p+s*v+l*g+e[12],t[13]=i*p+u*v+f*g+e[13],t[14]=a*p+c*v+d*g+e[14],t[15]=o*p+h*v+y*g+e[15])}(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(Le(e=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=Ce(e||[-0,-0],t,this);break;case 3:e=He(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Le(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=De(e||[-0,-0],t,this);break;case 3:e=Be(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Le(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,r){return this.identity().translate([t,e,r])}},{key:"transformPoint",value:function(t,e){return je("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return je("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return je("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,r,n,i,a){var o=2*a/(r-e),s=2*a/(i-n),u=(r+e)/(r-e),c=(i+n)/(i-n),h=-2*a;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}}]),e}(Xe),lr=.1,fr=1e-12,dr=1e-15,yr=(Math.PI,Math.PI,Math.PI,Math.PI,{self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global});(yr.global||yr.self||yr.window).mathgl={config:ge};function pr(t,e){e=void 0===e?t[0][0]:e;var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value,u=s[0]-e;u>180?s[0]-=360:u<-180&&(s[0]+=360)}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}function vr(t,e,r){var n=Object(Jt.h3ToGeo)(t),i=_()(n,2),a=i[0],o=i[1],s=e.length;pr(e,o);for(var u=e[0]===e[s-1]?s-1:s,c=0;c<u;c++)e[c][0]=Se(o,e[c][0],r),e[c][1]=Se(a,e[c][1],r)}function gr(t,e,r){var n=t(e,r),i=Object(Jt.h3ToGeo)(n),a=_()(i,2),o=a[0];return[a[1],o]}function mr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,n=Object(Jt.h3ToGeoBoundary)(t,!0);if(1!==e?vr(t,n,e):pr(n),r){var i=new Float64Array(2*n.length),a=0,o=!0,s=!1,u=void 0;try{for(var c,h=n[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var l=c.value;i[a++]=l[0],i[a++]=l[1]}}catch(t){s=!0,u=t}finally{try{o||null==h.return||h.return()}finally{if(s)throw u}}return i}return n}var br=Object.assign({},w.PolygonLayer.defaultProps,{highPrecision:!1,coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:function(t){return t.hexagon}},extruded:!0});delete br.getLineDashArray;var wr=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}return b()(e,t),l()(e,[{key:"shouldUpdateState",value:function(t){var e=t.changeFlags;return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,r=(t.oldProps,t.changeFlags);if(r.dataChanged||r.updateTriggers&&r.updateTriggers.getHexagon){var n=-1,i=!1,a=!1,o=Object(w.createIterable)(e.data),s=o.iterable,u=o.objectInfo,c=!0,h=!1,l=void 0;try{for(var f,d=s[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value;u.index++;var p=e.getHexagon(y,u),v=Object(Jt.h3GetResolution)(p);if(n<0)n=v;else if(n!==v){a=!0;break}if(Object(Jt.h3IsPentagon)(p)){i=!0;break}}}catch(t){h=!0,l=t}finally{try{c||null==d.return||d.return()}finally{if(h)throw l}}this.setState({resolution:n,edgeLengthKM:n>=0?Object(Jt.edgeLength)(n,Jt.UNITS.km):0,hasMultipleRes:a,hasPentagon:i})}this._updateVertices(this.context.viewport)}},{key:"_shouldUseHighPrecision",value:function(){var t=this.state,e=t.resolution,r=t.hasPentagon,n=t.hasMultipleRes;return this.props.highPrecision||n||r||e>=0&&e<=5}},{key:"_updateVertices",value:function(t){if(!this._shouldUseHighPrecision()){var e=this.state,r=e.resolution,n=e.edgeLengthKM,i=e.centerHex;if(!(r<0)){var a=this.props.centerHexagon||Object(Jt.geoToH3)(t.latitude,t.longitude,r);if(i!==a){if(i){var o=Object(Jt.h3Distance)(i,a);if(o>=0&&o*n<10)return}var s=t.distanceScales.unitsPerMeter,u=mr(a),c=Object(Jt.h3ToGeo)(a),h=_()(c,2),l=h[0],f=h[1],d=t.projectFlat([f,l]),y=_()(d,2),p=y[0],v=y[1];u=u.map((function(e){var r=t.projectFlat(e);return r[0]=(r[0]-p)/s[0],r[1]=(r[1]-v)/s[1],r})),this.setState({centerHex:a,vertices:u})}}}}},{key:"renderLayers",value:function(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}},{key:"_getForwardProps",value:function(){var t=this.props,e=t.elevationScale,r=t.material,n=t.coverage,i=t.extruded,a=t.wireframe,o=t.stroked,s=t.filled,u=t.lineWidthUnits,c=t.lineWidthScale,h=t.lineWidthMinPixels,l=t.lineWidthMaxPixels,f=t.getFillColor,d=t.getElevation,y=t.getLineColor,p=t.getLineWidth,v=t.updateTriggers;return{elevationScale:e,extruded:i,coverage:n,wireframe:a,stroked:o,filled:s,lineWidthUnits:u,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:l,material:r,getElevation:d,getFillColor:f,getLineColor:y,getLineWidth:p,updateTriggers:{getFillColor:v.getFillColor,getElevation:v.getElevation,getLineColor:v.getLineColor,getLineWidth:v.getLineWidth}}}},{key:"_renderPolygonLayer",value:function(){var t=this.props,e=t.data,r=t.getHexagon,n=t.updateTriggers,i=t.coverage,a=this.getSubLayerClass("hexagon-cell-hifi",w.PolygonLayer),o=this._getForwardProps();return o.updateTriggers.getPolygon=function(t,e){return null==t?e:"object"===ee()(t)?Object.assign({},t,{coverage:e}):{getHexagon:t,coverage:e}}(n.getHexagon,i),new a(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:e,_normalize:!1,positionFormat:"XY",getPolygon:function(t,e){return mr(r(t,e),i,!0)}})}},{key:"_renderColumnLayer",value:function(){var t=this.props,e=t.data,r=t.getHexagon,n=t.updateTriggers,i=this.getSubLayerClass("hexagon-cell",w.ColumnLayer),a=this._getForwardProps();return a.updateTriggers.getPosition=n.getHexagon,new i(a,this.getSubLayerProps({id:"hexagon-cell",updateTriggers:a.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:gr.bind(null,r)})}}]),e}(w.CompositeLayer);wr.defaultProps=br,wr.layerName="H3HexagonLayer";var kr=r(0),xr=r.n(kr),_r=r(14),Tr=r.n(_r),Or=r(23),Sr=r.n(Or),Mr=r(24);function Er(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function Pr(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){Er(a,n,i,o,s,"next",t)}function s(t){Er(a,n,i,o,s,"throw",t)}o(void 0)}))}}var Lr=function(t){return"boolean"==typeof t},Ar=function(t){return"function"==typeof t},jr=function(t){return null!==t&&"object"===ae(t)},Nr=function(t){return t&&"function"==typeof t[Symbol.iterator]},Ir=function(t){return t&&"function"==typeof t[Symbol.asyncIterator]},Rr=function(t){return"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json},Cr=function(t){return function(t){return"undefined"!=typeof File&&t instanceof File}(t)||function(t){return"undefined"!=typeof Blob&&t instanceof Blob}(t)},Dr=function(t){return function(t){return"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||jr(t)&&Ar(t.tee)&&Ar(t.cancel)&&Ar(t.getReader)}(t)||function(t){return jr(t)&&Ar(t.read)&&Ar(t.pipe)&&Lr(t.readable)}(t)},Br="",Vr={};function Fr(t){for(var e in Vr)if(t.startsWith(e)){var r=Vr[e];return t.replace(e,r)}return t+=Br}function Ur(t,e){if(!t)throw new Error(e||"loader assertion failed.")}var qr=function(){function t(e,r){re(this,t),this._fileOrBlob=e,this.bodyUsed=!1}var e,r,n;return ie(t,[{key:"arrayBuffer",value:(n=Pr(xr.a.mark((function t(){var e,r,n;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._getFileReader(),r=e.reader,n=e.promise,r.readAsArrayBuffer(this._fileOrBlob),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"text",value:(r=Pr(xr.a.mark((function t(){var e,r,n;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._getFileReader(),r=e.reader,n=e.promise,r.readAsText(this._fileOrBlob),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"json",value:(e=Pr(xr.a.mark((function t(){var e;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.text();case 2:return e=t.sent,t.abrupt("return",JSON.parse(e));case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"_getFileReader",value:function(){Ur(!this.bodyUsed),this.bodyUsed=!0;var t=new FileReader,e=new Promise((function(e,r){try{t.onerror=function(t){return r(new Error("Read error"))},t.onabort=function(){return r(new Error("Read aborted."))},t.onload=function(){return e(t.result)}}catch(t){r(t)}}));return{reader:t,promise:e}}},{key:"headers",get:function(){return new Headers({"Content-Length":this._fileOrBlob.size,"Content-Type":this._fileOrBlob.type})}},{key:"ok",get:function(){return!0}},{key:"status",get:function(){return 200}},{key:"url",get:function(){return this._fileOrBlob.name||""}}]),t}();function zr(t,e){return Promise.resolve(new qr(t,e))}function Gr(t){return Wr.apply(this,arguments)}function Wr(){return(Wr=Pr(xr.a.mark((function t(e){var r;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): "),t.prev=1,!e.headers.get("Content-Type").includes("application/json")){t.next=10;break}return t.t0=r,t.next=7,e.text();case 7:r=t.t0+=t.sent,t.next=11;break;case 10:r+=e.statusText;case 11:t.next=16;break;case 13:return t.prev=13,t.t1=t.catch(1),t.abrupt("return",r);case 16:return t.abrupt("return",r);case 17:case"end":return t.stop()}}),t,null,[[1,13]])})))).apply(this,arguments)}function Hr(t,e){return Zr.apply(this,arguments)}function Zr(){return(Zr=Pr(xr.a.mark((function t(e,r){var n;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Cr(e)){t.next=2;break}return t.abrupt("return",zr(e,r));case 2:return e=Fr(e),t.next=5,fetch(e,r);case 5:if((n=t.sent).ok||!r.throws){t.next=12;break}return t.t0=Error,t.next=10,Gr(n);case 10:throw t.t1=t.sent,new t.t0(t.t1);case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Kr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Yr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Qr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Yr(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Yr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Jr(t){if(!t)return!1;Array.isArray(t)&&(t=t[0]);var e=t.parseTextSync||t.parseSync||t.parse||t.parseStream||t.parseInBatches,r=t.options&&t.options[t.id];return e=e||r&&r.workerUrl}function Xr(t){var e;return Ur(t,"null loader"),Ur(Jr(t),"invalid loader"),Array.isArray(t)&&(e=t[1],t=Qr({},t=t[0],{options:Qr({},t.options,{},e)})),t.extension&&(t.extensions=t.extensions||t.extension,delete t.extension),Array.isArray(t.extensions)||(t.extensions=[t.extensions]),Ur(t.extensions&&t.extensions.length>0&&t.extensions[0]),t.parseTextSync&&(t.text=!0),t.text||(t.binary=!0),t}function $r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2.1.1";Ur(t,"no loader provided");var r=t.version;e&&r&&(e=tn(e),r=tn(r))}function tn(t){var e=t.split(".").map(Number);return{major:e[0],minor:e[1]}}var en=function(){function t(){re(this,t)}return ie(t,[{key:"log",value:function(){return function(t){}}},{key:"info",value:function(){return function(t){}}},{key:"warn",value:function(){return function(t){}}},{key:"error",value:function(){return function(t){}}}]),t}(),rn={CDN:"https://unpkg.com/@loaders.gl",worker:!0,log:new(function(){function t(){re(this,t),this.console=console}return ie(t,[{key:"log",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.log).bind.apply(t,[this.console].concat(r))}},{key:"info",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.info).bind.apply(t,[this.console].concat(r))}},{key:"warn",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.warn).bind.apply(t,[this.console].concat(r))}},{key:"error",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.error).bind.apply(t,[this.console].concat(r))}}]),t}()),dataType:"arraybuffer"};function nn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function an(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?nn(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var on=function(t){return t&&"object"===ae(t)&&t.constructor==={}.constructor},sn=an({},rn);function un(t,e,r){var n=an({},t&&(t.DEFAULT_LOADER_OPTIONS||t.defaultOptions||t.options||{}));return function(t,e){!e||"baseUri"in t||(t.baseUri=e)}(n,r),null===n.log&&(n.log=new en),cn(n,sn),cn(n,e),n}function cn(t,e){for(var r in e)if(r in e){var n=e[r];on(n)&&on(t[r])?t[r]=an({},t[r],{},e[r]):t[r]=e[r]}}function hn(t){this.wrapped=t}function ln(t){return new hn(t)}function fn(t){var e,r;function n(e,r){try{var a=t[e](r),o=a.value,s=o instanceof hn;Promise.resolve(s?o.wrapped:o).then((function(t){s?n("return"===e?"return":"next",t):i(a.done?"return":"normal",t)}),(function(t){n("throw",t)}))}catch(t){i("throw",t)}}function i(t,i){switch(t){case"return":e.resolve({value:i,done:!0});break;case"throw":e.reject(i);break;default:e.resolve({value:i,done:!1})}(e=e.next)?n(e.key,e.arg):r=null}this._invoke=function(t,i){return new Promise((function(a,o){var s={key:t,arg:i,resolve:a,reject:o,next:null};r?r=r.next=s:(e=r=s,n(t,i))}))},"function"!=typeof t.return&&(this.return=void 0)}function dn(t){return function(){return new fn(t.apply(this,arguments))}}"function"==typeof Symbol&&Symbol.asyncIterator&&(fn.prototype[Symbol.asyncIterator]=function(){return this}),fn.prototype.next=function(t){return this._invoke("next",t)},fn.prototype.throw=function(t){return this._invoke("throw",t)},fn.prototype.return=function(t){return this._invoke("return",t)};"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof global&&global,"undefined"!=typeof document&&document;var yn="object"!==("undefined"==typeof process?"undefined":ae(process))||"[object process]"!==String(process)||process.browser,pn="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),vn=pn&&parseFloat(pn[1])||0;function gn(t){if(yn||vn>=10){if("function"==typeof t[Symbol.asyncIterator])return t;if("function"==typeof t.getIterator)return t.getIterator()}return yn?function(t){return mn.apply(this,arguments)}(t):function(t){return bn.apply(this,arguments)}(t)}function mn(){return(mn=dn(xr.a.mark((function t(e){var r,n,i,a;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.getReader(),t.prev=1;case 2:return t.next=5,ln(r.read());case 5:if(n=t.sent,i=n.done,a=n.value,!i){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,a;case 12:t.next=2;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(1),r.releaseLock();case 19:case"end":return t.stop()}}),t,null,[[1,16]])})))).apply(this,arguments)}function bn(){return(bn=dn(xr.a.mark((function t(e){var r;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ln(e);case 2:e=t.sent;case 3:if(null===(r=e.read())){t.next=9;break}return t.next=8,r;case 8:return t.abrupt("continue",3);case 9:if(!e._readableState.ended){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,ln(wn(e));case 13:t.next=3;break;case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function wn(t){return kn.apply(this,arguments)}function kn(){return(kn=Pr(xr.a.mark((function t(e){return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.once("readable",t)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xn(t){var e;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(e=t[Symbol.asyncIterator]))return e.call(t);if(Symbol.iterator&&null!=(e=t[Symbol.iterator]))return e.call(t)}throw new TypeError("Object is not async iterable")}function _n(t,e){var r=t instanceof ArrayBuffer?new Uint8Array(t):t,n=e instanceof ArrayBuffer?new Uint8Array(e):e,i=new Uint8Array(r.byteLength+n.byteLength);return i.set(r,0),i.set(n,r.byteLength),i}var Tn=xr.a.mark((function(t){var e,r=arguments;return xr.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e=r.length>1&&void 0!==r[1]?r[1]:{},"string"!=typeof t){n.next=4;break}return n.delegateYield(Ln(t,e),"t0",3);case 3:return n.abrupt("return");case 4:if(!(t instanceof ArrayBuffer)){n.next=7;break}return n.delegateYield(Pn(t,e),"t1",6);case 6:return n.abrupt("return");case 7:throw new Error("assert");case 8:case"end":return n.stop()}}),Tn)})),On=xr.a.mark(Pn),Sn=xr.a.mark(Ln);function Mn(t){return En.apply(this,arguments)}function En(){return(En=Pr(xr.a.mark((function t(e){var r,n,i,a,o,s,u,c,h;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new ArrayBuffer(0),n="",i=!0,a=!1,t.prev=4,s=xn(e);case 6:return t.next=8,s.next();case 8:return u=t.sent,i=u.done,t.next=12,u.value;case 12:if(c=t.sent,i){t.next=19;break}"string"==typeof(h=c)?n+=h:r=_n(r,h);case 16:i=!0,t.next=6;break;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(4),a=!0,o=t.t0;case 25:if(t.prev=25,t.prev=26,i||null==s.return){t.next=30;break}return t.next=30,s.return();case 30:if(t.prev=30,!a){t.next=33;break}throw o;case 33:return t.finish(30);case 34:return t.finish(25);case 35:return t.abrupt("return",n||r);case 36:case"end":return t.stop()}}),t,null,[[4,21,25,35],[26,,30,34]])})))).apply(this,arguments)}function Pn(t){var e,r,n,i,a,o,s,u=arguments;return xr.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:e=u.length>1&&void 0!==u[1]?u[1]:{},r=e.chunkSize,n=void 0===r?262144:r,i=0;case 3:if(!(i<t.byteLength)){c.next=14;break}return a=Math.min(t.byteLength-i,n),o=new ArrayBuffer(a),s=new Uint8Array(t,i,a),new Uint8Array(o).set(s),i+=a,c.next=12,o;case 12:c.next=3;break;case 14:case"end":return c.stop()}}),On)}function Ln(t){var e,r,n,i,a,o,s=arguments;return xr.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:e=s.length>1&&void 0!==s[1]?s[1]:{},r=e.chunkSize,n=void 0===r?262144:r,i=0;case 3:if(!(i<t.length)){u.next=11;break}return a=Math.min(t.length-i,n),o=t.slice(i,i+a),i+=a,u.next=9,o;case 9:u.next=3;break;case 11:case"end":return u.stop()}}),Sn)}function An(t){return jn.apply(this,arguments)}function jn(){return(jn=Pr(xr.a.mark((function t(e){var r,n;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ok){t.next=12;break}return r="fetch failed ".concat(e.status," "),t.prev=2,t.next=5,e.text();case 5:n=t.sent,r+=n,t.next=11;break;case 9:t.prev=9,t.t0=t.catch(2);case 11:throw new Error(r);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})))).apply(this,arguments)}var Nn="Cannot convert supplied data type";function In(t,e){return Rr(t)?e=e||t.url:Cr(e)&&(e=e.name),"string"==typeof e?e.replace(/\?.*/,""):e}function Rn(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer){var r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)||(a=t)&&"object"===ae(a)&&a.isBuffer){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);var n=t.buffer,i=t.byteLength||t.length;return 0===t.byteOffset&&i===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+i)),n}var a;throw new Error(Nn)}function Cn(t,e){return Dn.apply(this,arguments)}function Dn(){return(Dn=Pr(xr.a.mark((function t(e,r){var n,i;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:if(e=t.sent,n=e instanceof ArrayBuffer||ArrayBuffer.isView(e),"string"!=typeof e&&!n){t.next=6;break}return t.abrupt("return",Rn(e,r));case 6:if(!Cr(e)){t.next=10;break}return t.next=9,zr(e);case 9:e=t.sent;case 10:if(!Rr(e)){t.next=24;break}return i=e,t.next=14,An(i);case 14:if(!r.binary){t.next=20;break}return t.next=17,i.arrayBuffer();case 17:t.t0=t.sent,t.next=23;break;case 20:return t.next=22,i.text();case 22:t.t0=t.sent;case 23:return t.abrupt("return",t.t0);case 24:if(Dr(e)&&(e=gn(e)),!Nr(e)&&!Ir(e)){t.next=27;break}return t.abrupt("return",Mn(e));case 27:throw new Error(Nn);case 28:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Bn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Vn(t,e,r){return r||(t=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Bn(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Bn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({fetch:t.fetch||Hr},t),Array.isArray(t.loaders)||(t.loaders=null),t)}function Fn(t,e){if(!e&&!Array.isArray(t))return t;var r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){var n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[].concat(de(r),de(n)):n}return r&&r.length?r:null}var Un=r(17);function qn(t){if(Un.toArrayBuffer&&(t=Object(Un.toArrayBuffer)(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){var e=t;return(new TextEncoder).encode(e).buffer}return Ur(!1)}var zn=new Map;function Gn(t){return"try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n}")}function Wn(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=r||new Set;if(t){if(Hn(t))n.add(t);else if(Hn(t.buffer))n.add(t.buffer);else if(e&&"object"===ae(t))for(var i in t)Wn(t[i],e,n)}else;return void 0===r?Array.from(n):null}function Hn(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Zn=0;function Kn(t){var e=t.data;(0,t.resolve)(e)}var Yn=function(){function t(e){var r=e.source,n=e.name,i=void 0===n?"web-worker-".concat(Zn++):n,a=e.onMessage;re(this,t);var o=function(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],Ur("string"==typeof t,"worker source"),t.startsWith("url(")&&t.endsWith(")")){var e=t.match(/^url\((.*)\)$/)[1];if(e&&!e.startsWith("http"))return e;t=Gn(e)}var r=zn.get(t);if(!r){var n=new Blob([t],{type:"application/javascript"});r=URL.createObjectURL(n),zn.set(t,r)}return r}(r,i);this.worker=new Worker(o,{name:i}),this.name=i,this.onMessage=a||Kn}var e;return ie(t,[{key:"process",value:(e=Pr(xr.a.mark((function t(e){var r=this;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){r.worker.onmessage=function(e){return r.onMessage({worker:r.worker,data:e.data,resolve:t,reject:n})},r.worker.onerror=function(t){var e="".concat(r.name,": WorkerThread.process() failed");t.message&&(e+=" ".concat(t.message," ").concat(t.filename,":").concat(t.lineno,":").concat(t.colno));var i=new Error(e);console.error(t),n(i)};var i=Wn(e);r.worker.postMessage(e,i)})));case 1:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"destroy",value:function(){this.worker.terminate(),this.worker=null}}]),t}(),Qn=function(){function t(e){var r=e.source,n=e.name,i=void 0===n?"unnamed":n,a=e.maxConcurrency,o=void 0===a?1:a,s=e.onMessage,u=e.onDebug,c=void 0===u?function(){}:u;re(this,t),this.source=r,this.name=i,this.maxConcurrency=o,this.onMessage=s,this.onDebug=c,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1}var e;return ie(t,[{key:"destroy",value:function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0}},{key:"process",value:(e=Pr(xr.a.mark((function t(e,r){var n=this;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,i){n.jobQueue.push({data:e,jobName:r,resolve:t,reject:i}),n._startQueuedJob()})));case 1:case"end":return t.stop()}}),t)}))),function(t,r){return e.apply(this,arguments)})},{key:"_startQueuedJob",value:function(){var t=this;if(this.jobQueue.length){var e=this._getAvailableWorker();if(e){var r=this.jobQueue.shift();this.onDebug({message:"processing",worker:e.name,job:r.jobName,backlog:this.jobQueue.length}),e.process(r.data).then((function(t){return r.resolve(t)})).catch((function(t){return r.reject(t)})).then((function(){return t._onWorkerDone(e)}))}}}},{key:"_onWorkerDone",value:function(t){this.isDestroyed?t.destroy():(this.idleQueue.push(t),this._startQueuedJob())}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;var t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Yn({source:this.source,onMessage:this.onMessage,name:t})}return null}}]),t}(),Jn=function(){function t(e){var r=e.maxConcurrency,n=void 0===r?5:r,i=e.onMessage,a=e.onDebug,o=void 0===a?function(){}:a;re(this,t),this.maxConcurrency=n,this.onMessage=i,this.onDebug=o,this.workerPools=new Map}var e;return ie(t,null,[{key:"isSupported",value:function(){return"undefined"!=typeof Worker}}]),ie(t,[{key:"setProps",value:function(t){"maxConcurrency"in t&&(this.maxConcurrency=t.maxConcurrency),"onDebug"in t&&(this.onDebug=t.onDebug)}},{key:"destroy",value:function(){this.workerPools.forEach((function(t){return t.destroy()}))}},{key:"process",value:(e=Pr(xr.a.mark((function t(e,r,n){var i;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this._getWorkerPool(e,r),t.abrupt("return",i.process(n));case 2:case"end":return t.stop()}}),t,this)}))),function(t,r,n){return e.apply(this,arguments)})},{key:"_getWorkerPool",value:function(t,e){var r=this.workerPools.get(e);return r||(r=new Qn({source:t,name:e,onMessage:this.onMessage,maxConcurrency:this.maxConcurrency,onDebug:this.onDebug}),this.workerPools.set(e,r)),r}}]),t}();function Xn(t,e,r,n){if(!Jn.isSupported())return!1;var i=r&&r[t.id];return!!("local"===r.worker&&i&&i.localWorkerUrl||r.worker&&i&&i.workerUrl)&&(!t.useWorker||t.useWorker(r))}function $n(t,e,r,n){var i=(r||{}).worker,a=r&&r[t.id]||{},o="local"===i?a.localWorkerUrl:a.workerUrl,s="url(".concat(o,")"),u=t.name,c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};t.maxConcurrency&&(e.maxConcurrency=t.maxConcurrency);t.onDebug&&(e.onDebug=t.onDebug);ti||(ti=new Jn({onMessage:ei}));return ti.setProps(e),ti}(r);r=JSON.parse(JSON.stringify(r));var h="2.1.1"!==t.version?"(core version ".concat("2.1.1",")"):"";return c.process(s,"".concat(u,"-worker@").concat(t.version).concat(h),{arraybuffer:qn(e),options:r,source:"loaders.gl@".concat("2.1.1"),type:"parse"})}var ti=null;function ei(t){return ri.apply(this,arguments)}function ri(){return(ri=Pr(xr.a.mark((function t(e){var r,n,i,a,o;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.worker,n=e.data,i=e.resolve,a=e.reject,t.t0=n.type,t.next="done"===t.t0?4:"parse"===t.t0?6:"error"===t.t0?17:19;break;case 4:return i(n.result),t.abrupt("break",19);case 6:return t.prev=6,t.next=9,gi(n.arraybuffer,n.options,n.url);case 9:o=t.sent,r.postMessage({type:"parse-done",id:n.id,result:o},Wn(o)),t.next=16;break;case 13:t.prev=13,t.t1=t.catch(6),r.postMessage({type:"parse-error",id:n.id,message:t.t1.message});case 16:return t.abrupt("break",19);case 17:return a(n.message),t.abrupt("break",19);case 19:case"end":return t.stop()}}),t,null,[[6,13]])})))).apply(this,arguments)}var ni=[];function ii(){return ni}var ai=/\.([^.]+)$/,oi=/^data:(.*?)(;|,)/;function si(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.nothrow,a=void 0!==i&&i;if(e=e||"",t&&!Array.isArray(t)){var o=t;return Xr(o),o}ui(t=[].concat(de(t||[]),de(ii())));var s=ci(t,e=e.replace(/\?.*/,""));if(!(s=(s=s||li(t,r))||fi(t,r))){if(a)return null;var u="No valid loader found";throw r&&(u+=' for data starting with "'.concat(pi(r),'"')),e&&(u+=" for ".concat(e)),new Error(u)}return s}function ui(t){var e=!0,r=!1,n=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){Xr(i.value)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}}function ci(t,e){var r=e.match(oi),n=r&&r[1];if(n)return hi(t,n);var i=(r=e.match(ai))&&r[1];return i&&function(t,e){e=e.toLowerCase();var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value,u=!0,c=!1,h=void 0;try{for(var l,f=s.extensions[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){if(l.value.toLowerCase()===e)return s}}catch(t){c=!0,h=t}finally{try{u||null==f.return||f.return()}finally{if(c)throw h}}}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return null}(t,i)}function hi(t,e){var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if(s.mimeTypes&&s.mimeTypes.includes(e))return s}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return null}function li(t,e){return e&&Rr(e)&&e.headers?hi(t,e.headers.get("content-type")):null}function fi(t,e){if(!e)return null;var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if("string"==typeof e){if(di(e,s))return s}else if(ArrayBuffer.isView(e)){if(yi(e.buffer,e.byteOffset,s))return s}else if(e instanceof ArrayBuffer){if(yi(e,0,s))return s}}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return null}function di(t,e){return e.testText&&e.testText(t)}function yi(t,e,r){switch(Array.isArray(r.test)?"array":ae(r.test)){case"function":return r.test(t,r);case"string":case"array":return(Array.isArray(r.test)?r.test:[r.test]).some((function(r){return r===vi(t,e,r.length)}));default:return!1}}function pi(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return vi(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){var r=0;return vi(t,r,e)}return""}function vi(t,e,r){if(t.byteLength<=e+r)return"";for(var n=new DataView(t),i="",a=0;a<r;a++)i+=String.fromCharCode(n.getUint8(e+a));return i}function gi(t,e,r,n){return mi.apply(this,arguments)}function mi(){return(mi=Pr(xr.a.mark((function t(e,r,n,i){var a,o,s,u;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r||Array.isArray(r)||Jr(r)||(i=n,n=r,r=null),a="","string"==typeof i&&(a=i,i=null),n=n||{},o=In(e,a),s=Fn(r,i),u=si(s,o,e)){t.next=9;break}return t.abrupt("return",null);case 9:return n=un(u,n,o),i=Vn({url:o,parse:gi,loaders:s},0,i),t.next=13,bi(u,e,n,i);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function bi(t,e,r,n){return wi.apply(this,arguments)}function wi(){return(wi=Pr(xr.a.mark((function t(e,r,n,i){return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return $r(e),t.next=3,Cn(r,e);case 3:if(r=t.sent,!e.parseTextSync||"string"!=typeof r){t.next=7;break}return n.dataType="text",t.abrupt("return",e.parseTextSync(r,n,i,e));case 7:if(!Xn(e,0,n)){t.next=11;break}return t.next=10,$n(e,r,n);case 10:return t.abrupt("return",t.sent);case 11:if(!e.parse){t.next=15;break}return t.next=14,e.parse(r,n,i,e);case 14:return t.abrupt("return",t.sent);case 15:return Ur(!e.parseSync),t.abrupt("return",Ur(!1));case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ki(t,e,r){return xi.apply(this,arguments)}function xi(){return(xi=Pr(xr.a.mark((function t(e,r,n){var i;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(r)||Jr(r)||(n=r,r=null),i=e,"string"!=typeof e){t.next=8;break}return t.next=5,Hr(e,n);case 5:i=t.sent,t.next=9;break;case 8:e=null;case 9:if(!Cr(e)){t.next=14;break}return t.next=12,Hr(e,n);case 12:i=t.sent,e=null;case 14:return t.next=16,gi(i,r,n,e);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Math.max(6378137,6378137,6356752.314245179);var _i=function(t){return t},Ti=new Qe;function Oi(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_i;return we(t)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z),e}function Si(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ti;return Oi(t,e,ge.cartographicRadians?_i:xe)}function Mi(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_i;return we(e)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]),e}function Ei(t,e){return Mi(t,e,ge.cartographicRadians?_i:_e)}var Pi=new Qe,Li=new Qe,Ai=new Qe;var ji=new Qe,Ni={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Ii={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ri={east:new Qe,north:new Qe,up:new Qe,west:new Qe,south:new Qe,down:new Qe},Ci=new Qe,Di=new Qe,Bi=new Qe;function Vi(t,e,r,n,i,a){var o,s,u,c=Ni[e]&&Ni[e][r];ye(c&&(!n||n===c));var h=ji.copy(i);if(Me(h.x,0,1e-14)&&Me(h.y,0,1e-14)){var l=Math.sign(h.z);o=Ci.fromArray(Ii[e]),"east"!==e&&"west"!==e&&o.scale(l),s=Di.fromArray(Ii[r]),"east"!==r&&"west"!==r&&s.scale(l),u=Bi.fromArray(Ii[n]),"east"!==n&&"west"!==n&&u.scale(l)}else{var f=Ri.up,d=Ri.east,y=Ri.north;d.set(-h.y,h.x,0).normalize(),t.geodeticSurfaceNormal(h,f),y.copy(f).cross(d);var p=Ri.west,v=Ri.south;Ri.down.copy(f).scale(-1),p.copy(d).scale(-1),v.copy(y).scale(-1),o=Ri[e],s=Ri[r],u=Ri[n]}return a[0]=o.x,a[1]=o.y,a[2]=o.z,a[3]=0,a[4]=s.x,a[5]=s.y,a[6]=s.z,a[7]=0,a[8]=u.x,a[9]=u.y,a[10]=u.z,a[11]=0,a[12]=h.x,a[13]=h.y,a[14]=h.z,a[15]=1,a}var Fi,Ui=new Qe,qi=new Qe,zi=new Qe,Gi=new Qe,Wi=new Qe,Hi=new Qe,Zi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;re(this,t),ye(e>=0),ye(r>=0),ye(n>=0),this.radii=new Qe(e,r,n),this.radiiSquared=new Qe(e*e,r*r,n*n),this.radiiToTheFourth=new Qe(e*e*e*e,r*r*r*r,n*n*n*n),this.oneOverRadii=new Qe(0===e?0:1/e,0===r?0:1/r,0===n?0:1/n),this.oneOverRadiiSquared=new Qe(0===e?0:1/(e*e),0===r?0:1/(r*r),0===n?0:1/(n*n)),this.minimumRadius=Math.min(e,r,n),this.maximumRadius=Math.max(e,r,n),this.centerToleranceSquared=lr,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return ie(t,null,[{key:"WGS84",get:function(){return Fi=Fi||new t(6378137,6378137,6356752.314245179)}}]),ie(t,[{key:"equals",value:function(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=qi,n=zi,i=Je(t,3),a=i[2];this.geodeticSurfaceNormalCartographic(t,r),n.copy(this.radiiSquared).scale(r);var o=Math.sqrt(r.dot(n));return n.scale(1/o),r.scale(a),n.add(r),n.to(e)}},{key:"cartesianToCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];Hi.from(t);var r=this.scaleToGeodeticSurface(Hi,Gi);if(r){var n=this.geodeticSurfaceNormal(r,qi),i=Wi;i.copy(Hi).subtract(r);var a=Math.atan2(n.y,n.x),o=Math.asin(n.z),s=Math.sign(Ge(i,Hi))*Ue(i);return Ei([a,o,s],e)}}},{key:"eastNorthUpToFixedFrame",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hr;return Vi(this,"east","north","up",t,e)}},{key:"localFrameToFixedFrame",value:function(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new hr;return Vi(this,t,e,r,n,i)}},{key:"geocentricSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Ui.from(t).normalize().to(e)}},{key:"geodeticSurfaceNormalCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Si(t),n=r[0],i=r[1],a=Math.cos(i);return Ui.set(a*Math.cos(n),a*Math.sin(n),Math.sin(i)).normalize(),Ui.to(e)}},{key:"geodeticSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Ui.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}},{key:"scaleToGeodeticSurface",value:function(t,e){return function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Qe,n=e.oneOverRadii,i=e.oneOverRadiiSquared,a=e.centerToleranceSquared;Pi.from(t);var o=t.x,s=t.y,u=t.z,c=n.x,h=n.y,l=n.z,f=o*o*c*c,d=s*s*h*h,y=u*u*l*l,p=f+d+y,v=Math.sqrt(1/p);if(Number.isFinite(v)){var g=Li;if(g.copy(t).scale(v),p<a)return g.to(r);var m=i.x,b=i.y,w=i.z,k=Ai;k.set(g.x*m*2,g.y*b*2,g.z*w*2);var x,_,T,O,S=(1-v)*t.len()/(.5*k.len()),M=0;do{var E=(x=1/(1+(S-=M)*m))*x,P=(_=1/(1+S*b))*_,L=(T=1/(1+S*w))*T,A=E*x,j=P*_,N=L*T,I=f*A*m+d*j*b+y*N*w,R=-2*I;M=(O=f*E+d*P+y*L-1)/R}while(Math.abs(O)>fr);return Pi.scale([x,_,T]).to(r)}}(t,this,e)}},{key:"scaleToGeocentricSurface",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];Gi.from(t);var r=Gi.x,n=Gi.y,i=Gi.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*a.x+n*n*a.y+i*i*a.z);return Gi.multiplyScalar(o).to(e)}},{key:"transformPositionToScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Gi.from(t).scale(this.oneOverRadii).to(e)}},{key:"transformPositionFromScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Gi.from(t).scale(this.radii).to(e)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];ye(Me(this.radii.x,this.radii.y,dr)),ye(this.radii.z>0),Gi.from(t);var n=Gi.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-e))return Gi.set(0,0,n).to(r)}}]),t}();function Ki(){var t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){var e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}var Yi=function(){function t(e,r){re(this,t),this.name=e,this.type=r,this.sampleSize=1,this.reset()}return ie(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Ki(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Ki()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),Qi=function(){function t(e){var r=e.id,n=e.stats;re(this,t),this.id=r,this.stats={},this._initializeStats(n),Object.seal(this)}return ie(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,r=t.type;return this.stats[e]||(this.stats[e]=t instanceof Yi?t:new Yi(e,r)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}();function Ji(t){var e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}function Xi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function $i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xi(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var ta={id:"request-scheduler",throttleRequests:!0,maxRequests:6},ea=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};re(this,t),this.props=$i({},ta,{},e),this.requestQueue=[],this.activeRequestCount=0,this.requestMap={},this.stats=new Qi({id:e.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever"),this._deferredUpdate=null}return ie(t,[{key:"scheduleRequest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 0};if(!this.props.throttleRequests)return Promise.resolve(t);if(this.requestMap[t.id])return this.requestMap[t.id];var r=null,n=new Promise((function(n,i){return r={handle:t,callback:e,resolve:n,reject:i}}));return this.requestQueue.push($i({promise:n},r)),this.requestMap[t.id]=n,this._issueNewRequests(),n}},{key:"startRequest",value:function(t){this.activeRequestCount++}},{key:"endRequest",value:function(t){this.requestMap[t.id]&&delete this.requestMap[t.id],this.activeRequestCount--,this._issueNewRequests()}},{key:"trackRequestPromise",value:function(t,e){var r=this;this.startRequest(t),e.then((function(){return r.endRequest(t)})).catch((function(){return r.endRequest(t)}))}},{key:"_issueNewRequests",value:function(){var t=this;this._deferredUpdate||(this._deferredUpdate=setTimeout((function(){return t._issueNewRequestsAsync()}),0))}},{key:"_issueNewRequestsAsync",value:function(){this._deferredUpdate=null;var t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(var e=0;e<t;++e){if(this.requestQueue.length>0)this.requestQueue.shift().resolve(!0)}}}},{key:"_updateAllRequests",value:function(){for(var t=this.requestQueue,e=0;e<t.length;++e){var r=t[e];this._updateRequest(r)||(t.splice(e,1),delete this.requestMap[r.handle.id],e--)}t.sort((function(t,e){return t.priority-e.priority}))}},{key:"_updateRequest",value:function(t){return t.priority=t.callback(t.handle),!(t.priority<0)||(t.resolve(!1),!1)}}]),t}(),ra=function t(e,r,n){re(this,t),this.item=e,this.previous=r,this.next=n},na=function(){function t(){re(this,t),this.head=null,this.tail=null,this._length=0}return ie(t,[{key:"add",value:function(t){var e=new ra(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}},{key:"remove",value:function(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}},{key:"splice",value:function(t,e){t!==e&&(this.remove(e),this._insert(t,e))}},{key:"_insert",value:function(t,e){var r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t,++this._length}},{key:"length",get:function(){return this._length}}]),t}();function ia(t){return null!=t}var aa=function(){function t(){re(this,t),this._list=new na,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}return ie(t,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(t){var e=t._cacheNode;ia(e)&&this._list.splice(this._sentinel,e)}},{key:"add",value:function(t,e,r){ia(e._cacheNode)||(e._cacheNode=this._list.add(e),r&&r(t,e))}},{key:"unloadTile",value:function(t,e,r){var n=e._cacheNode;ia(n)&&(this._list.remove(n),e._cacheNode=void 0,r&&r(t,e))}},{key:"unloadTiles",value:function(t,e){var r=this._trimTiles;this._trimTiles=!1;for(var n=this._list,i=1024*t.maximumMemoryUsage*1024,a=this._sentinel,o=n.head;o!==a&&(t.gpuMemoryUsageInBytes>i||r);){var s=o.item;o=o.next,this.unloadTile(t,s,e)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),t}();var oa=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});function sa(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function ua(t,e,r){return(ua=sa()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&Z(i,r.prototype),i}).apply(null,arguments)}function ca(t){var e="function"==typeof Map?new Map:void 0;return(ca=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return ua(t,arguments,H(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Z(n,t)})(t)}function ha(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}Math.PI,Math.PI;var la={};function fa(t){return Math.round(t/la.EPSILON)*la.EPSILON}function da(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.precision,n=void 0===r?la.precision||4:r;return t=fa(t),"".concat(parseFloat(t.toPrecision(n)))}function ya(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function pa(t,e,r){var n=la.EPSILON;r&&(la.EPSILON=r);try{if(t===e)return!0;if(ya(t)&&ya(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!pa(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=la.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{la.EPSILON=n}}la.EPSILON=1e-12,la.debug=!1,la.precision=4,la.printTypes=!1,la.printDegrees=!1,la.printRowMajor=!0;var va=function(t){function e(){return V(this,e),W(this,H(e).apply(this,arguments))}return K(e,t),U(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}},{key:"to",value:function(t){return t===this?this:ya(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(la)}},{key:"formatString",value:function(t){for(var e="",r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+da(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!pa(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,r){void 0===r&&(r=e,e=t,t=this);for(var n=0;n<this.ELEMENTS;++n){var i=t[n];this[n]=i+r*(e[n]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]+=a[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]-=a[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(la.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"elements",get:function(){return this}}]),e}(ca(Array));function ga(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function ma(t,e,r){if(la.debug&&!function(t,e){if(t.length!==e)return!1;for(var r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(""|r," some fields set to invalid numbers'"));return t}var ba={};function wa(t,e){ba[t]||(ba[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}var ka=function(t){function e(){return V(this,e),W(this,H(e).apply(this,arguments))}return K(e,t),U(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-t[r];e+=n*n}return ga(e)}},{key:"dot",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return ga(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]*=a[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]/=a[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return ha(t>=0&&t<this.ELEMENTS,"index is out of range"),ga(this[t])}},{key:"setComponent",value:function(t,e){return ha(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=ga(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=ga(t)}}]),e}(va);function xa(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a||1;return t[0]=(r[0]*n+r[4]*i+r[8]*a)/o,t[1]=(r[1]*n+r[5]*i+r[9]*a)/o,t[2]=(r[2]*n+r[6]*i+r[10]*a)/o,t}var _a=[0,0,0],Ta=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return V(this,e),t=W(this,H(e).call(this,-0,-0,-0)),1===arguments.length&&ya(r)?t.copy(r):(la.debug&&(ga(r),ga(n),ga(i)),t[0]=r,t[1]=n,t[2]=i),t}return K(e,t),U(e,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return la.debug&&(ga(t.x),ga(t.y),ga(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return function(t,e){var r=dt(t[0],t[1],t[2]),n=dt(e[0],e[1],e[2]);yt(r,r),yt(n,n);var i=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}(this,t)}},{key:"cross",value:function(t){return function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o}(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,n){var i=[],a=[];i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2]}(this,this,void 0===r?_a:r,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,n){var i=[],a=[];i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2]}(this,this,void 0===r?_a:r,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,n){var i=[],a=[];i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2]}(this,this,void 0===r?_a:r,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return pt(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return xa(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return vt(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return function(t,e,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1],c=e[2],h=i*c-a*u,l=a*s-n*c,f=n*u-i*s,d=i*f-a*l,y=a*h-n*f,p=n*l-i*h,v=2*o;h*=v,l*=v,f*=v,d*=2,y*=2,p*=2,t[0]=s+h+d,t[1]=u+l+y,t[2]=c+f+p}(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=ga(t)}}]),e}(ka),Oa=function(t){function e(){return V(this,e),W(this,H(e).apply(this,arguments))}return K(e,t),U(e,[{key:"toString",value:function(){var t="[";if(la.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(var n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,r){return this[e*this.RANK+t]=ga(r),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),r=t*this.RANK,n=0;n<this.RANK;++n)e[n]=this[r+n];return e}},{key:"setColumn",value:function(t,e){for(var r=t*this.RANK,n=0;n<this.RANK;++n)this[r+n]=e[n];return this}}]),e}(va);function Sa(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],d=r[1],y=r[2],p=r[3],v=r[4],g=r[5],m=r[6],b=r[7],w=r[8];return t[0]=f*n+d*o+y*c,t[1]=f*i+d*s+y*h,t[2]=f*a+d*u+y*l,t[3]=p*n+v*o+g*c,t[4]=p*i+v*s+g*h,t[5]=p*a+v*u+g*l,t[6]=m*n+b*o+w*c,t[7]=m*i+b*s+w*h,t[8]=m*a+b*u+w*l,t}function Ma(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}var Ea=Object.freeze([1,0,0,0,1,0,0,0,1]),Pa=Object.freeze([0,0,0,0,0,0,0,0,0]),La=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),Aa={},ja=function(t){function e(t){var r;return V(this,e),r=W(this,H(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return K(e,t),U(e,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return La}}],[{key:"IDENTITY",get:function(){return Aa.IDENTITY=Aa.IDENTITY||Object.freeze(new e(Ea)),Aa.IDENTITY}},{key:"ZERO",get:function(){return Aa.ZERO=Aa.ZERO||Object.freeze(new e(Pa)),Aa.ZERO}}]),U(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=n,this[2]=o,this[3]=e,this[4]=i,this[5]=s,this[6]=r,this[7]=a,this[8]=u,this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],e*(c*a-o*u)+r*(-c*i+o*s)+n*(u*i-a*s);var t,e,r,n,i,a,o,s,u,c}},{key:"identity",value:function(){return this.copy(Ea)}},{key:"fromQuaternion",value:function(t){return function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,c=r*o,h=n*o,l=n*s,f=i*o,d=i*s,y=i*u,p=a*o,v=a*s,g=a*u;t[0]=1-l-y,t[3]=h-g,t[6]=f+v,t[1]=h+g,t[4]=1-c-y,t[7]=d-p,t[2]=f-v,t[5]=d+p,t[8]=1-c-l}(this,t),this.check()}},{key:"transpose",value:function(){return function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=h*o-s*c,f=-h*a+s*u,d=c*a-o*u,y=r*l+n*f+i*d;y&&(y=1/y,t[0]=l*y,t[1]=(-h*n+i*c)*y,t[2]=(s*n-i*o)*y,t[3]=f*y,t[4]=(h*r-i*u)*y,t[5]=(-s*r+i*a)*y,t[6]=d*y,t[7]=(-c*r+n*u)*y,t[8]=(o*r-n*a)*y)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return Sa(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return Sa(this,this,t),this.check()}},{key:"rotate",value:function(t){return function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=Math.sin(r),d=Math.cos(r);t[0]=d*n+f*o,t[1]=d*i+f*s,t[2]=d*a+f*u,t[3]=d*o-f*n,t[4]=d*s-f*i,t[5]=d*u-f*a,t[6]=c,t[7]=h,t[8]=l}(this,this,t),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?Ma(this,this,t):Ma(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],d=r[1];t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=f*n+d*o+c,t[7]=f*i+d*s+h,t[8]=f*a+d*u+l}(this,this,t),this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}(e||[-0,-0],t,this);break;case 3:e=vt(e||[-0,-0,-0],t,this);break;case 4:e=function(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n+r[3]*i+r[6]*a,t[1]=r[1]*n+r[4]*i+r[7]*a,t[2]=r[2]*n+r[5]*i+r[8]*a,t[3]=e[3],t}(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ma(e,t.length),e}},{key:"transformVector",value:function(t,e){return wa("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return wa("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return wa("Matrix3.transformVector"),this.transform(t,e)}}]),e}(Oa),Na=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ia=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Ra=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Ca={},Da=function(t){function e(t){var r;return V(this,e),r=W(this,H(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return K(e,t),U(e,[{key:"INDICES",get:function(){return Ra}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return Ca.IDENTITY=Ca.IDENTITY||Object.freeze(new e(Na)),Ca.IDENTITY}},{key:"ZERO",get:function(){return Ca.ZERO=Ca.ZERO||Object.freeze(new e(Ia)),Ca.ZERO}}]),U(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u,c,h,l,f,d,y,p){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this[9]=c,this[10]=h,this[11]=l,this[12]=f,this[13]=d,this[14]=y,this[15]=p,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u,c,h,l,f,d,y,p){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=a,this[6]=c,this[7]=d,this[8]=r,this[9]=o,this[10]=h,this[11]=y,this[12]=n,this[13]=s,this[14]=l,this[15]=p,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(Na)}},{key:"fromQuaternion",value:function(t){return function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,c=r*o,h=n*o,l=n*s,f=i*o,d=i*s,y=i*u,p=a*o,v=a*s,g=a*u;t[0]=1-l-y,t[1]=h+g,t[2]=f-v,t[3]=0,t[4]=h-g,t[5]=1-c-y,t[6]=d+p,t[7]=0,t[8]=f+v,t[9]=d-p,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}},{key:"frustum",value:function(t){var r=t.left,n=t.right,i=t.bottom,a=t.top,o=t.near,s=t.far;return s===1/0?e._computeInfinitePerspectiveOffCenter(this,r,n,i,a,o):function(t,e,r,n,i,a,o){var s=1/(r-e),u=1/(i-n),c=1/(a-o);t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*c,t[15]=0}(this,r,n,i,a,o,s),this.check()}},{key:"lookAt",value:function(t,e,r){if(1===arguments.length){var n=t;t=n.eye,e=n.center,r=n.up}return ct(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.left,r=t.right,n=t.bottom,i=t.top,a=t.near,o=void 0===a?.1:a,s=t.far;return function(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),c=1/(a-o);t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*c,t[15]=1}(this,e,r,n,i,o,void 0===s?500:s),this.check()}},{key:"orthographic",value:function(t){var r=t.fovy,n=void 0===r?45*Math.PI/180:r,i=t.aspect,a=void 0===i?1:i,o=t.focalDistance,s=void 0===o?1:o,u=t.near,c=void 0===u?.1:u,h=t.far,l=void 0===h?500:h;if(n>2*Math.PI)throw Error("radians");var f=n/2,d=s*Math.tan(f),y=d*a;return(new e).ortho({left:-y,right:y,bottom:-d,top:d,near:c,far:l})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,r=t.fov,n=void 0===r?45*Math.PI/180:r,i=t.aspect,a=void 0===i?1:i,o=t.near,s=void 0===o?.1:o,u=t.far,c=void 0===u?500:u;if((e=e||n)>2*Math.PI)throw Error("radians");return ut(this,e,a,s,c),this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],d=t[12],y=t[13],p=t[14],v=t[15],(e*o-r*a)*(l*v-f*p)-(e*s-n*a)*(h*v-f*y)+(e*u-i*a)*(h*p-l*y)+(r*s-n*o)*(c*v-f*d)-(r*u-i*o)*(c*p-l*d)+(n*u-i*s)*(c*y-h*d);var t,e,r,n,i,a,o,s,u,c,h,l,f,d,y,p,v}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*i,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*i,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=this[4]*n,t[4]=this[5]*i,t[5]=this[6]*a,t[6]=this[8]*n,t[7]=this[9]*i,t[8]=this[10]*a,t}},{key:"transpose",value:function(){return function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}},{key:"invert",value:function(){return et(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return rt(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return rt(this,this,t),this.check()}},{key:"rotateX",value:function(t){return at(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],c=e[8],h=e[9],l=e[10],f=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-c*n,t[1]=o*i-h*n,t[2]=s*i-l*n,t[3]=u*i-f*n,t[8]=a*n+c*i,t[9]=o*n+h*i,t[10]=s*n+l*i,t[11]=u*n+f*i}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return ot(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=Y(t,3),r=e[0],n=e[1],i=e[2];return this.rotateX(r).rotateY(n).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return function(t,e,r,n){var i,a,o,s,u,c,h,l,f,d,y,p,v,g,m,b,w,k,x,_,T,O,S,M,E=n[0],P=n[1],L=n[2],A=Math.hypot(E,P,L);A<1e-6||(E*=A=1/A,P*=A,L*=A,i=Math.sin(r),o=1-(a=Math.cos(r)),s=e[0],u=e[1],c=e[2],h=e[3],l=e[4],f=e[5],d=e[6],y=e[7],p=e[8],v=e[9],g=e[10],m=e[11],b=E*E*o+a,w=P*E*o+L*i,k=L*E*o-P*i,x=E*P*o-L*i,_=P*P*o+a,T=L*P*o+E*i,O=E*L*o+P*i,S=P*L*o-E*i,M=L*L*o+a,t[0]=s*b+l*w+p*k,t[1]=u*b+f*w+v*k,t[2]=c*b+d*w+g*k,t[3]=h*b+y*w+m*k,t[4]=s*x+l*_+p*T,t[5]=u*x+f*_+v*T,t[6]=c*x+d*_+g*T,t[7]=h*x+y*_+m*T,t[8]=s*O+l*S+p*M,t[9]=u*O+f*S+v*M,t[10]=c*O+d*S+g*M,t[11]=h*O+y*S+m*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?it(this,this,t):it(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return nt(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(ma(e=J(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}(e||[-0,-0],t,this);break;case 3:e=pt(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ma(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=function(t,e,r){var n=e[0],i=e[1],a=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/a,t[1]=(r[1]*n+r[5]*i)/a,t}(e||[-0,-0],t,this);break;case 3:e=xa(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ma(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,r){return this.identity().translate([t,e,r])}},{key:"transformPoint",value:function(t,e){return wa("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return wa("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return wa("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,r,n,i,a){var o=2*a/(r-e),s=2*a/(i-n),u=(r+e)/(r-e),c=(i+n)/(i-n),h=-2*a;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}}]),e}(Oa),Ba=1e-15,Va=1e-20,Fa=(Math.PI,Math.PI,Math.PI,Math.PI,{self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global});(Fa.global||Fa.self||Fa.window).mathgl={config:la};var Ua=new Ta,qa=new Ta,za=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V(this,t),n=n||Ua.copy(e).add(r).scale(.5),this.minimum=new Ta(e),this.maximum=new Ta(r),this.center=new Ta(n)}U(t,[{key:"fromPoints",value:function(t){if(!t||0===t.length)return this.minimum.set(0,0,0),this.maximum.set(0,0,0),this.center.set(0,0,0),this;var e=t[0][0],r=t[0][1],n=t[0][2],i=t[0][0],a=t[0][1],o=t[0][2],s=!0,u=!1,c=void 0;try{for(var h,l=t[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var f=h.value,d=f[0],y=f[1],p=f[2];e=Math.min(d,e),i=Math.max(d,i),r=Math.min(y,r),a=Math.max(y,a),n=Math.min(p,n),o=Math.max(p,o)}}catch(t){u=!0,c=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw c}}return this.minimum.set(e,r,n),this.maximum.set(i,a,o),this.center.copy(this.minimum).add(this.maximum).scale(.5),this}},{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}},{key:"intersectPlane",value:function(t){var e=Ua.copy(this.maximum).subtract(this.minimum).scale(.5),r=qa.from(t.normal),n=e.x*Math.abs(r.x)+e.y*Math.abs(r.y)+e.z*Math.abs(r.z),i=this.center.dot(r)+t.distance;return i-n>0?oa.INSIDE:i+n<0?oa.OUTSIDE:oa.INTERSECTING}}])}(),new Ta),Ga=new Ta,Wa=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;V(this,t),this.radius=-0,this.center=new Ta,this.fromCenterRadius(e,r)}return U(t,[{key:"fromCenterRadius",value:function(t,e){return this.center.from(t),this.radius=e,this}},{key:"fromCornerPoints",value:function(t,e){return e=za.from(e),this.center=(new Ta).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(t){var e=this.center,r=this.radius,n=t.center,i=t.radius,a=za.copy(n).subtract(e),o=a.magnitude();if(r>=o+i)return this.clone();if(i>=o+r)return t.clone();var s=.5*(r+o+i);return Ga.copy(a).scale((-r+s)/o).add(e),this.center.copy(Ga),this.radius=s,this}},{key:"expand",value:function(t){var e=(t=za.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}},{key:"intersectPlane",value:function(t){var e=this.center,r=this.radius,n=t.normal.dot(e)+t.distance;return n<-r?oa.OUTSIDE:n<r?oa.INTERSECTING:oa.INSIDE}},{key:"transform",value:function(t){this.center.transform(t);var e=st(za,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(t){return(t=za.from(t)).subtract(this.center).lengthSquared()-this.radius*this.radius}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}}]),t}(),Ha=new ja,Za=new ja,Ka=new ja,Ya=new ja,Qa=new ja;function Ja(t){for(var e=0,r=0;r<9;++r){var n=t[r];e+=n*n}return Math.sqrt(e)}var Xa=[1,0,0],$a=[2,2,1];function to(t){for(var e=0,r=0;r<3;++r){var n=t[Ha.getElementIndex($a[r],Xa[r])];e+=2*n*n}return Math.sqrt(e)}function eo(t,e){for(var r=Ba,n=0,i=1,a=0;a<3;++a){var o=Math.abs(t[Ha.getElementIndex($a[a],Xa[a])]);o>n&&(i=a,n=o)}var s=Xa[i],u=$a[i],c=1,h=0;if(Math.abs(t[Ha.getElementIndex(u,s)])>r){var l,f=(t[Ha.getElementIndex(u,u)]-t[Ha.getElementIndex(s,s)])/2/t[Ha.getElementIndex(u,s)];h=(l=f<0?-1/(-f+Math.sqrt(1+f*f)):1/(f+Math.sqrt(1+f*f)))*(c=1/Math.sqrt(1+l*l))}return ja.IDENTITY.to(e),e[Ha.getElementIndex(s,s)]=e[Ha.getElementIndex(u,u)]=c,e[Ha.getElementIndex(u,s)]=h,e[Ha.getElementIndex(s,u)]=-h,e}var ro=new Ta,no=new Ta,io=new Ta,ao=new Ta,oo=new Ta,so=new ja,uo={diagonal:new ja,unitary:new ja};function co(t,e){if(!t||0===t.length)return e.halfAxes=new ja([0,0,0,0,0,0,0,0,0]),e.center=new Ta,e;var r=t.length,n=new Ta(0,0,0),i=!0,a=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;n.add(c)}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}var h=1/r;n.multiplyByScalar(h);var l=0,f=0,d=0,y=0,p=0,v=0,g=!0,m=!1,b=void 0;try{for(var w,k=t[Symbol.iterator]();!(g=(w=k.next()).done);g=!0){var x=w.value,_=ro.copy(x).subtract(n);l+=_.x*_.x,f+=_.x*_.y,d+=_.x*_.z,y+=_.y*_.y,p+=_.y*_.z,v+=_.z*_.z}}catch(t){m=!0,b=t}finally{try{g||null==k.return||k.return()}finally{if(m)throw b}}l*=h,f*=h,d*=h,y*=h,p*=h,v*=h;var T=so;T[0]=l,T[1]=f,T[2]=d,T[3]=f,T[4]=y,T[5]=p,T[6]=d,T[7]=p,T[8]=v;var O=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Va,n=10,i=0,a=0,o=Za,s=Ka;o.identity(),s.copy(t);for(var u=r*Ja(s);a<n&&to(s)>u;)eo(s,Ya),Qa.copy(Ya).transpose(),s.multiplyRight(Ya),s.multiplyLeft(Qa),o.multiplyRight(Ya),++i>2&&(++a,i=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=s.toTarget(e.diagonal),e}(T,uo).unitary,S=e.halfAxes.copy(O),M=S.getColumn(0,io),E=S.getColumn(1,ao),P=S.getColumn(2,oo),L=-Number.MAX_VALUE,A=-Number.MAX_VALUE,j=-Number.MAX_VALUE,N=Number.MAX_VALUE,I=Number.MAX_VALUE,R=Number.MAX_VALUE,C=!0,D=!1,B=void 0;try{for(var V,F=t[Symbol.iterator]();!(C=(V=F.next()).done);C=!0){var U=V.value;L=Math.max(U.dot(M),L),A=Math.max(U.dot(E),A),j=Math.max(U.dot(P),j),N=Math.min(U.dot(M),N),I=Math.min(U.dot(E),I),R=Math.min(U.dot(P),R)}}catch(t){D=!0,B=t}finally{try{C||null==F.return||F.return()}finally{if(D)throw B}}M=M.multiplyByScalar(.5*(N+L)),E=E.multiplyByScalar(.5*(I+A)),P=P.multiplyByScalar(.5*(R+j)),e.center.copy(M).add(E).add(P);var q=no.set(L-N,A-I,j-R).multiplyByScalar(.5);return e.halfAxes.multiplyByScalar(q),e}var ho=new Ta,lo=new Ta,fo=new Ta,yo=new Ta,po=new Ta,vo=new Ta,go=new Ta,mo=new Ta,bo=new Ta,wo=new Ta,ko=new Ta,xo=0,_o=1,To=2,Oo=3,So=4,Mo=5,Eo=6,Po=7,Lo=8,Ao=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];V(this,t),this.center=(new Ta).from(e),this.halfAxes=new ja(r)}return U(t,[{key:"clone",value:function(e){return new t(this.center,this.halfAxes)}},{key:"fromPoints",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;return co(e,r)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wa,e=this.halfAxes,r=e.getColumn(0,bo),n=e.getColumn(1,wo),i=e.getColumn(2,ko),a=ho.copy(r).add(n).add(i);return t.center.copy(this.center),t.radius=a.magnitude(),t}},{key:"intersectPlane",value:function(t){var e=this.center,r=t.normal,n=this.halfAxes,i=r.x,a=r.y,o=r.z,s=Math.abs(i*n[xo]+a*n[_o]+o*n[To])+Math.abs(i*n[Oo]+a*n[So]+o*n[Mo])+Math.abs(i*n[Eo]+a*n[Po]+o*n[Lo]),u=r.dot(e)+t.distance;return u<=-s?oa.OUTSIDE:u>=s?oa.INSIDE:oa.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e=lo.from(t).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,fo),i=r.getColumn(1,yo),a=r.getColumn(2,po),o=n.magnitude(),s=i.magnitude(),u=a.magnitude();n.normalize(),i.normalize(),a.normalize();var c=vo;c.x=e.dot(n),c.y=e.dot(i),c.z=e.dot(a);var h,l=0;return c.x<-o?l+=(h=c.x+o)*h:c.x>o&&(l+=(h=c.x-o)*h),c.y<-s?l+=(h=c.y+s)*h:c.y>s&&(l+=(h=c.y-s)*h),c.z<-u?l+=(h=c.z+u)*h:c.z>u&&(l+=(h=c.z-u)*h),l}},{key:"computePlaneDistances",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[],[]],n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=this.center,o=this.halfAxes,s=o.getColumn(0,fo),u=o.getColumn(1,yo),c=o.getColumn(2,po),h=go.copy(s).add(u).add(c).add(a),l=mo.copy(h).subtract(t),f=e.dot(l);return n=Math.min(f,n),i=Math.max(f,i),h.copy(a).add(s).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(a).add(s).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(a).add(s).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).add(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),r.start=n,r.stop=i,r}},{key:"getTransform",value:function(){}}]),t}(),jo=new Ta,No=new Ta,Io=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;V(this,t),this.normal=new Ta,this.distance=-0,this.fromNormalDistance(e,r)}return U(t,[{key:"fromNormalDistance",value:function(t,e){return ha(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}},{key:"fromPointNormal",value:function(t,e){t=jo.from(t),this.normal.from(e).normalize();var r=-this.normal.dot(t);return this.distance=r,this}},{key:"fromCoefficients",value:function(t,e,r,n){return this.normal.set(t,e,r),ha(pa(this.normal.len(),1)),this.distance=n,this}},{key:"clone",value:function(e){return new t(this.normal,this.distance)}},{key:"equals",value:function(t){return pa(this.distance,t.distance)&&pa(this.normal,t.normal)}},{key:"getPointDistance",value:function(t){return this.normal.dot(t)+this.distance}},{key:"transform",value:function(t){var e=No.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}},{key:"projectPointOntoPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];t=jo.from(t);var r=this.getPointDistance(t),n=No.copy(this.normal).scale(r);return t.subtract(n).to(e)}}]),t}(),Ro=[new Ta([1,0,0]),new Ta([0,1,0]),new Ta([0,0,1])],Co=new Ta,Do=new Ta,Bo=(new Io(new Ta(1,0,0),0),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];V(this,t),this.planes=e,ha(this.planes.every((function(t){return t instanceof Io})))}return U(t,null,[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),U(t,[{key:"fromBoundingSphere",value:function(t){this.planes.length=2*Ro.length;var e=t.center,r=t.radius,n=0,i=!0,a=!1,o=void 0;try{for(var s,u=Ro[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value,h=this.planes[n],l=this.planes[n+1];h||(h=this.planes[n]=new Io),l||(l=this.planes[n+1]=new Io);var f=Co.copy(c).scale(-r).add(e);c.dot(f);h.fromPointNormal(f,c);var d=Co.copy(c).scale(r).add(e),y=Do.copy(c).negate();y.dot(d);l.fromPointNormal(d,y),n+=2}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return this}},{key:"computeVisibility",value:function(t){ha(t);var e=oa.INSIDE,r=!0,n=!1,i=void 0;try{for(var a,o=this.planes[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;switch(t.intersectPlane(s)){case oa.OUTSIDE:return oa.OUTSIDE;case oa.INTERSECTING:e=oa.INTERSECTING}}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return e}},{key:"computeVisibilityWithPlaneMask",value:function(e,r){if(ha(e,"boundingVolume is required."),ha(Number.isFinite(r),"parentPlaneMask is required."),r===t.MASK_OUTSIDE||r===t.MASK_INSIDE)return r;for(var n=t.MASK_INSIDE,i=this.planes,a=0;a<this.planes.length;++a){var o=a<31?1<<a:0;if(!(a<31&&0==(r&o))){var s=i[a],u=e.intersectPlane(s);if(u===oa.OUTSIDE)return t.MASK_OUTSIDE;u===oa.INTERSECTING&&(n|=o)}}return n}}]),t}());function Vo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Fo(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Uo(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Fo(r,!0).forEach((function(e){Vo(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Fo(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var qo=new Ta,zo=new Ta,Go=new Ta,Wo=new Ta,Ho=new Ta,Zo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V(this,t),e=Uo({near:1,far:5e8},e),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new Bo([new Io,new Io,new Io,new Io,new Io,new Io]),this._perspectiveMatrix=new Da,this._infinitePerspective=new Da}return U(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"computeCullingVolume",value:function(t,e,r){ha(t,"position is required."),ha(e,"direction is required."),ha(r,"up is required.");var n=this._cullingVolume.planes;r=qo.copy(r).normalize();var i=zo.copy(e).cross(r).normalize(),a=Go.copy(e).multiplyByScalar(this.near).add(t),o=Wo.copy(e).multiplyByScalar(this.far).add(t),s=Ho;return s.copy(i).multiplyByScalar(this.left).add(a).subtract(t).cross(r),n[0].fromPointNormal(t,s),s.copy(i).multiplyByScalar(this.right).add(a).subtract(t).cross(r).negate(),n[1].fromPointNormal(t,s),s.copy(r).multiplyByScalar(this.bottom).add(a).subtract(t).cross(i).negate(),n[2].fromPointNormal(t,s),s.copy(r).multiplyByScalar(this.top).add(a).subtract(t).cross(i),n[3].fromPointNormal(t,s),s=(new Ta).copy(e),n[4].fromPointNormal(a,s),s.negate(),n[5].fromPointNormal(o,s),this._cullingVolume}},{key:"getPixelDimensions",value:function(t,e,r,n){Ko(this),ha(Number.isFinite(t)&&Number.isFinite(e)),ha(t>0),ha(e>0),ha(r>0),ha(n);var i=1/this.near,a=this.top*i,o=2*r*a/e,s=2*r*(a=this.right*i)/t;return n.x=s,n.y=o,n}},{key:"projectionMatrix",get:function(){return Ko(this),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return Ko(this),this._infinitePerspective}}]),t}();function Ko(t){ha(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t.top,r=t.bottom,n=t.right,i=t.left,a=t.near,o=t.far;e===t._top&&r===t._bottom&&i===t._left&&n===t._right&&a===t._near&&o===t._far||(ha(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=i,t._right=n,t._top=e,t._bottom=r,t._near=a,t._far=o,t._perspectiveMatrix=(new Da).frustum({left:i,right:n,bottom:r,top:e,near:a,far:o}),t._infinitePerspective=(new Da).frustum({left:i,right:n,bottom:r,top:e,near:a,far:1/0}))}function Yo(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Qo(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Yo(r,!0).forEach((function(e){Vo(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Yo(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}!function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V(this,t),e=Qo({near:1,far:5e8,xOffset:0,yOffset:0},e),this._offCenterFrustum=new Zo,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this.xOffset=e.xOffset,this._xOffset=this.xOffset,this.yOffset=e.yOffset,this._yOffset=this.yOffset}U(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return null!=e&&e instanceof t&&(Jo(this),Jo(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"computeCullingVolume",value:function(t,e,r){return Jo(this),this._offCenterFrustum.computeCullingVolume(t,e,r)}},{key:"getPixelDimensions",value:function(t,e,r,n){return Jo(this),this._offCenterFrustum.getPixelDimensions(t,e,r,n)}},{key:"projectionMatrix",get:function(){return Jo(this),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return Jo(this),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return Jo(this),this._fovy}},{key:"sseDenominator",get:function(){return Jo(this),this._sseDenominator}}])}();function Jo(t){ha(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(ha(t.fov>=0&&t.fov<Math.PI),ha(t.aspectRatio>0),ha(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new Ta,new Ta,new Ta,new Ta,new Ta,new Ta,new Ta,new Ta,new Ta,new Ta,new Ta,new Ta,Math.PI;var Xo=new Qe,$o=new Qe,ts=new Bo([new Io,new Io,new Io,new Io,new Io,new Io]);function es(t,e){var r=t.cameraDirection,n=t.cameraUp,i=t.height,a=t.distanceScales.metersPerUnit,o=[t.longitude,t.latitude,0],s=Zi.WGS84.cartographicToCartesian(o,new Qe),u=Zi.WGS84.eastNorthUpToFixedFrame(s),c=t.unprojectPosition(t.cameraPosition),h=Zi.WGS84.cartographicToCartesian(c,new Qe),l=new Qe(u.transformAsVector(new Qe(r).scale(a))).normalize(),f=new Qe(u.transformAsVector(new Qe(n).scale(a))).normalize();return function(t,e){var r=t.getFrustumPlanes(),n=0;for(var i in r){var a=r[i],o=a.normal.dot(t.center);$o.copy(a.normal).scale(a.distance-o).add(t.center);var s=t.unprojectPosition($o),u=Zi.WGS84.cartographicToCartesian(s,new Qe);ts.planes[n++].fromPointNormal(u,Xo.copy(e).subtract(u))}}(t,s),{camera:{position:h,direction:l,up:f},viewport:t,height:i,cullingVolume:ts,frameNumber:e,sseDenominator:1.15}}var rs=new Qe;var ns=0,is=1,as=3,os=4,ss=5,us=1,cs=2,hs="empty",ls="scenegraph",fs="pointcloud",ds="mesh",ys="I3S",ps="TILES3D",vs="geometricError",gs=1;function ms(t){throw new Error('"'+t+'" is read-only')}function bs(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],d=r[1],y=r[2],p=r[3],v=r[4],g=r[5],m=r[6],b=r[7],w=r[8];return t[0]=f*n+d*o+y*c,t[1]=f*i+d*s+y*h,t[2]=f*a+d*u+y*l,t[3]=p*n+v*o+g*c,t[4]=p*i+v*s+g*h,t[5]=p*a+v*u+g*l,t[6]=m*n+b*o+w*c,t[7]=m*i+b*s+w*h,t[8]=m*a+b*u+w*l,t}function ws(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}var ks=Object.freeze([1,0,0,0,1,0,0,0,1]),xs=Object.freeze([0,0,0,0,0,0,0,0,0]),_s=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),Ts={},Os=function(t){function e(t){var r;return re(this,e),r=oe(this,se(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return ce(e,t),ie(e,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return _s}}],[{key:"IDENTITY",get:function(){return Ts.IDENTITY=Ts.IDENTITY||Object.freeze(new e(ks)),Ts.IDENTITY}},{key:"ZERO",get:function(){return Ts.ZERO=Ts.ZERO||Object.freeze(new e(xs)),Ts.ZERO}}]),ie(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=n,this[2]=o,this[3]=e,this[4]=i,this[5]=s,this[6]=r,this[7]=a,this[8]=u,this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],e*(c*a-o*u)+r*(-c*i+o*s)+n*(u*i-a*s);var t,e,r,n,i,a,o,s,u,c}},{key:"identity",value:function(){return this.copy(ks)}},{key:"fromQuaternion",value:function(t){return function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,c=r*o,h=n*o,l=n*s,f=i*o,d=i*s,y=i*u,p=a*o,v=a*s,g=a*u;t[0]=1-l-y,t[3]=h-g,t[6]=f+v,t[1]=h+g,t[4]=1-c-y,t[7]=d-p,t[2]=f-v,t[5]=d+p,t[8]=1-c-l}(this,t),this.check()}},{key:"transpose",value:function(){return function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=h*o-s*c,f=-h*a+s*u,d=c*a-o*u,y=r*l+n*f+i*d;y&&(y=1/y,t[0]=l*y,t[1]=(-h*n+i*c)*y,t[2]=(s*n-i*o)*y,t[3]=f*y,t[4]=(h*r-i*u)*y,t[5]=(-s*r+i*a)*y,t[6]=d*y,t[7]=(-c*r+n*u)*y,t[8]=(o*r-n*a)*y)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return bs(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return bs(this,this,t),this.check()}},{key:"rotate",value:function(t){return function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=Math.sin(r),d=Math.cos(r);t[0]=d*n+f*o,t[1]=d*i+f*s,t[2]=d*a+f*u,t[3]=d*o-f*n,t[4]=d*s-f*i,t[5]=d*u-f*a,t[6]=c,t[7]=h,t[8]=l}(this,this,t),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?ws(this,this,t):ws(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],d=r[1];t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=f*n+d*o+c,t[7]=f*i+d*s+h,t[8]=f*a+d*u+l}(this,this,t),this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=Re(e||[-0,-0],t,this);break;case 3:e=Ze(e||[-0,-0,-0],t,this);break;case 4:e=function(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n+r[3]*i+r[6]*a,t[1]=r[1]*n+r[4]*i+r[7]*a,t[2]=r[2]*n+r[5]*i+r[8]*a,t[3]=e[3],t}(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Le(e,t.length),e}},{key:"transformVector",value:function(t,e){return je("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return je("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return je("Matrix3.transformVector"),this.transform(t,e)}}]),e}(Xe);function Ss(t){return null!=t}new Os;var Ms=new Qe,Es=new Qe,Ps=new Qe;new hr;function Ls(t,e,r){if(Ur(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,r){var n=new Qe(t[0],t[1],t[2]);e.transform(n,n);var i=e.transformAsVector(t.slice(3,6)),a=e.transformAsVector(t.slice(6,9)),o=e.transformAsVector(t.slice(9,12)),s=new Os([i[0],i[1],i[2],a[0],a[1],a[2],o[0],o[1],o[2]]);if(Ss(r))return r.center=n,r.halfAxes=s,r;return new Ao(n,s)}(t.box,e,r);if(t.region){var n=Je(t.region,6),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],h=Zi.WGS84.cartographicToCartesian([Te(i),Te(s),u],Es),l=Zi.WGS84.cartographicToCartesian([Te(o),Te(a),c],Ps),f=(new Qe).addVectors(h,l).multiplyScalar(.5),d=(new Qe).subVectors(h,l).len()/2;return As([f[0],f[1],f[2],d],new hr)}if(t.sphere)return As(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function As(t,e,r){var n=new Qe(t[0],t[1],t[2]);e.transform(n,n);var i=e.getScale(Ms),a=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*a;return Ss(r)?(r.center=n,r.radius=o,r):new Wa(n,o)}new Qe,new Qe,new hr,new Qe,new Qe,new Qe;function js(t,e){if(t.dynamicScreenSpaceError&&t._dynamicScreenSpaceErrorComputedDensity){var r=t._dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor;return function(t,e){var r=t*e;return 1-Math.exp(-r*r)}(e,r)*n}return 0}var Ns=Math.PI/2;function Is(t){var e=Je(t,3),r=e[0],n=e[1],i=e[2],a=xe(r),o=xe(n),s=1+i/6378137,u=s*Math.cos(o);return[r=u*Math.cos(a),n=u*Math.sin(a),i=s*Math.sin(o)]}function Rs(t,e){var r=Je(t,3),n=r[0],i=r[1],a=r[2],o=void 0===a?0:a,s=Je(e,3),u=s[0],c=s[1],h=s[2],l=Is([u,c,void 0===h?0:h]),f=Is([n,i,o]),d=f[0]-l[0],y=f[1]-l[1],p=f[2]-l[2];return d*d+y*y+p*p}function Cs(t,e){var r=e.viewport,n=t.header.mbs[1],i=[t.header.mbs[0],n,t.header.mbs[2]],a=t.header.mbs[3]/6378137,o=Rs(r.unprojectPosition(r.cameraPosition),i)-a*a;if(o<=0)return 170141175e30;var s=function(t,e){var r=e.viewport,n=r.width,i=r.height,a=r.pixelProjectionMatrix,o=Math.tan(Math.atan(Math.sqrt(1/(a[0]*a[0])+1/(a[5]*a[5]))));return Math.sqrt(i*i+n*n)/o}(0,e);return s*=a/Math.sqrt(o)/r.scale}function Ds(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Bs(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ds(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ds(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Vs=new Qe;function Fs(t){return t.isVisible?t.contentState===ns?-1:Math.max(1e7-t._priority,0)||0:-1}var Us=function(){function t(e,r,n){re(this,t),Ur("object"===ae(r)),this.header=r,this.tileset=e,this.id=r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=ns,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}var e;return ie(t,[{key:"destroy",value:function(){this.header=null}},{key:"isDestroyed",value:function(){return null===this.header}},{key:"getScreenSpaceError",value:function(t,e){switch(this.tileset.type){case ys:return Cs(this,t);case ps:return function(t,e,r){var n=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,a=r?i:t.lodMetricValue;if(0===a)return 0;var o=Math.max(t._distanceToCamera,1e-7),s=a*e.height/(o*e.sseDenominator);return s-=js(n,o)}(this,t,e);default:return console.error("Unsupported tileset type"),null}}},{key:"loadContent",value:(e=Pr(xr.a.mark((function t(){var e,r,i,a;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.hasEmptyContent){t.next=2;break}return t.abrupt("return",!1);case 2:if(!this.content){t.next=4;break}return t.abrupt("return",!0);case 4:return this.contentExpired&&(this._expireDate=null),this.contentState=is,t.next=9,this.tileset._requestScheduler.scheduleRequest(this,Fs);case 9:if(t.sent){t.next=13;break}return this.contentState=ns,t.abrupt("return",!1);case 13:return t.prev=13,e=this.tileset.getTileUrl(this.contentUrl),this.tileset._requestScheduler.startRequest(this),r=this.tileset.fetchOptions,i=this.tileset.loader,a=Bs({},r,Kr({},i.id,{tile:this.header,tileset:this.tileset.tileset})),t.next=21,ki(e,i,a);case 21:return this.content=t.sent,this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,n.dirname(this.contentUrl)),this.contentState=as,this._onContentLoaded(),t.abrupt("return",!0);case 28:throw t.prev=28,t.t0=t.catch(13),this.contentState=ss,t.t0;case 32:return t.prev=32,this.tileset._requestScheduler.endRequest(this),t.finish(32);case 35:case"end":return t.stop()}}),t,this,[[13,28,32,35]])}))),function(){return e.apply(this,arguments)})},{key:"unloadContent",value:function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.contentState=ns,!0}},{key:"updateVisibility",value:function(t){if(this._frameNumber!==t.frameNumber){var e=this.parent,r=e?e.computedTransform:this.tileset.modelMatrix,n=e?e._visibilityPlaneMask:Bo.MASK_INDETERMINATE;this._updateTransform(r),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,n),this._visible=this._visibilityPlaneMask!==Bo.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._priority=this.lodMetricValue,this._frameNumber=t.frameNumber}}},{key:"visibility",value:function(t,e){var r=t.cullingVolume,n=this.boundingVolume;return r.computeVisibilityWithPlaneMask(n,e)}},{key:"contentVisibility",value:function(t){return!0}},{key:"distanceToTile",value:function(t){var e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}},{key:"cameraSpaceZDepth",value:function(t){var e=t.camera,r=this.boundingVolume;return Vs.subVectors(r.center,e.position),e.direction.dot(Vs)}},{key:"insideViewerRequestVolume",value:function(t){var e=this._viewerRequestVolume;return!e||0===e.distanceToCamera(t)}},{key:"_initializeLodMetric",value:function(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}},{key:"_initializeTransforms",value:function(t){this.transform=t.transform?new hr(t.transform):new hr;var e=this.parent,r=this.tileset,n=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new hr(n).multiplyRight(this.transform);var i=e&&e._initialTransform?e._initialTransform.clone():new hr;this._initialTransform=new hr(i).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}},{key:"_initializeContent",value:function(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ns,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}},{key:"_initializeRenderingState",value:function(t){this.depth=t.level,this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Bo.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}},{key:"_getRefine",value:function(t){return t||this.parent&&this.parent.refine||cs}},{key:"_isTileset",value:function(){return-1!==this.contentUrl.indexOf(".json")}},{key:"_onContentLoaded",value:function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}},{key:"_updateBoundingVolume",value:function(t){this.boundingVolume=Ls(t.boundingVolume,this.computedTransform,this.boundingVolume);var e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=Ls(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Ls(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}},{key:"_updateTransform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hr,e=t.clone().multiplyRight(this.transform),r=!e.equals(this.computedTransform);r&&(this.computedTransform=e,this._updateBoundingVolume(this.header))}},{key:"updateExpiration",value:function(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){var t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=os,this._expiredContent=this.content)}}},{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return this.contentState===as||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this.contentState===ns}},{key:"contentExpired",get:function(){return this.contentState===os}},{key:"contentFailed",get:function(){return this.contentState===ss}},{key:"extras",get:function(){return this.header.extras}}]),t}(),qs=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;re(this,t),this._array=new Array(e),this._map=new Map,this._length=e}return ie(t,[{key:"get",value:function(t){return Ur(t<this._array.length),this._array[t]}},{key:"set",value:function(t,e){Ur(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}},{key:"delete",value:function(t){var e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(t){if(!this._map.has(t)){var e=this.length++;this._array[e]=t,this._map.set(t,e)}}},{key:"pop",value:function(){var t=this._array[--this.length];return this._map.delete(t),t}},{key:"reserve",value:function(t){Ur(t>=0),t>this._array.length&&(this._array.length=t)}},{key:"resize",value:function(t){Ur(t>=0),this.length=t}},{key:"trim",value:function(t){null==t&&(t=this.length),this._array.length=t}},{key:"reset",value:function(){this._array=[],this._map=new Map,this._length=0}},{key:"find",value:function(t){return this._map.has(t)}},{key:"length",get:function(){return this._length},set:function(t){this._length=t,t>this._array.length&&(this._array.length=t)}},{key:"values",get:function(){return this._array}}]),t}();function zs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Gs(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?zs(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):zs(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Ws={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2},Hs=function(){function t(e){re(this,t),this.options=Gs({},Ws,{},e),this._traversalStack=new qs,this._emptyTraversalStack=new qs,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}return ie(t,[{key:"traverse",value:function(t,e,r){this.root=t,this.options=Gs({},this.options,{},r),this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}},{key:"reset",value:function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}},{key:"executeTraversal",value:function(t,e){var r=this._traversalStack;for(r.push(t);r.length>0;){var n=r.pop(),i=!1;this.canTraverse(n,e)&&(this.updateChildTiles(n,e),i=this.updateAndPushChildren(n,e,r));var a=n.parent,o=Boolean(!a||a._shouldRefine),s=!i;n.hasRenderContent?n.refine===us?(this.loadTile(n,e),this.selectTile(n,e)):n.refine===cs&&(this.loadTile(n,e),s&&this.selectTile(n,e)):(this.emptyTiles[n.id]=n,this.loadTile(n,e),s&&this.selectTile(n,e)),this.touchTile(n,e),n._shouldRefine=i&&o}}},{key:"updateChildTiles",value:function(t,e){var r=t.children,n=!0,i=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;this.updateTile(u,e)}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return!0}},{key:"updateAndPushChildren",value:function(t,e,r){var n=this.options,i=n.loadSiblings,a=n.skipLevelOfDetail,o=t.children;o.sort(this.compareDistanceToCamera);var s=!a&&t.refine===cs&&t.hasRenderContent,u=!1,c=!0,h=!1,l=void 0;try{for(var f,d=o[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value;if(y.isVisibleAndInRequestVolume?(r.find(y)&&r.delete(y),r.push(y),u=!0):(s||i)&&(this.loadTile(y,e),this.touchTile(y,e)),s){var p=void 0;if(!(p=!!y._inRequestVolume&&(y.hasRenderContent?y.contentAvailable:this.executeEmptyTraversal(y,e))))return p}}}catch(t){h=!0,l=t}finally{try{c||null==d.return||d.return()}finally{if(h)throw l}}return u}},{key:"updateTile",value:function(t,e){this.updateTileVisibility(t,e)}},{key:"selectTile",value:function(t,e){this.shouldSelectTile(t,e)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}},{key:"loadTile",value:function(t,e){this.shouldLoadTile(t,e)&&(t._requestedFrame=e.frameNumber,t._priority=this.getPriority(t),this.requestedTiles[t.id]=t)}},{key:"touchTile",value:function(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}},{key:"canTraverse",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!(!n&&!t.isVisibleAndInRequestVolume)&&(!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,e,r)))}},{key:"shouldLoadTile",value:function(t,e){return t.hasUnloadedContent||t.contentExpired}},{key:"shouldSelectTile",value:function(t,e){return t.contentAvailable&&!this.options.skipLevelOfDetail}},{key:"shouldRefine",value:function(t,e,r){var n=t._screenSpaceError;return r&&(n=t.getScreenSpaceError(e,!0)),n>this.options.maximumScreenSpaceError}},{key:"updateTileVisibility",value:function(t,e){t.updateVisibility(e)}},{key:"compareDistanceToCamera",value:function(t,e){return t._distanceToCamera-e._distanceToCamera}},{key:"getPriority",value:function(t){var e=this.options;switch(t.refine){case us:return t._distanceToCamera;case cs:var r=t.parent,n=r&&(!e.skipLevelOfDetail||0===t._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:t._screenSpaceError;return this.root._screenSpaceError-n;default:return Ur(!1)}}},{key:"anyChildrenVisible",value:function(t,e){var r=!1,n=!0,i=!1,a=void 0;try{for(var o,s=t.children[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;u.updateVisibility(e),r=r||u.isVisibleAndInRequestVolume}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}},{key:"executeEmptyTraversal",value:function(t,e){for(var r=!0,n=this._emptyTraversalStack;n.length>0;){var i=n.pop();this.updateTile(i,e),i.isVisibleAndInRequestVolume||(this.loadTile(i,e),this.touchTile(i,e));var a=!i.hasRenderContent&&this.canTraverse(i,e,!1,!0);if(a||i.contentAvailable||(r=!1),a){var o=i.children.filter((function(t){return t})),s=!0,u=!1,c=void 0;try{for(var h,l=o[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var f=h.value;n.find(f)&&n.delete(f),n.push(f)}}catch(t){u=!0,c=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw c}}}}return r}}]),t}(),Zs=function(t){function e(){return re(this,e),oe(this,se(e).apply(this,arguments))}return ce(e,t),ie(e,[{key:"compareDistanceToCamera",value:function(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}},{key:"updateTileVisibility",value:function(t,e){if(t.updateVisibility(e),t.isVisibleAndInRequestVolume){var r=t.children.length>0;if(t.hasTilesetContent&&r){var n=t.children[0];return this.updateTileVisibility(n,e),void(t._visible=n._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))t._visible=!1;else{var i=t.refine===cs,a=t._optimChildrenWithinParent===gs;i&&a&&r&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}}}},{key:"meetsScreenSpaceErrorEarly",value:function(t,e){var r=t.parent;return!(!r||r.hasTilesetContent||r.refine!==us)&&!this.shouldRefine(t,e,!0)}}]),e}(Hs),Ks="REQUESTED",Ys="COMPLETED",Qs="ERROR",Js=function(){function t(){re(this,t),this._statusMap={}}return ie(t,[{key:"add",value:function(t,e,r,n){var i=this;this._statusMap[e]||(this._statusMap[e]={request:t,callback:r,key:e,options:n,status:Ks},t().then((function(t){i._statusMap[e].status=Ys,i._statusMap[e].callback(t,n)})).catch((function(t){i._statusMap[e].status=Qs,r(t)})))}},{key:"update",value:function(t,e){this._statusMap[t]&&(this._statusMap[t].options=e)}},{key:"find",value:function(t){return this._statusMap[t]}}]),t}();function Xs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function $s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xs(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xs(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var tu=function(t){function e(t){var r;return re(this,e),(r=oe(this,se(e).call(this,t)))._tileManager=new Js,r}var r;return ce(e,t),ie(e,[{key:"shouldRefine",value:function(t,e){return t._lodJudge=function(t,e){var r=e.viewport,n=r.metersPerPixel,i=t.header.mbs[1],a=t.header.mbs[0],o=t.header.mbs[2],s=t.header.mbs[3],u=r.height,c=r.width,h=r.latitude,l=r.longitude,f=[l,h],d=[a,i,o],y=[l,i],p=[a,h],v=Math.sqrt(u*u+c*c)*n[0],g=.5*u+s/6378137,m=.5*c+s/6378137;if(Rs(f,d)>v+s/6378137)return"OUT";if(Rs(f,y)>g)return"OUT";if(Rs(f,p)>m)return"OUT";if(0===t.lodMetricValue)return"DIG";var b=Cs(t,e);return(b*=Ns)<.5?"OUT":!t.header.children||b<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}},{key:"updateChildTiles",value:function(t,e){var r=this,n=t.header.children||[],i=t.children,a=t.tileset,o=!0,s=!1,u=void 0;try{for(var c,h=function(){var n=c.value,o=i&&i.find((function(t){return t.id===n.id}));if(o)o&&r.updateTile(o,e);else{r._tileManager.find(n.id)?r._tileManager.update(n.id,{frameNumber:e.frameNumber}):r._tileManager.add((function(){return r._loadTile(n.id,a)}),n.id,(function(n){return r._onTileLoad(n,t,e)}),{frameNumber:e.frameNumber})}},l=n[Symbol.iterator]();!(o=(c=l.next()).done);o=!0)h()}catch(t){s=!0,u=t}finally{try{o||null==l.return||l.return()}finally{if(s)throw u}}}},{key:"_loadTile",value:(r=Pr(xr.a.mark((function t(e,r){var n,i,a;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.loader,i=r.getTileUrl("".concat(r.url,"/nodes/").concat(e)),a={i3s:$s({},r.fetchOptions,{isHeader:!0,loadContent:!1})},t.next=5,ki(i,n,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),function(t,e){return r.apply(this,arguments)})},{key:"_onTileLoad",value:function(t,e,r){var n=this.options.basePath,i=new Us(e.tileset,t,e,n);e.children.push(i),this.updateTile(i,r),this._frameNumber===r.frameNumber&&this.executeTraversal(i,r)}}]),e}(Hs);function eu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ru(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?eu(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):eu(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var nu={ellipsoid:Zi.WGS84,modelMatrix:new hr,throttleRequests:!1,maximumMemoryUsage:32,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(t,e,r){},maximumScreenSpaceError:8},iu=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};re(this,t),Ur(e),this.options=ru({},nu,{},r),this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||n.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new aa,this._requestScheduler=new ea({throttleRequests:this.options.throttleRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new Qi({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this._initializeTileSet(e,this.options)}var e;return ie(t,[{key:"isLoaded",value:function(){return 0===this._pendingCount}},{key:"destroy",value:function(){this._destroy()}},{key:"update",value:function(t){this._cache.reset(),this._frameNumber++;var e=es(t,this._frameNumber);this._traverser.traverse(this.root,e,this.options);var r=Object.values(this._traverser.selectedTiles);this._tilesChanged(this.selectedTiles,r)&&this._updateFrameNumber++,this.selectedTiles=r;var n=!0,i=!1,a=void 0;try{for(var o,s=this.selectedTiles[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;this._tiles[u.id]=u}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return this._requestedTiles=Object.values(this._traverser.requestedTiles),this._emptyTiles=Object.values(this._traverser.emptyTiles),this._loadTiles(e),this._unloadTiles(),this._updateStats(),this._updateFrameNumber}},{key:"getTileUrl",value:function(t){return t.startsWith("data:")?t:"".concat(t).concat(this.queryParams)}},{key:"_tilesChanged",value:function(t,e){if(t.length!==e.length)return!0;var r=new Set(t.map((function(t){return t.id}))),n=new Set(e.map((function(t){return t.id}))),i=t.filter((function(t){return!n.has(t.id)})).length>0;return i=i||e.filter((function(t){return!r.has(t.id)})).length>0}},{key:"_loadTiles",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,a=this._requestedTiles[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;this._loadTile(o,t)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,(function(t,e){return t._unloadTile(e)}))}},{key:"_updateStats",value:function(){var t=0,e=0,r=!0,n=!1,i=void 0;try{for(var a,o=this.selectedTiles[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;s.contentAvailable&&(t++,s.content.pointCount&&(e+=s.content.pointCount))}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=t,this.stats.get("Points").count=e}},{key:"_initializeTileSet",value:function(t){this.root=this._initializeTileHeaders(t,null,this.basePath),this.type===ps&&this._initializeCesiumTileset(t),this.type===ys&&this._initializeI3STileset(t),this._calculateViewProps()}},{key:"_calculateViewProps",value:function(){var t=this.root,e=t.boundingVolume.center;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Qe,void(this.zoom=1);this.cartographicCenter=Zi.WGS84.cartesianToCartographic(e,new Qe),this.cartesianCenter=e,this.zoom=function(t){var e=t.halfAxes,r=t.radius,n=t.width,i=t.height;if(e){e.getColumn(0,rs);var a=rs.len();e.getColumn(1,rs);var o=rs.len();e.getColumn(2,rs);var s=a/2,u=o/2,c=rs.len()/2;return(Math.log2(6378137/s)+Math.log2(6378137/u)+Math.log2(6356752.314245179/c))/3}return r?Math.log2(6356752.314245179/r):i&&n?(Math.log2(6378137/n)+Math.log2(6378137/i))/2:1}(t.boundingVolume)}},{key:"_initializeStats",value:function(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}},{key:"_initializeTileHeaders",value:function(t,e,r){var n=new Us(this,t.root,e,r);if(e&&(e.children.push(n),n.depth=e.depth+1),this.type===ps){var i=[];for(i.push(n);i.length>0;){var a=i.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();var o=a.header.children||[],s=!0,u=!1,c=void 0;try{for(var h,l=o[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var f=h.value,d=new Us(this,f,a,r);a.children.push(d),d.depth=a.depth+1,i.push(d)}}catch(t){u=!0,c=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw c}}}}return n}},{key:"_initializeTraverser",value:function(){var t;switch(this.type){case ps:t=Zs;break;case ys:t=tu;break;default:t=Hs}return new t({basePath:this.basePath})}},{key:"_destroyTileHeaders",value:function(t){this._destroySubtree(t)}},{key:"_loadTile",value:(e=Pr(xr.a.mark((function t(e,r){var n;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this._onStartTileLoading(),t.next=4,e.loadContent(r);case 4:n=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this._onTileLoadError(e,t.t0);case 10:return t.prev=10,this._onEndTileLoading(),this._onTileLoad(e,n),t.finish(10);case 14:case"end":return t.stop()}}),t,this,[[0,7,10,14]])}))),function(t,r){return e.apply(this,arguments)})},{key:"_onTileLoadError",value:function(t,e){this.stats.get("Failed Tile Loads").incrementCount();var r=e.message||e.toString(),n=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(r)),this.options.onTileError(t,r,n)}},{key:"_onTileLoad",value:function(t,e){e&&(t&&t.content&&function(t,e){Ur(t),Ur(e);var r=e.rtcCenter,n=e.rotateYtoZ,i=t.computedTransform,a=t.boundingVolume.center,o=new hr(i);if(r&&o.translate(r),n){var s=(new hr).rotateX(Math.PI/2);o=o.multiplyRight(s)}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);var u=new Qe(a);e.cartesianModelMatrix=o,e.cartesianOrigin=u;var c=Zi.WGS84.cartesianToCartographic(u,new Qe),h=Zi.WGS84.eastNorthUpToFixedFrame(u).invert();e.cartographicModelMatrix=h.multiplyRight(o),e.cartographicOrigin=c,e.modelMatrix=e.cartographicModelMatrix}(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t))}},{key:"_onStartTileLoading",value:function(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()}},{key:"_addTileToCache",value:function(t){this._cache.add(this,t,(function(e){return e._updateCacheStats(t)}))}},{key:"_updateCacheStats",value:function(t){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=t.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(t){this.gpuMemoryUsageInBytes-=t.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}},{key:"_destroy",value:function(){var t=[];for(this.root&&t.push(this.root);t.length>0;){var e=t.pop(),r=!0,n=!1,i=void 0;try{for(var a,o=e.children[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;t.push(s)}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}this._destroyTile(e)}this.root=null}},{key:"_destroySubtree",value:function(t){var e=t,r=[];for(r.push(e);r.length>0;){t=r.pop();var n=!0,i=!1,a=void 0;try{for(var o,s=t.children[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;r.push(u)}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}t!==e&&this._destroyTile(t)}e.children=[]}},{key:"_destroyTile",value:function(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}},{key:"_initializeCesiumTileset",value:function(t){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description,this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this.extras=t.extras}},{key:"_initializeI3STileset",value:function(t){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=t.store.defaultGeometrySchema}},{key:"hasExtension",value:function(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"queryParams",get:function(){return this._queryParamsString||(this._queryParamsString=function(t){for(var e=[],r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];e.push("".concat(i,"=").concat(t[i]))}switch(e.length){case 0:return"";case 1:return"?".concat(e[0]);default:return"?".concat(e.join("&"))}}(this._queryParams)),this._queryParamsString}}]),t}(),au={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"};Object.keys(au);function ou(t,e,r){Ur(t instanceof ArrayBuffer);var n=new TextDecoder("utf8"),i=new Uint8Array(t,e,r);return n.decode(i)}function su(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(t);return"".concat(String.fromCharCode(r.getUint8(e+0))).concat(String.fromCharCode(r.getUint8(e+1))).concat(String.fromCharCode(r.getUint8(e+2))).concat(String.fromCharCode(r.getUint8(e+3)))}function uu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var cu,hu={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},lu=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?uu(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):uu(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},{},hu),fu=(Kr(cu={},hu.DOUBLE,Float64Array),Kr(cu,hu.FLOAT,Float32Array),Kr(cu,hu.UNSIGNED_SHORT,Uint16Array),Kr(cu,hu.UNSIGNED_INT,Uint32Array),Kr(cu,hu.UNSIGNED_BYTE,Uint8Array),Kr(cu,hu.BYTE,Int8Array),Kr(cu,hu.SHORT,Int16Array),Kr(cu,hu.INT,Int32Array),cu),du={DOUBLE:hu.DOUBLE,FLOAT:hu.FLOAT,UNSIGNED_SHORT:hu.UNSIGNED_SHORT,UNSIGNED_INT:hu.UNSIGNED_INT,UNSIGNED_BYTE:hu.UNSIGNED_BYTE,BYTE:hu.BYTE,SHORT:hu.SHORT,INT:hu.INT},yu=function(){function t(){re(this,t)}return ie(t,null,[{key:"fromTypedArray",value:function(t){for(var e in t=ArrayBuffer.isView(t)?t.constructor:t,fu){if(fu[e]===t)return e}throw new Error("Failed to convert GL type")}},{key:"fromName",value:function(t){var e=du[t];if(!e)throw new Error("Failed to convert GL type");return e}},{key:"getArrayType",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(t){case hu.UNSIGNED_SHORT_5_6_5:case hu.UNSIGNED_SHORT_4_4_4_4:case hu.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:var e=fu[t];if(!e)throw new Error("Failed to convert GL type");return e}}},{key:"getByteSize",value:function(e){return t.getArrayType(e).BYTES_PER_ELEMENT}},{key:"validate",value:function(e){return Boolean(t.getArrayType(e))}},{key:"createTypedArray",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;void 0===i&&(i=(r.byteLength-n)/t.getByteSize(e));var a=t.getArrayType(e);return new a(r,n,i)}}]),t}(),pu=function(){function t(e,r){re(this,t),this.json=e,this.buffer=r,this.featuresLength=0,this._cachedTypedArrays={}}return ie(t,[{key:"getExtension",value:function(t){return this.json.extensions&&this.json.extensions[t]}},{key:"hasProperty",value:function(t){return Boolean(this.json[t])}},{key:"getGlobalProperty",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lu.UNSIGNED_INT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,e,r,1,n.byteOffset):n}},{key:"getPropertyArray",value:function(t,e,r){var n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(e=yu.fromName(n.componentType)),this._getTypedArrayFromBinary(t,e,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,e,n)}},{key:"getProperty",value:function(t,e,r,n,i){var a=this.json[t];if(!a)return a;var o=this.getPropertyArray(t,e,r);if(1===r)return o[n];for(var s=0;s<r;++s)i[s]=o[r*n+s];return i}},{key:"_getTypedArrayFromBinary",value:function(t,e,r,n,i){var a=this._cachedTypedArrays,o=a[t];return o||(o=yu.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+i,n*r),a[t]=o),o}},{key:"_getTypedArrayFromArray",value:function(t,e,r){var n=this._cachedTypedArrays,i=n[t];return i||(i=yu.createTypedArray(e,r),n[t]=i),i}}]),t}(),vu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gu={SCALAR:function(t,e){return t[e]},VEC2:function(t,e){return[t[2*e+0],t[2*e+1]]},VEC3:function(t,e){return[t[3*e+0],t[3*e+1],t[3*e+2]]},VEC4:function(t,e){return[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]]},MAT2:function(t,e){return[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]]},MAT3:function(t,e){return[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]]},MAT4:function(t,e){return[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]}},mu={SCALAR:function(t,e,r){e[r]=t},VEC2:function(t,e,r){e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:function(t,e,r){e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:function(t,e,r){e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:function(t,e,r){e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:function(t,e,r){e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:function(t,e,r){e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};var bu=function(t){return void 0!==t};function wu(t,e,r){if(!e)return null;var n=t.getExtension("3DTILES_batch_table_hierarchy"),i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?function(t,e){var r,n,i,a,o=t.instancesLength,s=t.classes,u=t.classIds,c=t.parentCounts,h=t.parentIds,l=o;bu(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),ms("classIds"),u=i.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,o));if(bu(c))for(bu(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),ms("parentCounts"),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,o)),a=new Uint16Array(o),ms("parentIdsLength"),l=0,r=0;r<o;++r)a[r]=l,l+=(ms("parentIdsLength"),c[r]);bu(h)&&bu(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),ms("parentIds"),h=i.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,l));var f=s.length;for(r=0;r<f;++r){var d=s[r].length,y=s[r].instances,p=getBinaryProperties(d,y,e);s[r].instances=combine(p,y)}var v=new Array(f).fill(0),g=new Uint16Array(o);for(r=0;r<o;++r)n=u[r],g[r]=v[n],++v[n];var m={classes:s,classIds:u,classIndexes:g,parentCounts:c,parentIndexes:a,parentIds:h};return function(t){for(var e=t.classIds.length,r=0;r<e;++r)xu(t,r,stack)}(m),m}(n,r):null}function ku(t,e,r){if(t){var n=t.parentCounts;return t.parentIds?r(t,e):n>0?function(t,e,r){var n=t.classIds,i=t.parentCounts,a=t.parentIds,o=t.parentIndexes,s=n.length,u=scratchVisited;u.length=Math.max(u.length,s);var c=++marker,h=scratchStack;h.length=0,h.push(e);for(;h.length>0;)if(e=h.pop(),u[e]!==c){u[e]=c;var l=r(t,e);if(bu(l))return l;for(var f=i[e],d=o[e],y=0;y<f;++y){var p=a[d+y];p!==e&&h.push(p)}}return null}(t,e,r):function(t,e,r){var n=!0;for(;n;){var i=r(t,e);if(bu(i))return i;var a=t.parentIds[e];n=a!==e,e=a}throw new Error("traverseHierarchySingleParent")}(t,e,r)}}function xu(t,e,r){var n=t.parentCounts,i=t.parentIds,a=t.parentIndexes,o=t.classIds.length;if(bu(i)){assert(e<o,"Parent index ".concat(e," exceeds the total number of instances: ").concat(o)),assert(-1===r.indexOf(e),"Circular dependency detected in the batch table hierarchy."),r.push(e);for(var s=bu(n)?n[e]:1,u=bu(n)?a[e]:e,c=0;c<s;++c){var h=i[u+c];h!==e&&xu(t,h,r)}r.pop(e)}}function _u(t){return null!=t}var Tu={HIERARCHY:!0,extensions:!0,extras:!0},Ou=function(){function t(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var a in re(this,t),Ur(n>=0),this.json=e||{},this.binary=r,this.featureCount=n,this._extensions=this.json&&this.json.extensions||{},this._properties={},this.json)Tu[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=wu(this,this.json,this.binary))}return ie(t,[{key:"getExtension",value:function(t){return this.json&&this.json.extensions&&this.json.extensions[t]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(t,e){return this._checkBatchId(t),Ur("string"==typeof e,e),!!this._hierarchy&&_u(ku(this._hierarchy,t,(function(t,r){var n=t.classIds[r];return t.classes[n].name===e})))}},{key:"isExactClass",value:function(t,e){return Ur("string"==typeof e,e),this.getExactClassName(t)===e}},{key:"getExactClassName",value:function(t){if(this._checkBatchId(t),this._hierarchy){var e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}},{key:"hasProperty",value:function(t,e){return this._checkBatchId(t),Ur("string"==typeof e,e),_u(this._properties[e])||this._hasPropertyInHierarchy(t,e)}},{key:"getPropertyNames",value:function(t,e){var r;this._checkBatchId(t),(e=_u(e)?e:[]).length=0;var n=Object.keys(this._properties);return(r=e).push.apply(r,de(n)),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}},{key:"getProperty",value:function(t,e){if(this._checkBatchId(t),Ur("string"==typeof e,e),this._binaryProperties){var r=this._binaryProperties[e];if(_u(r))return this._getBinaryProperty(r,t)}var n=this._properties[e];if(_u(n))return n[t];if(this._hierarchy){var i=this._getHierarchyProperty(t,e);if(_u(i))return i}}},{key:"setProperty",value:function(t,e,r){var n=this.featureCount;if(this._checkBatchId(t,n),Ur("string"==typeof e,e),this._binaryProperties){var i=this._binaryProperties[e];if(i)return void this._setBinaryProperty(i,t,r)}if(!this._hierarchy||!this._setHierarchyProperty(this,t,e,r)){var a=this._properties[e];_u(a)||(this._properties[e]=new Array(n),a=this._properties[e]),a[t]=r}}},{key:"_checkBatchId",value:function(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(t,e){return t.unpack(t.typedArray,e)}},{key:"_setBinaryProperty",value:function(t,e,r){t.pack(r,t.typedArray,e)}},{key:"_initializeBinaryProperties",value:function(){var t=null;for(var e in this._properties){var r=this._properties[e],n=this._initializeBinaryProperty(e,r);n&&((t=t||{})[e]=n)}return t}},{key:"_initializeBinaryProperty",value:function(t,e){if("byteOffset"in e){var r=e;Ur(this.binary,"Property ".concat(t," requires a batch table binary.")),Ur(r.type,"Property ".concat(t," requires a type."));var n=function(t,e,r,n){var i=t.componentType;Ur(t.componentType);var a="string"==typeof i?yu.fromName(i):i,o=vu[t.type],s=gu[t.type],u=mu[t.type];return r+=t.byteOffset,{values:yu.createTypedArray(a,e,r,o*n),type:a,size:o,unpacker:s,packer:u}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(t,e){if(!this._hierarchy)return!1;var r=ku(this._hierarchy,t,(function(t,r){var n=t.classIds[r];return _u(t.classes[n].instances[e])}));return _u(r)}},{key:"_getPropertyNamesInHierarchy",value:function(t,e){ku(this._hierarchy,t,(function(t,r){var n=t.classIds[r],i=t.classes[n].instances;for(var a in i)i.hasOwnProperty(a)&&-1===e.indexOf(a)&&e.push(a)}))}},{key:"_getHierarchyProperty",value:function(t,e){var r=this;return ku(this._hierarchy,t,(function(t,n){var i=t.classIds[n],a=t.classes[i],o=t.classIndexes[n],s=a.instances[e];return _u(s)?_u(s.typedArray)?r._getBinaryProperty(s,o):s[o]:null}))}},{key:"_setHierarchyProperty",value:function(t,e,r,n){var i=this,a=ku(this._hierarchy,e,(function(t,a){var o=t.classIds[a],s=t.classes[o],u=t.classIndexes[a],c=s.instances[r];return!!_u(c)&&(Ur(a===e,'Inherited property "'.concat(r,'" is read-only.')),_u(c.typedArray)?i._setBinaryProperty(c,u,n):c[u]=n,!0)}));return _u(a)}}]),t}();function Su(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new DataView(e);if(t.magic=n.getUint32(r,!0),r+=4,t.version=n.getUint32(r,!0),r+=4,t.byteLength=n.getUint32(r,!0),r+=4,1!==t.version)throw new Error("3D Tile Version ".concat(t.version," not supported"));return r}function Mu(t,e,r){var n=new DataView(e);return t.header=t.header||{},t.header.featureTableJsonByteLength=n.getUint32(r,!0),r+=4,t.header.featureTableBinaryByteLength=n.getUint32(r,!0),r+=4,t.header.batchTableJsonByteLength=n.getUint32(r,!0),r+=4,t.header.batchTableBinaryByteLength=n.getUint32(r,!0),r+=4}function Eu(t,e,r,n){return r=function(t,e,r,n){var i=t.header,a=i.featureTableJsonByteLength,o=i.featureTableBinaryByteLength;if(t.featureTableJson={BATCH_LENGTH:0},a>0){var s=ou(e,r,a);t.featureTableJson=JSON.parse(s)}return r+=a,t.featureTableBinary=new Uint8Array(e,r,o),r+=o}(t,e,r),r=function(t,e,r,n){var i=t.header,a=i.batchTableJsonByteLength,o=i.batchTableBinaryByteLength;if(a>0){var s=ou(e,r,a);t.batchTableJson=JSON.parse(s),r+=a,o>0&&(t.batchTableBinary=new Uint8Array(e,r,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=o)}return r}(t,e,r)}function Pu(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=t>>11&31,n=t>>5&63,i=31&t;return e[0]=r<<3,e[1]=n<<2,e[2]=i<<3,e}function Lu(t,e,r){if(!(e||t&&t.batchIds&&r))return null;var n=t.batchIds,i=t.isRGB565,a=t.pointCount;if(n&&r){for(var o=new Uint8ClampedArray(3*a),s=0;s<a;s++){var u=n[s],c=r.getProperty(u,"dimensions").map((function(t){return 255*t}));o[3*s]=c[0],o[3*s+1]=c[1],o[3*s+2]=c[2]}return{type:lu.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){for(var h=new Uint8ClampedArray(3*a),l=0;l<a;l++){var f=Pu(e[l]);h[3*l]=f[0],h[3*l+1]=f[1],h[3*l+2]=f[2]}return{type:lu.UNSIGNED_BYTE,value:h,size:3,normalized:!0}}return e&&e.length===3*a?{type:lu.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:lu.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}function Au(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}new Ve,new Qe,new Ve,new Ve,new Uint8Array(1);function ju(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Oe(t,0,e)/e*2-1}function Nu(t){return t<0?-1:1}function Iu(t,e,r,n){if(Au(n),t<0||t>r||e<0||e>r)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(r));if(n.x=ju(t,r),n.y=ju(e,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){var i=n.x;n.x=(1-Math.abs(n.y))*Nu(i),n.y=(1-Math.abs(i))*Nu(n.y)}return n.normalize()}function Ru(t,e,r){return Iu(t,e,255,r)}var Cu=new Qe;function Du(t,e,r){return t.isQuantized?r.decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){for(var r=new Qe,n=new Float32Array(3*t.pointCount),i=0;i<t.pointCount;i++)r.set(e[3*i],e[3*i+1],e[3*i+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,3*i);return n}(t,e)):{type:lu.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Bu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Vu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Bu(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Bu(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Fu(t,e,r,n,i){return Uu.apply(this,arguments)}function Uu(){return(Uu=Pr(xr.a.mark((function t(e,r,n,i,a){var o,s,u;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Su(e,r,n,i),n=Mu(e,r,n),n=Eu(e,r,n),qu(e),o=zu(e),s=o.featureTable,u=o.batchTable,t.next=7,Zu(e,s,u,i,a);case 7:return Gu(e,s,i),Wu(e,s,u),Hu(e,s),t.abrupt("return",n);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function qu(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function zu(t){var e=new pu(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",lu.FLOAT,3);var n=function(t,e){var r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",lu.UNSIGNED_SHORT,1),t.batchIds)){var n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=t.batchTableJson,a=t.batchTableBinary;r=new Ou(i,a,n)}return r}(t,e);return{featureTable:e,batchTable:n}}function Gu(t,e,r){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",lu.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){var n=e.getPropertyArray("POSITION_QUANTIZED",lu.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",lu.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",lu.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Du(t,n,r)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Wu(t,e,r){if(!t.attributes.colors){var n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",lu.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",lu.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",lu.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=Lu(t,n,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",lu.UNSIGNED_BYTE,4))}function Hu(t,e){if(!t.attributes.normals){var r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",lu.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",lu.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){for(var r=new Float32Array(3*t.pointsLength),n=0;n<t.pointsLength;n++)Ru(e[2*n],e[2*n+1],Cu),Cu.toArray(r,3*n);return{type:lu.FLOAT,size:2,value:r}}return{type:lu.FLOAT,size:2,value:e}}(t,r)}}function Zu(t,e,r,n,i){return Ku.apply(this,arguments)}function Ku(){return(Ku=Pr(xr.a.mark((function t(e,r,n,i,a){var o,s,u,c,h,l,f,d;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((c=n&&n.getExtension("3DTILES_draco_point_compression"))&&(u=c.properties),!(h=r.getExtension("3DTILES_draco_point_compression"))){t.next=15;break}if(s=h.properties,l=h.byteOffset,f=h.byteLength,s&&Number.isFinite(l)&&f){t.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:o=e.featureTableBinary.slice(l,l+f),e.hasPositions=Number.isFinite(s.POSITION),e.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),e.hasNormals=Number.isFinite(s.NORMAL),e.hasBatchIds=Number.isFinite(s.BATCH_ID),e.isTranslucent=Number.isFinite(s.RGBA);case 15:if(o){t.next=17;break}return t.abrupt("return",!0);case 17:return d={buffer:o,properties:Vu({},s,{},u),featureTableProperties:s,batchTableProperties:u,dequantizeInShader:!1},t.next=20,Yu(e,d,i,a);case 20:return t.abrupt("return",t.sent);case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Yu(t,e,r,n){return Qu.apply(this,arguments)}function Qu(){return(Qu=Pr(xr.a.mark((function t(e,r,n,i){var a,o,s,u,c,h,l,f,d,y;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=i.parse,t.next=3,a(r.buffer,{});case 3:o=t.sent,s=o.attributes.POSITION&&o.attributes.POSITION.value,u=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,c=o.attributes.NORMAL&&o.attributes.NORMAL.value,h=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,l=s&&o.attributes.POSITION.value.quantization,f=c&&o.attributes.NORMAL.value.quantization,l&&(d=o.POSITION.data.quantization,y=d.range,e.quantizedVolumeScale=new Qe(y,y,y),e.quantizedVolumeOffset=new Qe(d.minValues),e.quantizedRange=(1<<d.quantizationBits)-1,e.isQuantizedDraco=!0),f&&(e.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0),e.attributes={positions:s,colors:Lu(e,u),normals:c,batchIds:h};case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ju(t,e){if(!t)throw new Error(e)}var Xu={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},$u=Xu.global||Xu.self||Xu.window,tc="object"!==("undefined"==typeof process?"undefined":ae(process))||"[object process]"!==String(process)||process.browser,ec="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),rc=(ec&&parseFloat(ec[1]),$u._parseImageNode),nc="undefined"!=typeof Image,ic="undefined"!=typeof ImageBitmap,ac=Boolean(rc);function oc(t){switch(t){case"auto":return ic||nc||ac;case"imagebitmap":return ic;case"html":case"image":return nc;case"ndarray":case"data":return!!tc||ac;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function sc(t){var e=cc(t);if(!e)throw new Error("Not an image");return e}function uc(t){switch(sc(t)){case"data":return t;case"image":case"imagebitmap":var e=document.createElement("canvas"),r=e.getContext("2d");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:return Ju(!1)}}function cc(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"===ae(t)&&t.data&&t.width&&t.height?"data":null}var hc=/^data:image\/svg\+xml/,lc=/\.svg((\?|#).*)?$/;function fc(t,e){return yc(e)?(console.warn("SVG cannot be parsed to imagebitmap"),new Blob([new Uint8Array(t)],{type:"image/svg+xml"})):new Blob([new Uint8Array(t)])}function dc(t,e){if(yc(e)){var r=(new TextDecoder).decode(t);return"data:image/svg+xml;base64,".concat(btoa(r))}return fc(t,e)}function yc(t){return t&&(hc.test(t)||lc.test(t))}function pc(t,e,r){return vc.apply(this,arguments)}function vc(){return(vc=Pr(xr.a.mark((function t(e,r,n){var i,a,o;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=dc(e,n),a=self.URL||self.webkitURL,o="string"!=typeof i&&a.createObjectURL(i),t.prev=3,t.next=6,gc(o||i,r);case 6:return t.abrupt("return",t.sent);case 7:return t.prev=7,o&&a.revokeObjectURL(o),t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[3,,7,10]])})))).apply(this,arguments)}function gc(t,e){return mc.apply(this,arguments)}function mc(){return(mc=Pr(xr.a.mark((function t(e,r){var n;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=new Image).src=e,!(r.image&&r.image.decode&&n.decode)){t.next=6;break}return t.next=5,n.decode();case 5:return t.abrupt("return",n);case 6:return t.next=8,new Promise((function(t,r){try{n.onload=function(){return t(n)},n.onerror=function(t){return r(new Error("Could not load image ".concat(e,": ").concat(t)))}}catch(t){r(t)}}));case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var bc=!0;function wc(t,e,r){return kc.apply(this,arguments)}function kc(){return(kc=Pr(xr.a.mark((function t(e,r,n){var i,a;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=fc(e,n),!_c(a=r&&r.imagebitmap)&&bc||(a=null),!a){t.next=14;break}return t.prev=4,t.next=7,createImageBitmap(i,a);case 7:return t.abrupt("return",t.sent);case 10:t.prev=10,t.t0=t.catch(4),console.warn(t.t0),bc=!1;case 14:return t.next=16,createImageBitmap(i);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t,null,[[4,10]])})))).apply(this,arguments)}var xc={};function _c(t){for(var e in t||xc)return!0;return!1}var Tc=new Map([["image/png",{test:Oc,getSize:function(t){return{width:t.getUint32(16,!1),height:t.getUint32(20,!1)}}}],["image/jpeg",{test:Ec,getSize:function(t){if(t.byteLength<2||65496!==t.getUint16(0,!1))return null;var e=function(){for(var t=new Set([65499,65476,65484,65501,65534]),e=65504;e<65520;++e)t.add(e);var r=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:r}}(),r=e.tableMarkers,n=e.sofMarkers,i=2;for(;i<t.byteLength;){var a=t.getUint16(i,!1);if(n.has(a))return{height:t.getUint16(i+5,!1),width:t.getUint16(i+7,!1)};if(!r.has(a))return null;i+=2,i+=t.getUint16(i,!1)}return null}}],["image/gif",{test:Sc,getSize:function(t){return{width:t.getUint16(6,!0),height:t.getUint16(8,!0)}}}],["image/bmp",{test:Mc,getSize:function(t){return{width:t.getUint32(18,!0),height:t.getUint32(22,!0)}}}]]);function Oc(t){return t.byteLength>=24&&2303741511===t.getUint32(0,!1)}function Sc(t){return t.byteLength>=10&&1195984440===t.getUint32(0,!1)}function Mc(t){return t.byteLength>=14&&16973===t.getUint16(0,!1)&&t.getUint32(2,!0)===t.byteLength}function Ec(t){return t.byteLength>=3&&65496===t.getUint16(0,!1)&&255===t.getUint8(2,!1)}"Invalid MIME type. Supported MIME types are: ".concat(Array.from(Tc.keys()).join(", "));function Pc(t){var e=Lc(t),r=!0,n=!1,i=void 0;try{for(var a,o=Tc.entries()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=Je(a.value,2),u=s[0];if((0,s[1].test)(e))return u}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return null}function Lc(t){if((t=t.buffer||t)instanceof ArrayBuffer)return new DataView(t);if(ArrayBuffer.isView(t))return new DataView(t.buffer);throw new Error("toDataView")}function Ac(t,e){var r=Pc(t),n=$u._parseImageNode;return Ju(n),n(t,r,e)}function jc(){return(jc=Pr(xr.a.mark((function t(e,r,n){var i,a,o,s,u;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(r=r||{}).image||{},a=i.type||"auto",o=(n||{}).url,s=Nc(a),t.t0=s,t.next="imagebitmap"===t.t0?8:"image"===t.t0?12:"data"===t.t0?16:20;break;case 8:return t.next=10,wc(e,r,o);case 10:return u=t.sent,t.abrupt("break",21);case 12:return t.next=14,pc(e,r,o);case 14:return u=t.sent,t.abrupt("break",21);case 16:return t.next=18,Ac(e,r);case 18:return u=t.sent,t.abrupt("break",21);case 20:Ju(!1);case 21:return"data"===a&&(u=uc(u)),t.abrupt("return",u);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Nc(t){switch(t){case"auto":case"data":return function(){if(oc("image"))return"image";if(oc("imagebitmap"))return"imagebitmap";if(oc("data"))return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return oc(t),t}}var Ic={name:"Images",version:"2.1.1",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vndmicrosofticon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:function(t,e,r){return jc.apply(this,arguments)},test:function(t){var e=new DataView(t);return Ec(e)||Mc(e)||Sc(e)||Oc(e)},options:{image:{format:"auto",decode:!0}}};function Rc(t,e,r){if(t.byteLength<=e+r)return"";for(var n=new DataView(t),i="",a=0;a<r;a++)i+=String.fromCharCode(n.getUint8(e+a));return i}function Cc(t){try{return JSON.parse(t)}catch(e){throw new Error('Failed to parse JSON from data starting with "'.concat(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return Rc(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){var r=0;return Rc(t,r,e)}return""}(t),'"'))}}function Dc(t){return t+3&-4}function Bc(t,e,r){var n=r?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}function Vc(t,e,r){var n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{var i=t.byteOffset,a=t.byteLength;n=new Uint8Array(t.buffer,i,a)}return e.set(n,r),r+Dc(n.byteLength)}function Fc(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function Uc(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;var r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return r.substr(0,r.lastIndexOf("/")+1)+t}function qc(t,e,r){var n=t.bufferViews[r];Fc(n);var i=e[n.buffer];Fc(i);var a=(n.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,a,n.byteLength)}var zc=["SCALAR","VEC2","VEC3","VEC4"],Gc=new Map([[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126]]),Wc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Hc={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Zc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Kc(t){return zc[t-1]||zc[0]}function Yc(t){var e=Gc.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Qc(t,e){var r=Zc[t.componentType],n=Wc[t.type],i=Hc[t.componentType],a=t.count*n,o=t.count*n*i;return Fc(o>=0&&o<=e.byteLength),{ArrayType:r,length:a,byteLength:o}}var Jc=function(){function t(e){if(re(this,t),e instanceof t)return e;e||(e={json:{version:2,buffers:[]},buffers:[]}),this.gltf=e,Fc(this.gltf.json)}return ie(t,[{key:"getApplicationData",value:function(t){return this.json[t]}},{key:"getExtraData",value:function(t){return(this.json.extras||{})[t]}},{key:"getExtension",value:function(t){var e=this.getUsedExtensions().find((function(e){return e===t})),r=this.json.extensions||{};return e?r[t]||!0:null}},{key:"getRequiredExtension",value:function(t){return this.getRequiredExtensions().find((function(e){return e===t}))?this.getExtension(t):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getObjectExtension",value:function(t,e){return(t.extensions||{})[e]}},{key:"getScene",value:function(t){return this.getObject("scenes",t)}},{key:"getNode",value:function(t){return this.getObject("nodes",t)}},{key:"getSkin",value:function(t){return this.getObject("skins",t)}},{key:"getMesh",value:function(t){return this.getObject("meshes",t)}},{key:"getMaterial",value:function(t){return this.getObject("materials",t)}},{key:"getAccessor",value:function(t){return this.getObject("accessors",t)}},{key:"getCamera",value:function(t){return null}},{key:"getTexture",value:function(t){return this.getObject("textures",t)}},{key:"getSampler",value:function(t){return this.getObject("samplers",t)}},{key:"getImage",value:function(t){return this.getObject("images",t)}},{key:"getBufferView",value:function(t){return this.getObject("bufferViews",t)}},{key:"getBuffer",value:function(t){return this.getObject("buffers",t)}},{key:"getObject",value:function(t,e){if("object"===ae(e))return e;var r=this.json[t]&&this.json[t][e];if(!r)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return r}},{key:"getTypedArrayForBufferView",value:function(t){var e=(t=this.getBufferView(t)).buffer,r=this.gltf.buffers[e];Fc(r);var n=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,t.byteLength)}},{key:"getTypedArrayForAccessor",value:function(t){t=this.getAccessor(t);var e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,n=Qc(t,e),i=n.ArrayType,a=n.length;return new i(r,e.byteOffset+t.byteOffset,a)}},{key:"getTypedArrayForImageData",value:function(t){t=this.getAccessor(t);var e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,n=e.byteOffset||0;return new Uint8Array(r,n,e.byteLength)}},{key:"addApplicationData",value:function(t,e){return this.json[t]=e,this}},{key:"addExtraData",value:function(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}},{key:"addObjectExtension",value:function(t,e,r){return Fc(r),t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}},{key:"removeObjectExtension",value:function(t,e){return delete(t.extensions||{})[e],this}},{key:"addExtension",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fc(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}},{key:"addRequiredExtension",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fc(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}},{key:"registerUsedExtension",value:function(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((function(e){return e===t}))||this.json.extensionsUsed.push(t)}},{key:"registerRequiredExtension",value:function(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((function(e){return e===t}))||this.json.extensionsRequired.push(t)}},{key:"removeExtension",value:function(t){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t]}},{key:"setObjectExtension",value:function(t,e,r){(t.extensions||{})[e]=r}},{key:"addMesh",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=this._addAttributes(t),i={primitives:[{attributes:n,indices:e,mode:r}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}},{key:"addPointCloud",value:function(t){var e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}},{key:"addImage",value:function(t,e){e=e||Pc(t);var r={bufferView:this.addBufferView(t),mimeType:e};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}},{key:"addBufferView",value:function(t){var e=t.byteLength;Fc(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);var r={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=Dc(e),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(t,e){var r={bufferView:t,type:Kc(e.size),componentType:e.componentType,count:e.count};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3},r=this.addBufferView(t),n={size:e.size,componentType:Yc(t),count:Math.round(t.length/e.size)};return this.addAccessor(r,Object.assign(n,e))}},{key:"createBinaryChunk",value:function(){if(!this.arrayBuffer){for(var t=this.byteLength,e=new ArrayBuffer(t),r=new Uint8Array(e),n=0,i=0;i<this.sourceBuffers.length;i++){n=Vc(this.sourceBuffers[i],r,n)}this.json.buffers[0].byteLength=t,this.arrayBuffer=e,this.sourceBuffers=[]}}},{key:"_removeStringFromArray",value:function(t,e){for(var r=!0;r;){var n=t.indexOf(e);n>-1?t.splice(n,1):r=!1}}},{key:"json",get:function(){return this.gltf.json}}]),t}();function Xc(t){var e={};for(var r in t){var n=t[r];if("indices"!==r){var i=$c(n);e[r]=i}}return e}function $c(t,e){var r=function(t,e){var r=t,n=1,i=0;t&&t.value&&(r=t.value,n=t.size||1);r&&(ArrayBuffer.isView(r)||(r=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return null;if(Array.isArray(t))return new e(t);if(r&&!(t instanceof e))return new e(t);return t}(r,Float32Array)),i=r.length/n);return{buffer:r,size:n,count:i}}(t),n=r.buffer,i=r.size;return{value:n,size:i,bufferView:null,byteOffset:0,count:r.count,type:Kc(i),componentType:Yc(n)}}var th=xr.a.mark(uh);function eh(t,e,r){return rh.apply(this,arguments)}function rh(){return(rh=Pr(xr.a.mark((function t(e,r,n){var i,a,o,s,u,c,h,l;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.gltf.decompressMeshes){t.next=2;break}return t.abrupt("return");case 2:for(i=new Jc(e),a=[],o=!0,s=!1,u=void 0,t.prev=7,c=uh(i)[Symbol.iterator]();!(o=(h=c.next()).done);o=!0)l=h.value,i.getObjectExtension(l,"KHR_draco_mesh_compression")&&a.push(ih(l,i,r,n));t.next=15;break;case 11:t.prev=11,t.t0=t.catch(7),s=!0,u=t.t0;case 15:t.prev=15,t.prev=16,o||null==c.return||c.return();case 18:if(t.prev=18,!s){t.next=21;break}throw u;case 21:return t.finish(18);case 22:return t.finish(15);case 23:return t.next=25,Promise.all(a);case 25:i.removeExtension("KHR_draco_mesh_compression");case 26:case"end":return t.stop()}}),t,null,[[7,11,15,23],[16,,18,22]])})))).apply(this,arguments)}function nh(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new Jc(t),n=!0,i=!1,a=void 0;try{for(var o,s=(r.json.meshes||[])[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;oh(u,e),r.addRequiredExtension("KHR_draco_mesh_compression")}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}function ih(t,e,r,n){return ah.apply(this,arguments)}function ah(){return(ah=Pr(xr.a.mark((function t(e,r,n,i){var a,o,s,u,c;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.getObjectExtension(e,"KHR_draco_mesh_compression"),o=r.getTypedArrayForBufferView(a.bufferView),s=Bc(o.buffer,o.byteOffset),u=i.parse,t.next=6,u(s,[],n,i);case 6:c=t.sent,e.attributes=Xc(c.attributes),c.indices&&(e.indices=$c(c.indices)),sh(e);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function oh(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter||!n.DracoLoader)throw new Error("DracoWriter/DracoLoader not available");var a=n.DracoWriter.encodeSync({attributes:t}),o=i.parseSync,s=o({attributes:t}),u=n._addFauxAttributes(s.attributes),c=n.addBufferView(a),h={primitives:[{attributes:u,mode:r,extensions:Kr({},"KHR_draco_mesh_compression",{bufferView:c,attributes:u})}]};return h}function sh(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}function uh(t){var e,r,n,i,a,o,s,u,c,h,l,f;return xr.a.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:e=!0,r=!1,n=void 0,d.prev=3,i=(t.json.meshes||[])[Symbol.iterator]();case 5:if(e=(a=i.next()).done){d.next=36;break}o=a.value,s=!0,u=!1,c=void 0,d.prev=10,h=o.primitives[Symbol.iterator]();case 12:if(s=(l=h.next()).done){d.next=19;break}return f=l.value,d.next=16,f;case 16:s=!0,d.next=12;break;case 19:d.next=25;break;case 21:d.prev=21,d.t0=d.catch(10),u=!0,c=d.t0;case 25:d.prev=25,d.prev=26,s||null==h.return||h.return();case 28:if(d.prev=28,!u){d.next=31;break}throw c;case 31:return d.finish(28);case 32:return d.finish(25);case 33:e=!0,d.next=5;break;case 36:d.next=42;break;case 38:d.prev=38,d.t1=d.catch(3),r=!0,n=d.t1;case 42:d.prev=42,d.prev=43,e||null==i.return||i.return();case 45:if(d.prev=45,!r){d.next=48;break}throw n;case 48:return d.finish(45);case 49:return d.finish(42);case 50:case"end":return d.stop()}}),th,null,[[3,38,42,50],[10,21,25,33],[26,,28,32],[43,,45,49]])}function ch(t,e){var r=new Jc(t),n=r.json,i=r.getExtension("KHR_lights_punctual");i&&(r.json.lights=i.lights,r.removeExtension("KHR_lights_punctual"));var a=!0,o=!1,s=void 0;try{for(var u,c=(n.nodes||[])[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value,l=r.getObjectExtension(h,"KHR_lights_punctual");l&&(h.light=l.light),r.removeObjectExtension(h,"KHR_lights_punctual")}}catch(t){o=!0,s=t}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}}function hh(t,e){var r=new Jc(t),n=r.json;if(n.lights){var i=r.addExtension("KHR_lights_punctual");Fc(!i.lights),i.lights=n.lights,delete n.lights}if(r.json.lights){var a=!0,o=!1,s=void 0;try{for(var u,c=r.json.lights[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value,l=h.node;r.addObjectExtension(l,"KHR_lights_punctual",h)}}catch(t){o=!0,s=t}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}delete r.json.lights}}function lh(t,e){var r=new Jc(t),n=r.json;r.removeExtension("KHR_materials_unlit");var i=!0,a=!1,o=void 0;try{for(var s,u=(n.materials||[])[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;c.extensions&&c.extensions.KHR_materials_unlit&&(c.unlit=!0),r.removeObjectExtension(c,"KHR_materials_unlit")}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}}function fh(t,e){var r=new Jc(t),n=r.json;if(r.materials){var i=!0,a=!1,o=void 0;try{for(var s,u=n.materials[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;c.unlit&&(delete c.unlit,r.addObjectExtension(c,"KHR_materials_unlit"),r.addExtension("KHR_materials_unlit"))}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}}}function dh(t,e){var r=new Jc(t),n=r.json,i=r.getExtension("KHR_techniques_webgl");if(i){var a=function(t,e){var r=t.programs,n=void 0===r?[]:r,i=t.shaders,a=void 0===i?[]:i,o=t.techniques,s=void 0===o?[]:o,u=new TextDecoder;return a.forEach((function(t){if(!Number.isFinite(t.bufferView))throw new Error("KHR_techniques_webgl: no shader code");t.code=u.decode(e.getTypedArrayForBufferView(t.bufferView))})),n.forEach((function(t){t.fragmentShader=a[t.fragmentShader],t.vertexShader=a[t.vertexShader]})),s.forEach((function(t){t.program=n[t.program]})),s}(i,r),o=!0,s=!1,u=void 0;try{for(var c,h=(n.materials||[])[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var l=c.value,f=r.getObjectExtension(l,"KHR_techniques_webgl");f&&(l.technique=Object.assign({},f,a[f.technique]),l.technique.values=ph(l.technique,r)),r.removeObjectExtension(l,"KHR_techniques_webgl")}}catch(t){s=!0,u=t}finally{try{o||null==h.return||h.return()}finally{if(s)throw u}}r.removeExtension("KHR_techniques_webgl")}}function yh(t,e){}function ph(t,e){var r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach((function(e){!t.uniforms[e].value||e in r||(r[e]=t.uniforms[e].value)})),Object.keys(r).forEach((function(t){"object"===ae(r[t])&&void 0!==r[t].index&&(r[t].texture=e.getTexture(r[t].index))})),r}var vh={KHR_draco_mesh_compression:i,KHR_lights_punctual:a,KHR_materials_unlit:o,KHR_techniques_webgl:s};function gh(t){return mh.apply(this,arguments)}function mh(){return(mh=Pr(xr.a.mark((function t(e){var r,n,i,a,o,s=arguments;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=s.length>1&&void 0!==s[1]?s[1]:{},n=s.length>2?s[2]:void 0,r.gltf=r.gltf||{},t.t0=xr.a.keys(vh);case 4:if((t.t1=t.t0()).done){t.next=14;break}if(i=t.t1.value,a=r.gltf.excludeExtensions||{},i in a&&!a[i]){t.next=12;break}return o=vh[i],t.next=12,o.decode(e,r,n);case 12:t.next=4;break;case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var bh;function wh(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function kh(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=new DataView(t),i=r.magic,a=void 0===i?1735152710:i,o=n.getUint32(e,!1);return o===a||1735152710===o}function xh(t,e,r,n){for(;r+8<=t.header.byteLength;){var i=e.getUint32(r+0,!0),a=e.getUint32(r+4,!0);switch(r+=8,a){case 1313821514:_h(t,e,r,i,n);break;case 5130562:Th(t,e,r,i,n);break;case 0:n.glb.strict||_h(t,e,r,i,n);break;case 1:n.glb.strict||Th(t,e,r,i,n)}r+=Dc(i)}return r}function _h(t,e,r,n,i){var a=new Uint8Array(e.buffer,r,n),o=new TextDecoder("utf8").decode(a);t.json=JSON.parse(o)}function Th(t,e,r,n,i){t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer})}function Oh(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Sh(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Oh(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Oh(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Mh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Eh={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ph={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Lh={magFilter:Ph.TEXTURE_MAG_FILTER,minFilter:Ph.TEXTURE_MIN_FILTER,wrapS:Ph.TEXTURE_WRAP_S,wrapT:Ph.TEXTURE_WRAP_T},Ah=(Kr(bh={},Ph.TEXTURE_MAG_FILTER,Ph.LINEAR),Kr(bh,Ph.TEXTURE_MIN_FILTER,Ph.NEAREST_MIPMAP_LINEAR),Kr(bh,Ph.TEXTURE_WRAP_S,Ph.REPEAT),Kr(bh,Ph.TEXTURE_WRAP_,Ph.REPEAT),bh);var jh=function(){function t(){re(this,t)}return ie(t,[{key:"postProcess",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.json,n=t.buffers,i=void 0===n?[]:n,a=t.images,o=void 0===a?[]:a,s=t.baseUri,u=void 0===s?"":s;return Fc(r),this.baseUri=u,this.json=r,this.buffers=i,this.images=o,this._resolveTree(this.json,e),this.json}},{key:"_resolveTree",value:function(t){var e=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.bufferViews&&(t.bufferViews=t.bufferViews.map((function(t,r){return e._resolveBufferView(t,r)}))),t.images&&(t.images=t.images.map((function(t,r){return e._resolveImage(t,r)}))),t.samplers&&(t.samplers=t.samplers.map((function(t,r){return e._resolveSampler(t,r)}))),t.textures&&(t.textures=t.textures.map((function(t,r){return e._resolveTexture(t,r)}))),t.accessors&&(t.accessors=t.accessors.map((function(t,r){return e._resolveAccessor(t,r)}))),t.materials&&(t.materials=t.materials.map((function(t,r){return e._resolveMaterial(t,r)}))),t.meshes&&(t.meshes=t.meshes.map((function(t,r){return e._resolveMesh(t,r)}))),t.nodes&&(t.nodes=t.nodes.map((function(t,r){return e._resolveNode(t,r)}))),t.skins&&(t.skins=t.skins.map((function(t,r){return e._resolveSkin(t,r)}))),t.scenes&&(t.scenes=t.scenes.map((function(t,r){return e._resolveScene(t,r)}))),void 0!==t.scene&&(t.scene=t.scenes[this.json.scene])}},{key:"getScene",value:function(t){return this._get("scenes",t)}},{key:"getNode",value:function(t){return this._get("nodes",t)}},{key:"getSkin",value:function(t){return this._get("skins",t)}},{key:"getMesh",value:function(t){return this._get("meshes",t)}},{key:"getMaterial",value:function(t){return this._get("materials",t)}},{key:"getAccessor",value:function(t){return this._get("accessors",t)}},{key:"getCamera",value:function(t){return null}},{key:"getTexture",value:function(t){return this._get("textures",t)}},{key:"getSampler",value:function(t){return this._get("samplers",t)}},{key:"getImage",value:function(t){return this._get("images",t)}},{key:"getBufferView",value:function(t){return this._get("bufferViews",t)}},{key:"getBuffer",value:function(t){return this._get("buffers",t)}},{key:"_get",value:function(t,e){if("object"===ae(e))return e;var r=this.json[t]&&this.json[t][e];return r||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),r}},{key:"_resolveScene",value:function(t,e){var r=this;return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map((function(t){return r.getNode(t)})),t}},{key:"_resolveNode",value:function(t,e){var r=this;return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map((function(t){return r.getNode(t)}))),void 0!==t.mesh&&(t.mesh=this.getMesh(t.mesh)),void 0!==t.camera&&(t.camera=this.getCamera(t.camera)),void 0!==t.skin&&(t.skin=this.getSkin(t.skin)),t}},{key:"_resolveSkin",value:function(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}},{key:"_resolveMesh",value:function(t,e){var r=this;return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map((function(t){var e=(t=Sh({},t)).attributes;for(var n in t.attributes={},e)t.attributes[n]=r.getAccessor(e[n]);return void 0!==t.indices&&(t.indices=r.getAccessor(t.indices)),void 0!==t.material&&(t.material=r.getMaterial(t.material)),t}))),t}},{key:"_resolveMaterial",value:function(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture=Sh({},t.normalTexture),t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture=Sh({},t.occlustionTexture),t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture=Sh({},t.emmisiveTexture),t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.pbrMetallicRoughness){t.pbrMetallicRoughness=Sh({},t.pbrMetallicRoughness);var r=t.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture=Sh({},r.baseColorTexture),r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture=Sh({},r.metallicRoughnessTexture),r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return t}},{key:"_resolveAccessor",value:function(t,e){var r,n;if(t.id=t.id||"accessor-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=(r=t.componentType,Eh[r]),t.components=(n=t.type,Mh[n]),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){var i=t.bufferView.buffer,a=Qc(t,t.bufferView),o=a.ArrayType,s=a.length,u=(t.bufferView.byteOffset||0)+i.byteOffset;t.value=new o(i.arrayBuffer,u,s)}return t}},{key:"_resolveTexture",value:function(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):Ah,t.source=this.getImage(t.source),t}},{key:"_resolveSampler",value:function(t,e){for(var r in t.id=t.id||"sampler-".concat(e),t.parameters={},t){var n=this._enumSamplerParameter(r);void 0!==n&&(t.parameters[n]=t[r])}return t}},{key:"_enumSamplerParameter",value:function(t){return Lh[t]}},{key:"_resolveImage",value:function(t,e){t.id=t.id||"image-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView));var r=this.images[e];return r&&(t.image=r),t}},{key:"_resolveBufferView",value:function(t,e){t.id=t.id||"bufferView-".concat(e);var r=t.buffer;t.buffer=this.buffers[r];var n=this.buffers[r].arrayBuffer,i=this.buffers[r].byteOffset||0;return"byteOffset"in t&&(i+=t.byteOffset),t.data=new Uint8Array(n,i,t.byteLength),t}},{key:"_resolveCamera",value:function(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}]),t}();function Nh(t,e){return(new jh).postProcess(t,e)}function Ih(t,e){return Rh.apply(this,arguments)}function Rh(){return(Rh=Pr(xr.a.mark((function t(e,r){var n,i,a,o,s,u,c=arguments;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=c.length>2&&void 0!==c[2]?c[2]:0,i=c.length>3?c[3]:void 0,a=c.length>4?c[4]:void 0,Ch(e,r,n,i),o=[],i.gltf.loadImages&&(s=Vh(e,i,a),o.push(s)),!i.gltf.loadBuffers){t.next=9;break}return t.next=9,Dh(e,i,a);case 9:return u=gh(e,i,a),o.push(u),t.next=13,Promise.all(o);case 13:return t.abrupt("return",i.gltf.postProcess?Nh(e,i):e);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ch(t,e,r,n){(n.uri&&(t.baseUri=n.uri),e instanceof ArrayBuffer&&!kh(e,r,n))&&(e=(new TextDecoder).decode(e));if("string"==typeof e)t.json=Cc(e);else if(e instanceof ArrayBuffer){var i={};r=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=new DataView(e);t.type=wh(i,r+0),t.version=i.getUint32(r+4,!0);var a=i.getUint32(r+8,!0);return t.header={byteOffset:r,byteLength:a},Ur(2===t.version,"Invalid GLB version ".concat(t.version,". Only supports v2.")),Ur(t.header.byteLength>20),t.json={},t.binChunks=[],xh(t,i,r+12,n),r+t.header.byteLength}(i,e,r,n),Fc("glTF"===i.type,"Invalid GLB magic string ".concat(i.type)),t._glb=i,t.json=i.json}else Fc(!1,"GLTF: must be ArrayBuffer or string");var a=t.json.buffers||[];if(t.buffers=new Array(a.length).fill(null),t._glb&&t._glb.header.hasBinChunk){var o=t._glb.binChunks;t.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}var s=t.json.images||[];t.images=new Array(s.length).fill({})}function Dh(t,e,r){return Bh.apply(this,arguments)}function Bh(){return(Bh=Pr(xr.a.mark((function t(e,r,n){var i,a,o,s,u,c;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=0;case 1:if(!(i<e.json.buffers.length)){t.next=18;break}if(!(a=e.json.buffers[i]).uri){t.next=15;break}return Fc(o=n.fetch),s=Uc(a.uri,r),t.next=9,o(s);case 9:return u=t.sent,t.next=12,u.arrayBuffer();case 12:c=t.sent,e.buffers[i]={arrayBuffer:c,byteOffset:0,byteLength:c.byteLength},delete a.uri;case 15:++i,t.next=1;break;case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Vh(t,e,r){return Fh.apply(this,arguments)}function Fh(){return(Fh=Pr(xr.a.mark((function t(e,r,n){var i,a,o;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=e.json.images||[],a=[],o=0;o<i.length;++o)a.push(Uh(e,i[o],o,r,n));return t.next=5,Promise.all(a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Uh(t,e,r,n,i){return qh.apply(this,arguments)}function qh(){return(qh=Pr(xr.a.mark((function t(e,r,n,i,a){var o,s,u,c,h,l,f;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=a.fetch,s=a.parse,!r.uri){t.next=9;break}return c=Uc(r.uri,i),t.next=5,o(c);case 5:return h=t.sent,t.next=8,h.arrayBuffer();case 8:u=t.sent;case 9:return Number.isFinite(r.bufferView)&&(l=qc(e.json,e.buffers,r.bufferView),u=Bc(l.buffer,l.byteOffset,l.byteLength)),Fc(u,"glTF image has no data"),t.next=13,s(u,Ic,{},a);case 13:f=t.sent,e.images[n]=f;case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function zh(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Gh(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?zh(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):zh(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Wh={id:"gltf",name:"glTF",version:"2.1.1",extensions:["gltf","glb"],mimeType:"model/gltf+json",text:!0,binary:!0,test:"glTF",parse:function(t){return Zh.apply(this,arguments)},options:{gltf:{loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},uri:"",log:console}},Hh=Wh;function Zh(){return(Zh=Pr(xr.a.mark((function t(e){var r,n,i,a,o,s=arguments;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},n=s.length>2?s[2]:void 0,(r=Gh({},Wh.options,{},r)).gltf=Gh({},Wh.options.gltf,{},r.gltf),Kh(r),i=r.byteOffset,a=void 0===i?0:i,o={},t.next=9,Ih(o,e,a,r,n);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Kh(t){"fetchImages"in t&&(t.gltf.loadImages=t.fetchImages),"createImages"in t&&(t.gltf.loadImages=t.createImages),"fetchLinkedResources"in t&&(t.gltf.fetchBuffers=t.fetchLinkedResources),"decompress"in t&&(t.gltf.decompressMeshes=t.decompress),"decompress"in t.gltf&&(t.gltf.decompressMeshes=t.gltf.decompress),"postProcess"in t&&(t.gltf.postProcess=t.postProcess)}var Yh=0,Qh=1;function Jh(t,e,r){t.rotateYtoZ=!0;var n=t.byteOffset+t.byteLength-r;if(0===n)throw new Error("glTF byte length must be greater than 0.");return t.gltfArrayBuffer=Bc(e,r,n),t.gltfByteOffset=0,t.gltfByteLength=n,r%4==0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}function Xh(t,e,r,n){return $h.apply(this,arguments)}function $h(){return($h=Pr(xr.a.mark((function t(e,r,n,i){var a,o;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(tl(e,r,n),!n.loadGLTF){t.next=15;break}if(a=i.parse,o=i.fetch,!e.gltfUrl){t.next=8;break}return t.next=6,o(e.gltfUrl,n);case 6:e.gltfArrayBuffer=t.sent,e.gltfByteOffset=0;case 8:if(!e.gltfArrayBuffer){t.next=15;break}return t.next=11,a(e.gltfArrayBuffer,Hh,n,i);case 11:e.gltf=t.sent,delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function tl(t,e,r){switch(e){case Yh:var n=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),i=(new TextDecoder).decode(n);t.gltfUrl=i.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Qh:break;default:throw new Error("b3dm: Illegal glTF format field")}}function el(t,e,r,n,i){return rl.apply(this,arguments)}function rl(){return(rl=Pr(xr.a.mark((function t(e,r,n,i,a){var o,s;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=nl(e,r,n,i,a),t.next=3,Xh(e,Qh,i,a);case 3:return o=e.gltf||{},(s=o.extensions)&&s.CESIUM_RTC&&(e.rtcCenter=s.CESIUM_RTC.center),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function nl(t,e,r,n,i){r=Jh(t,e,r=Eu(t,e,r=Mu(t,e,r=Su(t,e,r,n))));var a=new pu(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=a.getGlobalProperty("RTC_CENTER",lu.FLOAT,3),r}function il(){var t=new Ie(4);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function al(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function ol(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],c=r[2],h=r[3];return t[0]=n*h+o*s+i*c-a*u,t[1]=i*h+o*u+a*s-n*c,t[2]=a*h+o*c+n*u-i*s,t[3]=o*h-n*s-i*u-a*c,t}function sl(t,e,r,n){var i,a,o,s,u,c=e[0],h=e[1],l=e[2],f=e[3],d=r[0],y=r[1],p=r[2],v=r[3];return(a=c*d+h*y+l*p+f*v)<0&&(a=-a,d=-d,y=-y,p=-p,v=-v),1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o):(s=1-n,u=n),t[0]=s*c+u*d,t[1]=s*h+u*y,t[2]=s*l+u*p,t[3]=s*f+u*v,t}function ul(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*a+a]-e[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*a+o]-e[3*o+a])*r,t[a]=(e[3*a+i]+e[3*i+a])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}return t}var cl,hl,ll,fl,dl,yl,pl=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},vl=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},gl=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},ml=function(t,e,r,n){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t[3]=s+n*(r[3]-s),t},bl=nr,wl=ir,kl=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=a*o,t},xl=(cl=Fe(),hl=qe(1,0,0),ll=qe(0,1,0),function(t,e,r){var n=Ge(e,r);return n<-.999999?(We(cl,hl,e),Ke(cl)<1e-6&&We(cl,ll,e),ze(cl,cl),al(t,cl,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(We(cl,e,r),t[0]=cl[0],t[1]=cl[1],t[2]=cl[2],t[3]=1+n,kl(t,t))}),_l=(fl=il(),dl=il(),yl=function(){var t=new Ie(9);return Ie!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}(),[0,0,0,1]),Tl=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return re(this,e),t=oe(this,se(e).call(this,-0,-0,-0,-0)),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,n,i,a),t}return ce(e,t),ie(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}},{key:"fromMatrix3",value:function(t){return ul(this,t),this.check()}},{key:"identity",value:function(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}},{key:"fromAxisRotation",value:function(t,e){return al(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"len",value:function(){return bl(this)}},{key:"lengthSquared",value:function(t){return wl(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return gl(this,t)}},{key:"rotationTo",value:function(t,e){return xl(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return pl(this,this,t),this.check()}},{key:"calculateW",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2];t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i))}(this,this),this.check()}},{key:"conjugate",value:function(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;t[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=a*s}(this,this),this.check()}},{key:"lerp",value:function(t,e,r){return ml(this,t,e,r),this.check()}},{key:"multiplyRight",value:function(t,e){return ye(!e),ol(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return ye(!e),ol(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s}(this,this,t),this.check()}},{key:"scale",value:function(t){return vl(this,this,t),this.check()}},{key:"slerp",value:function(t,e,r){switch(arguments.length){case 1:var n=arguments[0],i=n.start;t=void 0===i?_l:i,e=n.target,r=n.ratio;break;case 2:var a=Array.prototype.slice.call(arguments);e=a[0],r=a[1],t=this}return sl(this,t,e,r),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return ar(e,t,this),Le(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Pe(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Pe(t)}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Pe(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=Pe(t)}}]),e}(Ee);function Ol(t,e,r,n,i){return Sl.apply(this,arguments)}function Sl(){return(Sl=Pr(xr.a.mark((function t(e,r,n,i,a){return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ml(e,r,n,i,a),t.next=3,Xh(e,e.gltfFormat,i,a);case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ml(t,e,r,n,i){if(r=Su(t,e,r,n),1!==t.version)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));r=Mu(t,e,r);var a=new DataView(e);if(t.gltfFormat=a.getUint32(r,!0),r=Jh(t,e,r=Eu(t,e,r+=4)),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var o=new pu(t.featureTableJson,t.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",lu.FLOAT,3);new Ou(t.batchTableJson,t.batchTableBinary,s);return function(t,e,r,n){for(var i=[new Array(n),t._batchTable][0],a=new Qe,o=(new Qe,new Qe,new Qe,new Os),s=new Tl,u=new Qe,c={},h=new hr,l=[],f=[],d=new Qe,y=new Qe,p=0;p<n;p++){var v=void 0;if(e.hasProperty("POSITION"))v=e.getProperty("POSITION",lu.FLOAT,3,p,a);else if(e.hasProperty("POSITION_QUANTIZED")){v=e.getProperty("POSITION_QUANTIZED",lu.UNSIGNED_SHORT,3,p,a);var g=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",lu.FLOAT,3,d);if(!g)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var m=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",lu.FLOAT,3,y);if(!m)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var b=0;b<3;b++)v[b]=v[b]/65535*m[b]+g[b]}if(!v)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");a.copy(v),c.translation=a,t.normalUp=e.getProperty("NORMAL_UP",lu.FLOAT,3,p,l),t.normalRight=e.getProperty("NORMAL_RIGHT",lu.FLOAT,3,p,f);if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",lu.UNSIGNED_SHORT,2,l),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",lu.UNSIGNED_SHORT,2,f),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(Zi.WGS84.eastNorthUpToFixedFrame(a,h),h.getRotationMatrix3(o)):o.identity()}!1,s.fromMatrix3(o),c.rotation=s,u.set(1,1,1);var w=e.getProperty("SCALE",lu.FLOAT,1,p);Number.isFinite(w)&&u.multiplyByScalar(w);var k=e.getProperty("SCALE_NON_UNIFORM",lu.FLOAT,3,p,l);k&&u.scale(k),c.scale=u;var x=e.getProperty("BATCH_ID",lu.UNSIGNED_SHORT,1,p);void 0===x&&(x=p);var _=(new hr).fromQuaternion(c.rotation);h.identity(),h.translate(c.translation),h.multiplyRight(_),h.scale(c.scale);var T=h.clone();i[p]={modelMatrix:T,batchId:x}}t.instances=i}(t,o,0,s),r}function El(t,e,r,n,i,a){return Pl.apply(this,arguments)}function Pl(){return(Pl=Pr(xr.a.mark((function t(e,r,n,i,a,o){var s,u;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Su(e,r,n,i),s=new DataView(r),e.tilesLength=s.getUint32(n,!0),n+=4,e.tiles=[];case 5:if(!(e.tiles.length<e.tilesLength&&e.byteLength-n>12)){t.next=13;break}return u={},e.tiles.push(u),t.next=10,o(r,n,i,a,u);case 10:n=t.sent,t.next=5;break;case 13:return t.abrupt("return",n);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ll(t){return Al.apply(this,arguments)}function Al(){return(Al=Pr(xr.a.mark((function t(e){var r,n,i,a,o=arguments;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=o.length>1&&void 0!==o[1]?o[1]:0,n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,a=o.length>4&&void 0!==o[4]?o[4]:{},n=n["3d-tiles"]||{},a.byteOffset=r,a.type=su(e,r),t.t0=a.type,t.next=t.t0===au.COMPOSITE?10:t.t0===au.BATCHED_3D_MODEL?13:t.t0===au.INSTANCED_3D_MODEL?16:t.t0===au.POINT_CLOUD?19:22;break;case 10:return t.next=12,El(a,e,r,n,i,Ll);case 12:return t.abrupt("return",t.sent);case 13:return t.next=15,el(a,e,r,n,i);case 15:return t.abrupt("return",t.sent);case 16:return t.next=18,Ol(a,e,r,n,i);case 18:return t.abrupt("return",t.sent);case 19:return t.next=21,Fu(a,e,r,n,i);case 21:return t.abrupt("return",t.sent);case 22:throw new Error("3DTileLoader: unknown type ".concat(a.type));case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function jl(t,e){return t.content&&(t.contentUrl="".concat(e.basePath,"/").concat(t.content.uri)),t.id=t.contentUrl,t.lodMetricType=vs,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=function(t){if(!t.contentUrl)return hs;var e=t.contentUrl.split(".").pop();switch(e){case"pnts":return fs;case"i3dm":case"b3dm":return ls;default:return e}}(t),t.refine=function(t){switch(t){case"REPLACE":case"replace":return cs;case"ADD":case"add":return us;default:return t}}(t.refine),t}function Nl(t){var e=t.basePath,r=jl(t.root,t),n=[];for(n.push(r);n.length>0;){var i=n.pop().children||[],a=!0,o=!1,s=void 0;try{for(var u,c=i[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value;jl(h,{basePath:e}),n.push(h)}}catch(t){o=!0,s=t}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}}return r}function Il(t){return n.dirname(t.url)}function Rl(t,e,r){return Cl.apply(this,arguments)}function Cl(){return(Cl=Pr(xr.a.mark((function t(e,r,n){var i;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i={}).content=i.content||{},0,t.next=5,Ll(e,0,r,n,i.content);case 5:return t.abrupt("return",i.content);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Dl(t,e,r){return Bl.apply(this,arguments)}function Bl(){return(Bl=Pr(xr.a.mark((function t(e,r,n){var i;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=JSON.parse((new TextDecoder).decode(e))).loader=r.loader||Fl,i.url=n.url,i.basePath=Il(i),i.root=Nl(i),i.type=ps,i.lodMetricType=vs,i.lodMetricValue=i.root.lodMetricValue,t.abrupt("return",i);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Vl(){return(Vl=Pr(xr.a.mark((function t(e,r,n,i){var a;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r["3d-tiles"]||{},!("isTileset"in a?r.isTileset:n.url&&-1!==n.url.indexOf(".json"))){t.next=8;break}return t.next=5,Dl(e,r,n,i);case 5:e=t.sent,t.next=11;break;case 8:return t.next=10,Rl(e,r,n);case 10:e=t.sent;case 11:return t.abrupt("return",e);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Fl={id:"3d-tiles",name:"3D Tiles",version:"2.1.1",extensions:["json","cmpt","pnts","b3dm","i3dm"],mimeType:"application/octet-stream",test:["json","cmpt","pnts","b3dm","i3dm"],parse:function(t,e,r,n){return Vl.apply(this,arguments)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1}}},Ul=Fl;function ql(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function zl(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ql(Object(r),!0).forEach((function(e){Tr()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ql(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Gl=new Qe,Wl={getPointColor:[0,0,0],pointSize:1,data:null,loadOptions:{},loader:Ul,onTilesetLoad:function(t){},onTileLoad:function(t){},onTileUnload:function(t){},onTileError:function(t,e,r){}},Hl=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}var r;return b()(e,t),l()(e,[{key:"initializeState",value:function(){"onTileLoadFail"in this.props&&w.log.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,r=t.oldProps,n=t.changeFlags;if(e.data&&e.data!==r.data&&this._loadTileset(e.data),n.viewportChanged){var i=this.state.tileset3d;this._updateTileset(i)}}},{key:"getPickingInfo",value:function(t){var e=t.info,r=t.sourceLayer,n=this.state.layerMap,i=r&&r.id;if(i){var a=i.substring(this.id.length+1),o=a.substring(a.indexOf("-")+1);e.object=n[o]&&n[o].tile}return e}},{key:"_loadTileset",value:(r=Sr()(xr.a.mark((function t(e){var r,n,i,a,o,s,u;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.props,n=r.loader,i=r.loadOptions,a=zl({},i),!n.preload){t.next=7;break}return t.next=5,n.preload(e,i);case 5:o=t.sent,Object.assign(a,o);case 7:return t.next=9,ki(e,n,a);case 9:s=t.sent,u=new iu(s,zl({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileLoadFail:this.props.onTileError},a)),this.setState({tileset3d:u,layerMap:{}}),this._updateTileset(u),this.props.onTilesetLoad(u);case 14:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"_onTileLoad",value:function(t){this.props.onTileLoad(t),this._updateTileset(this.state.tileset3d),this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}},{key:"_updateTileset",value:function(t){var e=this.context,r=e.timeline,n=e.viewport;if(r&&n&&t){var i=t.update(n);this.state.frameNumber!==i&&this.setState({frameNumber:i})}}},{key:"_create3DTileLayer",value:function(t){if(!t.content)return null;switch(t.type){case fs:return this._createPointCloudTileLayer(t);case ls:return this._create3DModelTileLayer(t);case ds:return this._createSimpleMeshLayer(t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}},{key:"_createPointCloudTileLayer",value:function(t){var e=t.content,r=e.attributes,n=e.pointCount,i=e.constantRGBA,a=e.cartographicOrigin,o=e.modelMatrix,s=r.positions,u=r.normals,c=r.colors;if(!s)return null;var h=this.props,l=h.pointSize,f=h.getPointColor;return new(this.getSubLayerClass("pointcloud",w.PointCloudLayer))({pointSize:l},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),data:{header:{vertexCount:n},attributes:{POSITION:s,NORMAL:u,COLOR_0:c}},coordinateSystem:w.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:i||f})}},{key:"_create3DModelTileLayer",value:function(t){var e=t.content,r=e.gltf,n=e.instances,i=e.cartographicOrigin,a=e.modelMatrix;return new(this.getSubLayerClass("scenegraph",w.ScenegraphLayer))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),data:n||[{}],scenegraph:r,coordinateSystem:w.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:i,modelMatrix:a,getTransformMatrix:function(t){return t.modelMatrix},getPosition:function(t){return[0,0,0]}})}},{key:"_createSimpleMeshLayer",value:function(t){for(var e=t.content,r=e.attributes,n=e.modelMatrix,i=e.cartographicOrigin,a=e.texture,o=r.normals,s=r.texCoords,u=new Float32Array(r.positions.value.length),c=0;c<u.length;c+=3)Gl.copy(r.positions.value.subarray(c,c+3)),u.set(Gl,c);var h=new Mr.Geometry({drawMode:4,attributes:{positions:u,normals:o,texCoords:s}});return new(this.getSubLayerClass("mesh",w.SimpleMeshLayer))(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),mesh:h,data:[{}],getPosition:[0,0,0],getColor:[255,255,255],texture:a,modelMatrix:n,coordinateOrigin:i,coordinateSystem:w.COORDINATE_SYSTEM.METER_OFFSETS})}},{key:"renderLayers",value:function(){var t=this,e=this.state,r=e.tileset3d,n=e.layerMap;return r?r.tiles.map((function(e){var r=n[e.id]&&n[e.id].layer;return e.selected?(r||(r=t._create3DTileLayer(e),n[e.id]={layer:r,tile:e}),r&&r.props&&!r.props.visible&&(r=r.clone({visible:!0}),n[e.id].layer=r),r):(r&&r.props&&r.props.visible&&(r=r.clone({visible:!1}),n[e.id].layer=r),r)})).filter(Boolean):null}}]),e}(w.CompositeLayer);Hl.layerName="Tile3DLayer",Hl.defaultProps=Wl;class Zl{constructor(t=257){this.gridSize=t;const e=t-1;if(e&e-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=e*e*2-2,this.numParentTriangles=this.numTriangles-e*e,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let t=0;t<this.numTriangles;t++){let r=t+2,n=0,i=0,a=0,o=0,s=0,u=0;for(1&r?a=o=s=e:n=i=u=e;(r>>=1)>1;){const t=n+a>>1,e=i+o>>1;1&r?(a=n,o=i,n=s,i=u):(n=a,i=o,a=s,o=u),s=t,u=e}const c=4*t;this.coords[c+0]=n,this.coords[c+1]=i,this.coords[c+2]=a,this.coords[c+3]=o}}createTile(t){return new Kl(t,this)}}class Kl{constructor(t,e){const r=e.gridSize;if(t.length!==r*r)throw new Error(`Expected terrain data of length ${r*r} (${r} x ${r}), got ${t.length}.`);this.terrain=t,this.martini=e,this.errors=new Float32Array(t.length),this.update()}update(){const{numTriangles:t,numParentTriangles:e,coords:r,gridSize:n}=this.martini,{terrain:i,errors:a}=this;for(let o=t-1;o>=0;o--){const t=4*o,s=r[t+0],u=r[t+1],c=r[t+2],h=r[t+3],l=s+c>>1,f=u+h>>1,d=l+f-u,y=f+s-l,p=(i[u*n+s]+i[h*n+c])/2,v=f*n+l,g=Math.abs(p-i[v]);if(a[v]=Math.max(a[v],g),o<e){const t=(u+y>>1)*n+(s+d>>1),e=(h+y>>1)*n+(c+d>>1);a[v]=Math.max(a[v],a[t],a[e])}}}getMesh(t=0){const{gridSize:e,indices:r}=this.martini,{errors:n}=this;let i=0,a=0;const o=e-1;function s(o,u,c,h,l,f){const d=o+c>>1,y=u+h>>1;Math.abs(o-l)+Math.abs(u-f)>1&&n[y*e+d]>t?(s(l,f,o,u,d,y),s(c,h,l,f,d,y)):(r[u*e+o]=r[u*e+o]||++i,r[h*e+c]=r[h*e+c]||++i,r[f*e+l]=r[f*e+l]||++i,a++)}r.fill(0),s(0,0,o,o,o,0),s(o,o,0,0,0,o);const u=new Uint16Array(2*i),c=new Uint32Array(3*a);let h=0;function l(i,a,o,s,f,d){const y=i+o>>1,p=a+s>>1;if(Math.abs(i-f)+Math.abs(a-d)>1&&n[p*e+y]>t)l(f,d,i,a,y,p),l(o,s,f,d,y,p);else{const t=r[a*e+i]-1,n=r[s*e+o]-1,l=r[d*e+f]-1;u[2*t]=i,u[2*t+1]=a,u[2*n]=o,u[2*n+1]=s,u[2*l]=f,u[2*l+1]=d,c[h++]=t,c[h++]=n,c[h++]=l}}return l(0,0,o,o,o,0),l(o,o,0,0,0,o),{vertices:u,triangles:c}}}function Yl(t){if(!t||!t.POSITION)return null;var e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=t.POSITION.value,u=s&&s.length;if(!u)return null;for(var c=0;c<u;c+=3){var h=s[c],l=s[c+1],f=s[c+2];e=h<e?h:e,r=l<r?l:r,n=f<n?f:n,i=h>i?h:i,a=l>a?l:a,o=f>o?f:o}return[[e,r,n],[i,a,o]]}function Ql(t,e){if(null===t)return null;var r=e.meshMaxError,n=e.bounds,i=e.elevationDecoder,a=t.data,o=t.width,s=o+1,u=function(t,e,r){for(var n=r.rScaler,i=r.bScaler,a=r.gScaler,o=r.offset,s=e+1,u=new Float32Array(s*s),c=0,h=0;h<e;h++)for(var l=0;l<e;l++,c++){var f=4*c,d=t[f+0],y=t[f+1],p=t[f+2];u[c+h]=d*n+y*a+p*i+o}for(var v=s*(s-1),g=0;g<s-1;g++,v++)u[v]=u[v-s];for(var m=s-1,b=0;b<s;b++,m+=s)u[m]=u[m-1];return u}(a,o,i),c=new Zl(s).createTile(u).getMesh(r),h=c.vertices,l=c.triangles,f=function(t,e,r,n){for(var i=r+1,a=t.length/2,o=new Float32Array(3*a),s=new Float32Array(2*a),u=Je(n||[0,0,r,r],4),c=u[0],h=u[1],l=u[2],f=u[3],d=(l-c)/r,y=(f-h)/r,p=0;p<a;p++){var v=t[2*p],g=t[2*p+1],m=g*i+v;o[3*p+0]=v*d+c,o[3*p+1]=-g*y+f,o[3*p+2]=e[m],s[2*p+0]=v/r,s[2*p+1]=g/r}return{POSITION:{value:o,size:3},TEXCOORD_0:{value:s,size:2}}}(h,u,o,n);return{loaderData:{header:{}},header:{vertexCount:l.length,boundingBox:Yl(f)},mode:4,indices:{value:l,size:1},attributes:f}}function Jl(){return(Jl=Pr(xr.a.mark((function t(e,r,n){var i;return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.image=r.image||{},r.image.type="data",t.next=4,n.parse(e,r,r.baseUri);case 4:return i=t.sent,t.abrupt("return",Ql(i,r.terrain));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Xl(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var $l=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xl(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xl(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},{id:"terrain",name:"Terrain",version:"2.1.1",extensions:["png","pngraw"],mimeType:"image/png",options:{terrain:{workerUrl:"https://unpkg.com/@loaders.gl/terrain@".concat("2.1.1","/dist/terrain-loader.worker.js"),meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0}}}},{parse:function(t,e,r){return Jl.apply(this,arguments)}});function tf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var ef=[1],rf=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tf(Object(r),!0).forEach((function(e){Tr()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tf(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},Yt.defaultProps,{elevationData:Nt,texture:Nt,meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:{type:"string",value:null},wireframe:!1,material:!0});function nf(t){return Array.isArray(t)?t.join(";"):t}var af=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}return b()(e,t),l()(e,[{key:"updateState",value:function(t){var e=t.props,r=t.oldProps,n=e.elevationData!==r.elevationData;if(n){var i=e.elevationData,a=i&&(Array.isArray(i)||i.includes("{x}")&&i.includes("{y}"));this.setState({isTiled:a})}var o=n||e.meshMaxError!==r.meshMaxError||e.elevationDecoder!==r.elevationDecoder||e.bounds!==r.bounds;if(!this.state.isTiled&&o){var s=this.loadTerrain(e);this.setState({terrain:s})}}},{key:"loadTerrain",value:function(t){var e=t.elevationData,r=t.bounds,n=t.elevationDecoder,i=t.meshMaxError,a=t.workerUrl;if(!e)return null;var o={terrain:{bounds:r,meshMaxError:i,elevationDecoder:n}};return null!==a&&(o.terrain.workerUrl=a),ki(e,$l,o)}},{key:"getTiledTerrainData",value:function(t){var e=this.props,r=e.elevationData,n=e.texture,i=e.elevationDecoder,a=e.meshMaxError,o=e.workerUrl,s=It(r,t),u=It(n,t),c=t.bbox,h=t.z,l=new w.WebMercatorViewport({longitude:(c.west+c.east)/2,latitude:(c.north+c.south)/2,zoom:h}),f=l.projectFlat([c.west,c.south]),d=l.projectFlat([c.east,c.north]),y=[f[0],f[1],d[0],d[1]],p=this.loadTerrain({elevationData:s,bounds:y,elevationDecoder:i,meshMaxError:a,workerUrl:o}),v=u?ki(u).catch((function(t){return null})):Promise.resolve(null);return Promise.all([p,v])}},{key:"renderSubLayers",value:function(t){var e=this.getSubLayerClass("mesh",w.SimpleMeshLayer),r=t.data,n=t.color,i=null,a=null;return Array.isArray(r)?(i=r[0],a=r[1]):r&&(i=r.then((function(t){return t&&t[0]})),a=r.then((function(t){return t&&t[1]}))),new e(t,{data:ef,mesh:i,texture:a,coordinateSystem:w.COORDINATE_SYSTEM.CARTESIAN,getPosition:function(t){return[0,0,0]},getColor:n})}},{key:"onViewportLoad",value:function(t){if(t&&0!==t.length&&!t.every((function(t){return!t}))){var e=this.state.zRange,r=t.map((function(t){return t[0].header.boundingBox.map((function(t){return t[2]}))})),n=Math.min.apply(Math,B()(r.map((function(t){return t[0]})))),i=Math.max.apply(Math,B()(r.map((function(t){return t[1]}))));(!e||n<e[0]||i>e[1])&&this.setState({zRange:[n,i]})}}},{key:"renderLayers",value:function(){var t=this.props,e=t.color,r=t.material,n=t.elevationData,i=t.texture,a=t.wireframe,o=t.meshMaxError,s=t.elevationDecoder;return this.state.isTiled?new Yt(this.getSubLayerProps({id:"tiles"}),{wireframe:a,color:e,material:r,getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:nf(n),texture:nf(i),meshMaxError:o,elevationDecoder:s}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null}):new(this.getSubLayerClass("mesh",w.SimpleMeshLayer))(this.getSubLayerProps({id:"mesh"}),{data:ef,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:function(t){return[0,0,0]},getColor:e,material:r,wireframe:a})}}]),e}(w.CompositeLayer);af.layerName="TerrainLayer",af.defaultProps=rf;var of=r(25),sf=r(26),uf=r.n(sf),cf=["Unknown","Point","LineString","Polygon"];function hf(t,e){for(var r=0;r<t.length;r++){var n=t[r];t[r]=[n.x/e.extent,n.y/e.extent]}}function lf(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t,e){return t};return function(){var r=cf[t.type],n=t.loadGeometry();switch(t.type){case 1:for(var i=[],a=0;a<n.length;a++)i[a]=n[a][0];e(n=i,t);break;case 2:for(var o=0;o<n.length;o++)e(n[o],t);break;case 3:n=df(n);for(var s=0;s<n.length;s++)for(var u=0;u<n[s].length;u++)e(n[s][u],t)}return ff(r,t,n)}()}function ff(t,e,r){var n=t;1===r.length?r=r[0]:n="Multi".concat(t);var i={type:"Feature",geometry:{type:n,coordinates:r},properties:e.properties||{}};return"id"in e&&(i.id=e.id),i}function df(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],a=0;a<e;a++){var o=yf(t[a]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(r&&i.push(r),r=[t[a]]):r.push(t[a]))}return r&&i.push(r),i}function yf(t){for(var e,r,n=t.length,i=0,a=0,o=n-1;a<n;o=a++)e=t[a],i+=((r=t[o]).x-e.x)*(e.y+r.y);return i}function pf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function vf(t,e){if(0===t.byteLength)return[];var r=new of.VectorTile(new uf.a(t)),n=e.mvt,i=[];return(Array.isArray(n.layers)?n.layers:Object.keys(r.layers)).forEach((function(t){var e=r.layers[t],a=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?pf(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pf(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},n,{layerName:t});if(e)for(var o=0;o<e.length;o++){var s=gf(e.feature(o),a);i.push(s)}})),i}function gf(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="wgs84"===e.coordinates,n=e.tileIndex&&e.tileIndex.x&&e.tileIndex.y&&e.tileIndex.z;if(r&&!n)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property. Check documentation.");var i=r&&n?t.toGeoJSON(e.tileIndex.x,e.tileIndex.y,e.tileIndex.z):lf(t,hf);return e.layerProperty&&(i.properties[e.layerProperty]=e.layerName),i}function mf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var bf,wf=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?mf(Object(r),!0).forEach((function(e){Kr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mf(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},{id:"mvt",name:"Mapbox Vector Tile",version:"2.1.1",extensions:["mvt"],mimeType:"application/x-protobuf",category:"geometry",options:{mvt:{coordinates:"local",layerProperty:"layerName",layers:null,tileIndex:null,workerUrl:"https://unpkg.com/@loaders.gl/mvt@".concat("2.1.1","/dist/mvt-loader.worker.js")}}},{parse:(bf=Pr(xr.a.mark((function t(e,r){return xr.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",vf(e,r));case 1:case"end":return t.stop()}}),t)}))),function(t,e){return bf.apply(this,arguments)}),parseSync:vf,binary:!0}),kf={clipBounds:[0,0,1,1]},xf="\nuniform vec4 clip_bounds;\n\nbool clip_isInBounds(vec2 position) {\n  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];\n}\n",_f={name:"clip-vs",vs:xf},Tf={"vs:#decl":"\nvarying float clip_isVisible;\n","vs:DECKGL_FILTER_GL_POSITION":"\n  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));\n","fs:#decl":"\nvarying float clip_isVisible;\n","fs:DECKGL_FILTER_COLOR":"\n  if (clip_isVisible < 0.5) discard;\n"},Of={name:"clip-fs",fs:xf},Sf={"vs:#decl":"\nvarying vec2 clip_commonPosition;\n","vs:DECKGL_FILTER_GL_POSITION":"\n  clip_commonPosition = geometry.position.xy;\n","fs:#decl":"\nvarying vec2 clip_commonPosition;\n","fs:DECKGL_FILTER_COLOR":"\n  if (!clip_isInBounds(clip_commonPosition)) discard;\n"},Mf=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}return b()(e,t),l()(e,[{key:"getShaders",value:function(){var t="instancePositions"in this.getAttributeManager().attributes;return"clipByInstance"in this.props&&(t=this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[_f],inject:Tf}:{modules:[Of],inject:Sf}}},{key:"draw",value:function(t){var e=t.uniforms,r=this.props.clipBounds,n=void 0===r?kf.clipBounds:r;if(this.state.clipByInstance)e.clip_bounds=n;else{var i=this.projectPosition([n[0],n[1],0]),a=this.projectPosition([n[2],n[3],0]);e.clip_bounds=[Math.min(i[0],a[0]),Math.min(i[1],a[1]),Math.max(i[0],a[0]),Math.max(i[1],a[1])]}}}]),e}(w.LayerExtension);Mf.extensionName="ClipExtension",Mf.defaultProps=kf;var Ef=function(t){function e(){return c()(this,e),d()(this,p()(e).apply(this,arguments))}return b()(e,t),l()(e,[{key:"getTileData",value:function(t){var e=It(this.props.data,t);return e?ki(e,wf,this.getLoadOptions()):Promise.reject("Invalid URL")}},{key:"renderSubLayers",value:function(t){var r=t.tile,n=Math.pow(2,r.z),i=512/n,a=-i,o=512*r.x/n,s=512*(1-r.y/n),u=(new hr).translate([o,s,0]).scale([i,a,1]);return t.modelMatrix=u,t.coordinateSystem=w.COORDINATE_SYSTEM.CARTESIAN,t.extensions=[].concat(B()(t.extensions||[]),[new Mf]),g()(p()(e.prototype),"renderSubLayers",this).call(this,t)}}]),e}(Yt);Ef.layerName="MVTLayer",r.d(e,"GreatCircleLayer",(function(){return k})),r.d(e,"S2Layer",(function(){return R})),r.d(e,"TileLayer",(function(){return Yt})),r.d(e,"TripsLayer",(function(){return Qt})),r.d(e,"H3ClusterLayer",(function(){return $t})),r.d(e,"H3HexagonLayer",(function(){return wr})),r.d(e,"Tile3DLayer",(function(){return Hl})),r.d(e,"TerrainLayer",(function(){return af})),r.d(e,"MVTLayer",(function(){return Ef}))}])}));