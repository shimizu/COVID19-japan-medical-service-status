{"ast":null,"code":"var _jsxFileName = \"/Users/idg08/Desktop/works/hospital/src/App.js\";\nimport React, { useEffect, useState, useRef } from \"react\";\nimport AppBar from \"@material-ui/core/AppBar\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Typography from \"@material-ui/core/Typography\";\nimport MapGL from \"react-map-gl\";\nimport DeckGL, { MapController } from \"deck.gl\";\nimport layers from \"./components/Layers\";\nimport CheckBoxs from \"./components/CheckBoxs\";\nimport BottomBtn from \"./components/BottomBtn\";\nimport { parse, fetchFile } from '@loaders.gl/core';\nimport { ZipLoader } from '@loaders.gl/zip';\nimport decodeText from './components/DecodeText.js';\nimport { csv as d3csv } from 'd3-fetch';\nimport { csvParse } from 'd3-dsv'; //mapboxのトークンは自分で取得したものに変更してください。\n//このトークンは突然使えなくなる可能性があります。\n\nconst MAPBOX_TOKEN = \"pk.eyJ1Ijoic2hpbWl6dSIsImEiOiJjam95MDBhamYxMjA1M2tyemk2aHMwenp5In0.i2kMIJulhyPLwp3jiLlpsA\";\nconst DATA_URL = \"data/covid-19_daily_survey.zip\"; //data convert fnction\n\nconst csvcast = (d, i) => {\n  d.id = d.code;\n  Object.keys(d).forEach(key => {\n    if (!isNaN(+d[key]) && key !== 'id') d[key] = +d[key];\n  });\n  return d;\n};\n\nfunction App() {\n  const mapRef = useRef(null);\n  const bbtnRef = useRef(null);\n  const [data, setData] = useState(null);\n  const [selectedCheckbox, setSelectedCheckbox] = useState({\n    normal: true,\n    restriction: true,\n    stop: true,\n    nobeds: true,\n    unanswered: true\n  });\n  const [selectLayerType, setSelectLayerType] = useState(\"point\");\n  const [viewport, setViewport] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    longitude: 139.0110974,\n    latitude: 36.3226885,\n    zoom: 6,\n    maxZoom: 20\n  });\n\n  const getMapsize = () => {\n    const width = mapRef.current ? mapRef.current.offsetWidth : 0;\n    const height = mapRef.current ? mapRef.current.offsetHeight : 0;\n    const bbtnHeight = bbtnRef.current ? bbtnRef.current.offsetHeight : 0;\n    setViewport(v => {\n      return { ...v,\n        width: width,\n        height: height - bbtnHeight\n      };\n    });\n  }; //ロード時にコンポネーントのwidth,heightを取得\n\n\n  useEffect(getMapsize, []);\n  useEffect(() => {\n    //地価データ取得\n    const fetchData = async url => {\n      const buff = await parse(fetchFile(url), ZipLoader);\n      const key = Object.keys(buff)[0];\n      decodeText(buff[key]).then(text => {\n        const loadData = csvParse(text, csvcast);\n        setData(loadData);\n      });\n    };\n\n    fetchData(DATA_URL);\n  }, []); //resize\n\n  useEffect(() => {\n    window.addEventListener(\"resize\", getMapsize);\n    return () => window.removeEventListener(\"resize\", getMapsize);\n  }, []);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(AppBar, {\n    position: \"static\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Toolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }\n  }, \"\\u533B\\u7642\\u63D0\\u4F9B\\u4F53\\u5236\\u306E\\u72B6\\u6CC1\"))), /*#__PURE__*/React.createElement(CheckBoxs, {\n    value: selectedCheckbox,\n    changeCheckbox: setSelectedCheckbox,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"panel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"map\",\n    ref: mapRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(MapGL, Object.assign({\n    style: {}\n  }, viewport, {\n    mapStyle: \"mapbox://styles/mapbox/streets-v11\",\n    mapboxApiAccessToken: MAPBOX_TOKEN,\n    onViewportChange: v => setViewport(v),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(DeckGL, {\n    layers: layers({\n      data,\n      layerType: selectLayerType\n    }),\n    controller: {\n      type: MapController,\n      dragRotate: false\n    },\n    initialViewState: viewport,\n    controller: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"bottom\",\n    ref: bbtnRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(BottomBtn, {\n    value: selectLayerType,\n    onChange: setSelectLayerType,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 9\n    }\n  })));\n}\n\nexport default App;\n/*\n \n\n        */","map":{"version":3,"sources":["/Users/idg08/Desktop/works/hospital/src/App.js"],"names":["React","useEffect","useState","useRef","AppBar","Toolbar","Typography","MapGL","DeckGL","MapController","layers","CheckBoxs","BottomBtn","parse","fetchFile","ZipLoader","decodeText","csv","d3csv","csvParse","MAPBOX_TOKEN","DATA_URL","csvcast","d","i","id","code","Object","keys","forEach","key","isNaN","App","mapRef","bbtnRef","data","setData","selectedCheckbox","setSelectedCheckbox","normal","restriction","stop","nobeds","unanswered","selectLayerType","setSelectLayerType","viewport","setViewport","width","window","innerWidth","height","innerHeight","longitude","latitude","zoom","maxZoom","getMapsize","current","offsetWidth","offsetHeight","bbtnHeight","v","fetchData","url","buff","then","text","loadData","addEventListener","removeEventListener","layerType","type","dragRotate"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport AppBar from \"@material-ui/core/AppBar\";\n\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Typography from \"@material-ui/core/Typography\";\n\nimport MapGL from \"react-map-gl\";\nimport DeckGL, { MapController } from \"deck.gl\";\nimport layers from \"./components/Layers\";\n\n\nimport CheckBoxs from \"./components/CheckBoxs\";\nimport BottomBtn from \"./components/BottomBtn\";\n\nimport { parse, fetchFile } from '@loaders.gl/core';\nimport { ZipLoader } from '@loaders.gl/zip';\nimport decodeText from './components/DecodeText.js';\nimport { csv as d3csv } from 'd3-fetch';\nimport { csvParse } from 'd3-dsv';\n\n//mapboxのトークンは自分で取得したものに変更してください。\n//このトークンは突然使えなくなる可能性があります。\nconst MAPBOX_TOKEN =\n  \"pk.eyJ1Ijoic2hpbWl6dSIsImEiOiJjam95MDBhamYxMjA1M2tyemk2aHMwenp5In0.i2kMIJulhyPLwp3jiLlpsA\";\n\n  const DATA_URL = \"data/covid-19_daily_survey.zip\";\n\n\n\n//data convert fnction\nconst  csvcast = (d, i) => {\n\td.id = d.code;\n\tObject.keys(d).forEach((key) => {\n\t\tif (!isNaN(+d[key]) && key !== 'id') d[key] = +d[key];\n\t});\n\treturn d;\n};\n\n\nfunction App() {\n  const mapRef = useRef(null);\n  const bbtnRef = useRef(null);\n  const [data, setData] = useState(null);\n\n  const [selectedCheckbox, setSelectedCheckbox]  = useState({\n    normal: true,\n    restriction: true,\n    stop: true,\n    nobeds: true,\n    unanswered: true\n  });\n\n  const [selectLayerType, setSelectLayerType]  = useState(\"point\");\n\n\n  const [viewport, setViewport] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    longitude: 139.0110974,\n    latitude: 36.3226885,\n    zoom: 6,\n    maxZoom: 20\n  });\n\n\n\n  const getMapsize = () => {\n    const width = mapRef.current ? mapRef.current.offsetWidth : 0;\n    const height = mapRef.current ? mapRef.current.offsetHeight : 0;\n    const bbtnHeight = bbtnRef.current ? bbtnRef.current.offsetHeight : 0;\n\n    setViewport(v => {\n      return {\n        ...v,\n        width: width,\n        height: height - bbtnHeight\n      };\n    });\n  };\n\n  //ロード時にコンポネーントのwidth,heightを取得\n  useEffect(getMapsize, []);\n\n useEffect(()=>{\n\t\t//地価データ取得\n\t\tconst fetchData = async (url) => {\n\t\t\tconst buff = await parse(fetchFile(url), ZipLoader);\n\t\t\tconst key = Object.keys(buff)[0];\n\t\t\tdecodeText(buff[key]).then((text) => {\n        const loadData = csvParse(text, csvcast);\n\t\t\t\tsetData(loadData);\n\t\t\t});\n\t\t};\n    fetchData(DATA_URL);  \n    \n  }, []);\n\n  //resize\n  useEffect(() => {\n    window.addEventListener(\"resize\", getMapsize);\n    return () => window.removeEventListener(\"resize\", getMapsize);\n  }, []);\n\n  return (\n    <>\n      <div id=\"header\">\n        <AppBar position=\"static\">\n          <Toolbar>\n            <Typography variant=\"h6\">医療提供体制の状況</Typography>\n          </Toolbar>\n        </AppBar>\n        <CheckBoxs value ={selectedCheckbox} changeCheckbox={setSelectedCheckbox} />\n      </div>\n      <div id=\"panel\"></div>\n      <div id=\"map\" ref={mapRef}>\n        <MapGL\n          style={{}}\n          {...viewport}\n          mapStyle={\"mapbox://styles/mapbox/streets-v11\"}\n          mapboxApiAccessToken={MAPBOX_TOKEN}\n          onViewportChange={v => setViewport(v)}\n        >\n          <DeckGL\n            layers={layers({\n              data,\n              layerType:selectLayerType\n            })}\n            controller={{ type: MapController, dragRotate: false }}\n            initialViewState={viewport}\n            controller={true}\n          />\n        </MapGL>\n\n      </div>\n\n      <div id=\"bottom\" ref={bbtnRef}>\n        <BottomBtn value={selectLayerType} onChange={setSelectLayerType} />\n      </div>\n    </>\n  );\n}\n\nexport default App;\n\n/*\n \n\n        */\n"]},"metadata":{},"sourceType":"module"}