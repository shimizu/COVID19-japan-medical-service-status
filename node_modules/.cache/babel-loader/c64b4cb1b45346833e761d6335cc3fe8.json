{"ast":null,"code":"var _jsxFileName = \"/Users/idg08/Desktop/works/hospital/src/App.js\";\nimport React, { useEffect, useState, useRef } from \"react\";\nimport AppBar from \"@material-ui/core/AppBar\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Typography from \"@material-ui/core/Typography\";\nimport MapGL from \"react-map-gl\";\nimport DeckGL, { MapController } from \"deck.gl\";\nimport layers from \"./components/Layers\";\nimport CheckBoxs from \"./components/CheckBoxs\";\nimport BottomBtn from \"./components/BottomBtn\";\nimport SimpleModal from \"./components/modal\";\nimport { parse, fetchFile } from '@loaders.gl/core';\nimport { ZipLoader } from '@loaders.gl/zip';\nimport decodeText from './components/DecodeText.js';\nimport { csvParse } from 'd3-dsv';\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper'; //mapboxのトークンは自分で取得したものに変更してください。\n//このトークンは突然使えなくなる可能性があります。\n\nconst MAPBOX_TOKEN = \"pk.eyJ1Ijoic2hpbWl6dSIsImEiOiJjam95MDBhamYxMjA1M2tyemk2aHMwenp5In0.i2kMIJulhyPLwp3jiLlpsA\";\nconst DATA_URL = \"data/covid-19_daily_survey.zip\";\nconst data_order = {\n  \"通常\": 3,\n  \"制限\": 2,\n  \"停止\": 1,\n  \"設置なし\": 4,\n  \"未回答\": 5\n};\nconst tableFontColor = {\n  \"通常\": \"#17bebb\",\n  \"制限\": \"#FFA500\",\n  \"停止\": \"#d62246\",\n  \"設置なし\": \"#c0c0c0\",\n  \"未回答\": \"#898989\"\n}; //data convert fnction\n\nconst csvcast = (d, i) => {\n  d.id = d.code;\n  Object.keys(d).forEach(key => {\n    if (!isNaN(+d[key]) && key !== 'id') d[key] = +d[key];\n  });\n  return d;\n};\n\nconst tableStyles = makeStyles({\n  table: {\n    maxHeight: 400,\n    overflow: \"auto\",\n    \"& th\": {\n      fontWeight: \"bold\",\n      whiteSpace: \"nowrap\"\n    },\n    \"& td\": {\n      whiteSpace: \"nowrap\"\n    }\n  }\n});\n\nfunction App() {\n  const mapRef = useRef(null);\n  const bbtnRef = useRef(null);\n  const tableClass = tableStyles();\n  const [data, setData] = useState(null);\n  const [cursor, setCursor] = useState(\"move\");\n  const [hospitalState, setHospitalState] = useState({\n    normal: true,\n    restriction: true,\n    stop: true,\n    nobeds: true,\n    unanswered: true\n  });\n  const [layerType, setLayerType] = useState(\"point\");\n  const [viewport, setViewport] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    longitude: 139.0110974,\n    latitude: 36.3226885,\n    zoom: 6,\n    maxZoom: 20\n  });\n  const [modalBody, setModalbody] = useState(null);\n  const [modalOpen, setModalOpen] = React.useState(false);\n\n  const getMapsize = () => {\n    const width = mapRef.current ? mapRef.current.offsetWidth : 0;\n    const height = mapRef.current ? mapRef.current.offsetHeight : 0;\n    const bbtnHeight = bbtnRef.current ? bbtnRef.current.offsetHeight : 0;\n    setViewport(v => {\n      return { ...v,\n        width: width,\n        height: height - bbtnHeight\n      };\n    });\n  }; //ロード時にコンポネーントのwidth,heightを取得\n\n\n  useEffect(getMapsize, []);\n  useEffect(() => {\n    //地価データ取得\n    const fetchData = async url => {\n      const buff = await parse(fetchFile(url), ZipLoader);\n      const key = Object.keys(buff)[0];\n      decodeText(buff[key]).then(text => {\n        const loadData = csvParse(text, csvcast);\n        loadData.sort((a, b) => data_order[b[\"医療区分回答\"]] - data_order[a[\"医療区分回答\"]]);\n        setData(loadData);\n      });\n    };\n\n    fetchData(DATA_URL);\n  }, []); //resize\n\n  useEffect(() => {\n    window.addEventListener(\"resize\", getMapsize);\n    return () => window.removeEventListener(\"resize\", getMapsize);\n  }, []);\n\n  const handlerOnHover = e => {\n    const cur = e.object ? \"pointer\" : \"move\";\n    setCursor(cur);\n  };\n\n  const createTable = data => {\n    console.log(data);\n    const rows = data.map((d, i) => {\n      return {\n        key: i,\n        a: d[\"医療機関名\"],\n        b: d[\"医療区分\"],\n        c: d[\"医療区分回答\"],\n        d: d[\"医療機関住所\"],\n        e: d[\"提出日\"]\n      };\n    });\n    return /*#__PURE__*/React.createElement(TableContainer, {\n      className: tableClass.table,\n      component: Paper,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Table, {\n      size: \"small\",\n      \"aria-label\": \"a dense table\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(TableHead, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(TableRow, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(TableCell, {\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 13\n      }\n    }, \"\\u533B\\u7642\\u6A5F\\u95A2\\u540D\"), /*#__PURE__*/React.createElement(TableCell, {\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 13\n      }\n    }, \"\\u533B\\u7642\\u533A\\u5206\\u56DE\\u7B54\"), /*#__PURE__*/React.createElement(TableCell, {\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 13\n      }\n    }, \"\\u533B\\u7642\\u533A\\u5206\"), /*#__PURE__*/React.createElement(TableCell, {\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 13\n      }\n    }, \"\\u533B\\u7642\\u6A5F\\u95A2\\u4F4F\\u6240\"), /*#__PURE__*/React.createElement(TableCell, {\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 13\n      }\n    }, \"\\u63D0\\u51FA\\u65E5\"))), /*#__PURE__*/React.createElement(TableBody, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 9\n      }\n    }, rows.map(row => /*#__PURE__*/React.createElement(TableRow, {\n      key: row.key,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(TableCell, {\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 17\n      }\n    }, row.a), /*#__PURE__*/React.createElement(TableCell, {\n      style: {\n        fontWeight: \"bold\",\n        color: tableFontColor[row.c]\n      },\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }\n    }, row.c), /*#__PURE__*/React.createElement(TableCell, {\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 17\n      }\n    }, row.b), /*#__PURE__*/React.createElement(TableCell, {\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 17\n      }\n    }, row.d), /*#__PURE__*/React.createElement(TableCell, {\n      align: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 17\n      }\n    }, row.e))))));\n  };\n\n  const handlerOnClickLayer = e => {\n    const data = e.object.points || [e.object];\n    if (!data) return;\n    const body = createTable(data);\n    setModalbody(body);\n    setModalOpen(true);\n  };\n\n  const handlerOnColse = () => {\n    setModalOpen(false);\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(AppBar, {\n    position: \"static\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Toolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 13\n    }\n  }, \"\\u533B\\u7642\\u63D0\\u4F9B\\u4F53\\u5236\\u306E\\u72B6\\u6CC1\"))), /*#__PURE__*/React.createElement(CheckBoxs, {\n    value: hospitalState,\n    onChange: setHospitalState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(SimpleModal, {\n    body: modalBody,\n    open: modalOpen,\n    onClose: handlerOnColse,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"panel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"map\",\n    ref: mapRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(MapGL, Object.assign({\n    style: {}\n  }, viewport, {\n    mapStyle: \"mapbox://styles/mapbox/streets-v11\",\n    mapboxApiAccessToken: MAPBOX_TOKEN,\n    onViewportChange: v => setViewport(v),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(DeckGL, {\n    getCursor: () => cursor,\n    layers: layers({\n      data,\n      layerType: layerType,\n      hospitalState: hospitalState,\n      onHover: handlerOnHover,\n      onClick: handlerOnClickLayer\n    }),\n    controller: {\n      type: MapController,\n      dragRotate: false\n    },\n    initialViewState: viewport,\n    controller: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"bottom\",\n    ref: bbtnRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(BottomBtn, {\n    value: layerType,\n    onChange: setLayerType,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 9\n    }\n  })));\n}\n\nexport default App;\n/*\n \n\n        */","map":{"version":3,"sources":["/Users/idg08/Desktop/works/hospital/src/App.js"],"names":["React","useEffect","useState","useRef","AppBar","Toolbar","Typography","MapGL","DeckGL","MapController","layers","CheckBoxs","BottomBtn","SimpleModal","parse","fetchFile","ZipLoader","decodeText","csvParse","makeStyles","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Paper","MAPBOX_TOKEN","DATA_URL","data_order","tableFontColor","csvcast","d","i","id","code","Object","keys","forEach","key","isNaN","tableStyles","table","maxHeight","overflow","fontWeight","whiteSpace","App","mapRef","bbtnRef","tableClass","data","setData","cursor","setCursor","hospitalState","setHospitalState","normal","restriction","stop","nobeds","unanswered","layerType","setLayerType","viewport","setViewport","width","window","innerWidth","height","innerHeight","longitude","latitude","zoom","maxZoom","modalBody","setModalbody","modalOpen","setModalOpen","getMapsize","current","offsetWidth","offsetHeight","bbtnHeight","v","fetchData","url","buff","then","text","loadData","sort","a","b","addEventListener","removeEventListener","handlerOnHover","e","cur","object","createTable","console","log","rows","map","c","row","color","handlerOnClickLayer","points","body","handlerOnColse","onHover","onClick","type","dragRotate"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport AppBar from \"@material-ui/core/AppBar\";\n\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Typography from \"@material-ui/core/Typography\";\n\nimport MapGL from \"react-map-gl\";\nimport DeckGL, { MapController } from \"deck.gl\";\nimport layers from \"./components/Layers\";\n\n\nimport CheckBoxs from \"./components/CheckBoxs\";\nimport BottomBtn from \"./components/BottomBtn\";\nimport SimpleModal from \"./components/modal\";\n\n\nimport { parse, fetchFile } from '@loaders.gl/core';\nimport { ZipLoader } from '@loaders.gl/zip';\nimport decodeText from './components/DecodeText.js';\nimport { csvParse } from 'd3-dsv';\n\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\n\n//mapboxのトークンは自分で取得したものに変更してください。\n//このトークンは突然使えなくなる可能性があります。\nconst MAPBOX_TOKEN =\n  \"pk.eyJ1Ijoic2hpbWl6dSIsImEiOiJjam95MDBhamYxMjA1M2tyemk2aHMwenp5In0.i2kMIJulhyPLwp3jiLlpsA\";\n\n  const DATA_URL = \"data/covid-19_daily_survey.zip\";\n\n  const data_order = {\n    \"通常\":3,\n    \"制限\":2,\n    \"停止\":1,\n    \"設置なし\":4,\n    \"未回答\":5,\n}\nconst tableFontColor = {\n  \"通常\": \"#17bebb\",\n  \"制限\":\"#FFA500\",\n  \"停止\":\"#d62246\",\n  \"設置なし\":\"#c0c0c0\",\n  \"未回答\":\"#898989\",\n}\n\n\n//data convert fnction\nconst  csvcast = (d, i) => {\n\td.id = d.code;\n\tObject.keys(d).forEach((key) => {\n\t\tif (!isNaN(+d[key]) && key !== 'id') d[key] = +d[key];\n\t});\n\treturn d;\n}\n\nconst tableStyles = makeStyles({\n  table: {\n    maxHeight:400,\n    overflow:\"auto\",\n    \"& th\": {\n      fontWeight:\"bold\",\n      whiteSpace:\"nowrap\",\n    },\n    \"& td\": {\n      whiteSpace:\"nowrap\",\n    }            \n  },\n});\n\n\nfunction App() {\n  const mapRef = useRef(null);\n  const bbtnRef = useRef(null);\n\n\n  const tableClass = tableStyles();\n\n  const [data, setData] = useState(null);\n\n  const [cursor, setCursor] = useState(\"move\");\n\n  const [hospitalState, setHospitalState]  = useState({\n    normal: true,\n    restriction: true,\n    stop: true,\n    nobeds: true,\n    unanswered: true\n  });\n\n  const [layerType, setLayerType]  = useState(\"point\");\n\n  const [viewport, setViewport] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    longitude: 139.0110974,\n    latitude: 36.3226885,\n    zoom: 6,\n    maxZoom: 20\n  });\n\n  const [modalBody, setModalbody]  = useState(null);\n  const [modalOpen, setModalOpen] = React.useState(false);\n\n  const getMapsize = () => {\n    const width = mapRef.current ? mapRef.current.offsetWidth : 0;\n    const height = mapRef.current ? mapRef.current.offsetHeight : 0;\n    const bbtnHeight = bbtnRef.current ? bbtnRef.current.offsetHeight : 0;\n\n    setViewport(v => {\n      return {\n        ...v,\n        width: width,\n        height: height - bbtnHeight\n      };\n    });\n  };\n\n  //ロード時にコンポネーントのwidth,heightを取得\n  useEffect(getMapsize, []);\n\n useEffect(()=>{\n\t\t//地価データ取得\n\t\tconst fetchData = async (url) => {\n\t\t\tconst buff = await parse(fetchFile(url), ZipLoader);\n\t\t\tconst key = Object.keys(buff)[0];\n\t\t\tdecodeText(buff[key]).then((text) => {\n        const loadData = csvParse(text, csvcast);\n        loadData.sort((a,b)=> data_order[b[\"医療区分回答\"]] - data_order[a[\"医療区分回答\"]]);\n\t\t\t\tsetData(loadData);\n\t\t\t});\n\t\t};\n    fetchData(DATA_URL);  \n    \n  }, []);\n\n  //resize\n  useEffect(() => {\n    window.addEventListener(\"resize\", getMapsize);\n    return () => window.removeEventListener(\"resize\", getMapsize);\n  }, []);\n\n  const handlerOnHover = (e) => {\n    const cur = (e.object) ? \"pointer\" : \"move\";\n    setCursor(cur);\n  }\n\n  const createTable = (data) => {\n    console.log(data);\n    const rows = data.map((d,i) => {\n      return {key:i, a:d[\"医療機関名\"], b:d[\"医療区分\"], c:d[\"医療区分回答\"], d:d[\"医療機関住所\"], e:d[\"提出日\"]}\n    });\n\n    return (\n      <TableContainer  className={tableClass.table} component={Paper}>\n        <Table size=\"small\" aria-label=\"a dense table\">\n        <TableHead>\n          <TableRow>\n            <TableCell align=\"left\">医療機関名</TableCell>\n            <TableCell align=\"left\">医療区分回答</TableCell>\n            <TableCell align=\"left\">医療区分</TableCell>\n            <TableCell align=\"left\">医療機関住所</TableCell>\n            <TableCell align=\"left\">提出日</TableCell>\n          </TableRow>\n        </TableHead>          \n        <TableBody>\n            {rows.map((row) => (\n            <TableRow key={row.key}>\n                <TableCell align=\"left\">{row.a}</TableCell>\n                <TableCell style={{fontWeight:\"bold\", color:tableFontColor[row.c]}} align=\"left\">{row.c}</TableCell>\n                <TableCell align=\"left\">{row.b}</TableCell>\n                <TableCell align=\"left\">{row.d}</TableCell>\n                <TableCell align=\"left\">{row.e}</TableCell>\n            </TableRow>\n            ))}\n        </TableBody>\n        </Table>\n        </TableContainer>\n      )\n\n  }\n\n  const handlerOnClickLayer = (e) => {\n    const data = e.object.points || [e.object] ; \n    if(!data) return ;\n    const body = createTable(data);\n    setModalbody(body);\n    setModalOpen(true)\n  }\n  \n  const handlerOnColse = ()=> {\n    setModalOpen(false)\n  }\n\n  return (\n    <>\n      <div id=\"header\">\n        <AppBar position=\"static\">\n          <Toolbar>\n            <Typography variant=\"h6\">医療提供体制の状況</Typography>\n          </Toolbar>\n        </AppBar>\n        <CheckBoxs value={hospitalState} onChange={setHospitalState} />\n        <SimpleModal body={modalBody} open={modalOpen} onClose={handlerOnColse}/>\n      </div>\n      <div id=\"panel\"></div>\n      <div id=\"map\" ref={mapRef}>\n        <MapGL\n          style={{}}\n          {...viewport}\n          mapStyle={\"mapbox://styles/mapbox/streets-v11\"}\n          mapboxApiAccessToken={MAPBOX_TOKEN}\n          onViewportChange={v => setViewport(v)}\n        >\n          <DeckGL\n          getCursor={() => cursor}\n            layers={layers({\n              data,\n              layerType:layerType,\n              hospitalState:hospitalState,\n              onHover:handlerOnHover,\n              onClick:handlerOnClickLayer\n            })}\n            controller={{ type: MapController, dragRotate: false }}\n            initialViewState={viewport}\n            controller={true}\n          />\n        </MapGL>\n\n      </div>\n\n      <div id=\"bottom\" ref={bbtnRef}>\n        <BottomBtn value={layerType} onChange={setLayerType} />\n      </div>\n    </>\n  );\n}\n\nexport default App;\n\n/*\n \n\n        */\n"]},"metadata":{},"sourceType":"module"}