{"ast":null,"code":"import _regeneratorRuntime from\"/Users/idg08/Desktop/works/COVID19-japan-medical-service-status/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/idg08/Desktop/works/COVID19-japan-medical-service-status/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/idg08/Desktop/works/COVID19-japan-medical-service-status/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/idg08/Desktop/works/COVID19-japan-medical-service-status/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from\"react\";import AppBar from\"@material-ui/core/AppBar\";import Toolbar from\"@material-ui/core/Toolbar\";import Typography from\"@material-ui/core/Typography\";import MapGL from\"react-map-gl\";import DeckGL,{MapController}from\"deck.gl\";import layers from\"./components/Layers\";import CheckBoxs from\"./components/CheckBoxs\";import BottomBtn from\"./components/BottomBtn\";import SimpleModal from\"./components/modal\";import{parse,fetchFile}from'@loaders.gl/core';import{ZipLoader}from'@loaders.gl/zip';import decodeText from'./components/DecodeText.js';import{csvParse}from'd3-dsv';import{makeStyles}from\"@material-ui/core/styles\";import Table from'@material-ui/core/Table';import TableBody from'@material-ui/core/TableBody';import TableCell from'@material-ui/core/TableCell';import TableContainer from'@material-ui/core/TableContainer';import TableHead from'@material-ui/core/TableHead';import TableRow from'@material-ui/core/TableRow';import Paper from'@material-ui/core/Paper';//mapboxのトークンは自分で取得したものに変更してください。\n//このトークンは突然使えなくなる可能性があります。\nvar MAPBOX_TOKEN=\"pk.eyJ1Ijoic2hpbWl6dSIsImEiOiJjam95MDBhamYxMjA1M2tyemk2aHMwenp5In0.i2kMIJulhyPLwp3jiLlpsA\";var DATA_URL=\"data/covid-19_daily_survey.zip\";var data_order={\"通常\":3,\"制限\":2,\"停止\":1,\"設置なし\":4,\"未回答\":5};var tableFontColor={\"通常\":\"#17bebb\",\"制限\":\"#FFA500\",\"停止\":\"#d62246\",\"設置なし\":\"#c0c0c0\",\"未回答\":\"#898989\"};//data convert fnction\nvar csvcast=function csvcast(d,i){d.id=d.code;Object.keys(d).forEach(function(key){if(!isNaN(+d[key])&&key!=='id')d[key]=+d[key];});return d;};var tableStyles=makeStyles({table:{maxHeight:400,overflow:\"auto\",\"& th\":{fontWeight:\"bold\",whiteSpace:\"nowrap\"},\"& td\":{whiteSpace:\"nowrap\"}}});function App(){var mapRef=useRef(null);var bbtnRef=useRef(null);var tableClass=tableStyles();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var _useState3=useState(\"move\"),_useState4=_slicedToArray(_useState3,2),cursor=_useState4[0],setCursor=_useState4[1];var _useState5=useState({normal:true,restriction:true,stop:true,nobeds:true,unanswered:true}),_useState6=_slicedToArray(_useState5,2),hospitalState=_useState6[0],setHospitalState=_useState6[1];var _useState7=useState(\"point\"),_useState8=_slicedToArray(_useState7,2),layerType=_useState8[0],setLayerType=_useState8[1];var _useState9=useState({width:window.innerWidth,height:window.innerHeight,longitude:139.0110974,latitude:36.3226885,zoom:6,maxZoom:20}),_useState10=_slicedToArray(_useState9,2),viewport=_useState10[0],setViewport=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),modalBody=_useState12[0],setModalbody=_useState12[1];var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),modalOpen=_React$useState2[0],setModalOpen=_React$useState2[1];var getMapsize=function getMapsize(){var width=mapRef.current?mapRef.current.offsetWidth:0;var height=mapRef.current?mapRef.current.offsetHeight:0;var bbtnHeight=bbtnRef.current?bbtnRef.current.offsetHeight:0;setViewport(function(v){return _objectSpread(_objectSpread({},v),{},{width:width,height:height-bbtnHeight});});};//ロード時にコンポネーントのwidth,heightを取得\nuseEffect(getMapsize,[]);useEffect(function(){//地価データ取得\nvar fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){var buff,key;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return parse(fetchFile(url),ZipLoader);case 2:buff=_context.sent;key=Object.keys(buff)[0];decodeText(buff[key]).then(function(text){var loadData=csvParse(text,csvcast);loadData.sort(function(a,b){return data_order[b[\"医療区分回答\"]]-data_order[a[\"医療区分回答\"]];});setData(loadData);});case 5:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(_x){return _ref.apply(this,arguments);};}();fetchData(DATA_URL);},[]);//resize\nuseEffect(function(){window.addEventListener(\"resize\",getMapsize);return function(){return window.removeEventListener(\"resize\",getMapsize);};},[]);var handlerOnHover=function handlerOnHover(e){var cur=e.object?\"pointer\":\"move\";setCursor(cur);};var createTable=function createTable(data){var rows=data.sort(function(a,b){return a[\"医療機関ID\"]-b[\"医療機関ID\"];}).map(function(d,i){return{key:i,a:d[\"医療機関名\"],b:d[\"医療区分\"],c:d[\"医療区分回答\"],d:d[\"医療機関住所\"],e:d[\"提出日\"]};});return/*#__PURE__*/React.createElement(TableContainer,{className:tableClass.table,component:Paper},/*#__PURE__*/React.createElement(Table,{size:\"small\",\"aria-label\":\"a dense table\"},/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{align:\"left\"},\"\\u533B\\u7642\\u6A5F\\u95A2\\u540D\"),/*#__PURE__*/React.createElement(TableCell,{align:\"left\"},\"\\u533B\\u7642\\u533A\\u5206\\u56DE\\u7B54\"),/*#__PURE__*/React.createElement(TableCell,{align:\"left\"},\"\\u533B\\u7642\\u533A\\u5206\"),/*#__PURE__*/React.createElement(TableCell,{align:\"left\"},\"\\u533B\\u7642\\u6A5F\\u95A2\\u4F4F\\u6240\"),/*#__PURE__*/React.createElement(TableCell,{align:\"left\"},\"\\u63D0\\u51FA\\u65E5\"))),/*#__PURE__*/React.createElement(TableBody,null,rows.map(function(row){return/*#__PURE__*/React.createElement(TableRow,{key:row.key},/*#__PURE__*/React.createElement(TableCell,{align:\"left\"},row.a),/*#__PURE__*/React.createElement(TableCell,{style:{fontWeight:\"bold\",color:tableFontColor[row.c]},align:\"left\"},row.c),/*#__PURE__*/React.createElement(TableCell,{align:\"left\"},row.b),/*#__PURE__*/React.createElement(TableCell,{align:\"left\"},row.d),/*#__PURE__*/React.createElement(TableCell,{align:\"left\"},row.e));}))));};var handlerOnClickLayer=function handlerOnClickLayer(e){var data=e.object.points||[e.object];if(!data)return;var body=createTable(data);setModalbody(body);setModalOpen(true);};var handlerOnColse=function handlerOnColse(){setModalOpen(false);};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{id:\"header\"},/*#__PURE__*/React.createElement(AppBar,{position:\"static\"},/*#__PURE__*/React.createElement(Toolbar,null,/*#__PURE__*/React.createElement(Typography,{variant:\"h6\"},\"\\u533B\\u7642\\u63D0\\u4F9B\\u4F53\\u5236\\u306E\\u72B6\\u6CC1(2020/5/15\\u6642\\u70B9)\"))),/*#__PURE__*/React.createElement(CheckBoxs,{value:hospitalState,onChange:setHospitalState}),/*#__PURE__*/React.createElement(SimpleModal,{body:modalBody,open:modalOpen,onClose:handlerOnColse})),/*#__PURE__*/React.createElement(\"div\",{id:\"panel\"}),/*#__PURE__*/React.createElement(\"div\",{id:\"map\",ref:mapRef},/*#__PURE__*/React.createElement(MapGL,Object.assign({style:{}},viewport,{mapStyle:\"mapbox://styles/mapbox/light-v10\",mapboxApiAccessToken:MAPBOX_TOKEN,onViewportChange:function onViewportChange(v){return setViewport(v);}}),/*#__PURE__*/React.createElement(DeckGL,{getCursor:function getCursor(){return cursor;},layers:layers({data:data,layerType:layerType,hospitalState:hospitalState,onHover:handlerOnHover,onClick:handlerOnClickLayer}),controller:{type:MapController,dragRotate:false},initialViewState:viewport}))),/*#__PURE__*/React.createElement(\"div\",{id:\"bottom\",ref:bbtnRef},/*#__PURE__*/React.createElement(BottomBtn,{value:layerType,onChange:setLayerType})));}export default App;/*\n \n\n        */","map":{"version":3,"sources":["/Users/idg08/Desktop/works/COVID19-japan-medical-service-status/src/App.js"],"names":["React","useEffect","useState","useRef","AppBar","Toolbar","Typography","MapGL","DeckGL","MapController","layers","CheckBoxs","BottomBtn","SimpleModal","parse","fetchFile","ZipLoader","decodeText","csvParse","makeStyles","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Paper","MAPBOX_TOKEN","DATA_URL","data_order","tableFontColor","csvcast","d","i","id","code","Object","keys","forEach","key","isNaN","tableStyles","table","maxHeight","overflow","fontWeight","whiteSpace","App","mapRef","bbtnRef","tableClass","data","setData","cursor","setCursor","normal","restriction","stop","nobeds","unanswered","hospitalState","setHospitalState","layerType","setLayerType","width","window","innerWidth","height","innerHeight","longitude","latitude","zoom","maxZoom","viewport","setViewport","modalBody","setModalbody","modalOpen","setModalOpen","getMapsize","current","offsetWidth","offsetHeight","bbtnHeight","v","fetchData","url","buff","then","text","loadData","sort","a","b","addEventListener","removeEventListener","handlerOnHover","e","cur","object","createTable","rows","map","c","row","color","handlerOnClickLayer","points","body","handlerOnColse","onHover","onClick","type","dragRotate"],"mappings":"otBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,CAAqCC,MAArC,KAAmD,OAAnD,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CAEA,MAAOC,CAAAA,OAAP,KAAoB,2BAApB,CACA,MAAOC,CAAAA,UAAP,KAAuB,8BAAvB,CAEA,MAAOC,CAAAA,KAAP,KAAkB,cAAlB,CACA,MAAOC,CAAAA,MAAP,EAAiBC,aAAjB,KAAsC,SAAtC,CACA,MAAOC,CAAAA,MAAP,KAAmB,qBAAnB,CAGA,MAAOC,CAAAA,SAAP,KAAsB,wBAAtB,CACA,MAAOC,CAAAA,SAAP,KAAsB,wBAAtB,CACA,MAAOC,CAAAA,WAAP,KAAwB,oBAAxB,CAGA,OAASC,KAAT,CAAgBC,SAAhB,KAAiC,kBAAjC,CACA,OAASC,SAAT,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,UAAP,KAAuB,4BAAvB,CACA,OAASC,QAAT,KAAyB,QAAzB,CAEA,OAASC,UAAT,KAA2B,0BAA3B,CACA,MAAOC,CAAAA,KAAP,KAAkB,yBAAlB,CACA,MAAOC,CAAAA,SAAP,KAAsB,6BAAtB,CACA,MAAOC,CAAAA,SAAP,KAAsB,6BAAtB,CACA,MAAOC,CAAAA,cAAP,KAA2B,kCAA3B,CACA,MAAOC,CAAAA,SAAP,KAAsB,6BAAtB,CACA,MAAOC,CAAAA,QAAP,KAAqB,4BAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,yBAAlB,CAEA;AACA;AACA,GAAMC,CAAAA,YAAY,CAChB,2FADF,CAGE,GAAMC,CAAAA,QAAQ,CAAG,gCAAjB,CAEA,GAAMC,CAAAA,UAAU,CAAG,CACjB,KAAK,CADY,CAEjB,KAAK,CAFY,CAGjB,KAAK,CAHY,CAIjB,OAAO,CAJU,CAKjB,MAAM,CALW,CAAnB,CAOF,GAAMC,CAAAA,cAAc,CAAG,CACrB,KAAM,SADe,CAErB,KAAK,SAFgB,CAGrB,KAAK,SAHgB,CAIrB,OAAO,SAJc,CAKrB,MAAM,SALe,CAAvB,CASA;AACA,GAAOC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACC,CAAD,CAAIC,CAAJ,CAAU,CAC1BD,CAAC,CAACE,EAAF,CAAOF,CAAC,CAACG,IAAT,CACAC,MAAM,CAACC,IAAP,CAAYL,CAAZ,EAAeM,OAAf,CAAuB,SAACC,GAAD,CAAS,CAC/B,GAAI,CAACC,KAAK,CAAC,CAACR,CAAC,CAACO,GAAD,CAAH,CAAN,EAAmBA,GAAG,GAAK,IAA/B,CAAqCP,CAAC,CAACO,GAAD,CAAD,CAAS,CAACP,CAAC,CAACO,GAAD,CAAX,CACrC,CAFD,EAGA,MAAOP,CAAAA,CAAP,CACA,CAND,CAQA,GAAMS,CAAAA,WAAW,CAAGtB,UAAU,CAAC,CAC7BuB,KAAK,CAAE,CACLC,SAAS,CAAC,GADL,CAELC,QAAQ,CAAC,MAFJ,CAGL,OAAQ,CACNC,UAAU,CAAC,MADL,CAENC,UAAU,CAAC,QAFL,CAHH,CAOL,OAAQ,CACNA,UAAU,CAAC,QADL,CAPH,CADsB,CAAD,CAA9B,CAeA,QAASC,CAAAA,GAAT,EAAe,CACb,GAAMC,CAAAA,MAAM,CAAG7C,MAAM,CAAC,IAAD,CAArB,CACA,GAAM8C,CAAAA,OAAO,CAAG9C,MAAM,CAAC,IAAD,CAAtB,CAGA,GAAM+C,CAAAA,UAAU,CAAGT,WAAW,EAA9B,CALa,cAOWvC,QAAQ,CAAC,IAAD,CAPnB,wCAONiD,IAPM,eAOAC,OAPA,8BASelD,QAAQ,CAAC,MAAD,CATvB,yCASNmD,MATM,eASEC,SATF,8BAW8BpD,QAAQ,CAAC,CAClDqD,MAAM,CAAE,IAD0C,CAElDC,WAAW,CAAE,IAFqC,CAGlDC,IAAI,CAAE,IAH4C,CAIlDC,MAAM,CAAE,IAJ0C,CAKlDC,UAAU,CAAE,IALsC,CAAD,CAXtC,yCAWNC,aAXM,eAWSC,gBAXT,8BAmBsB3D,QAAQ,CAAC,OAAD,CAnB9B,yCAmBN4D,SAnBM,eAmBKC,YAnBL,8BAqBmB7D,QAAQ,CAAC,CACvC8D,KAAK,CAAEC,MAAM,CAACC,UADyB,CAEvCC,MAAM,CAAEF,MAAM,CAACG,WAFwB,CAGvCC,SAAS,CAAE,WAH4B,CAIvCC,QAAQ,CAAE,UAJ6B,CAKvCC,IAAI,CAAE,CALiC,CAMvCC,OAAO,CAAE,EAN8B,CAAD,CArB3B,0CAqBNC,QArBM,gBAqBIC,WArBJ,gCA8BsBxE,QAAQ,CAAC,IAAD,CA9B9B,2CA8BNyE,SA9BM,gBA8BKC,YA9BL,oCA+BqB5E,KAAK,CAACE,QAAN,CAAe,KAAf,CA/BrB,oDA+BN2E,SA/BM,qBA+BKC,YA/BL,qBAiCb,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACvB,GAAMf,CAAAA,KAAK,CAAGhB,MAAM,CAACgC,OAAP,CAAiBhC,MAAM,CAACgC,OAAP,CAAeC,WAAhC,CAA8C,CAA5D,CACA,GAAMd,CAAAA,MAAM,CAAGnB,MAAM,CAACgC,OAAP,CAAiBhC,MAAM,CAACgC,OAAP,CAAeE,YAAhC,CAA+C,CAA9D,CACA,GAAMC,CAAAA,UAAU,CAAGlC,OAAO,CAAC+B,OAAR,CAAkB/B,OAAO,CAAC+B,OAAR,CAAgBE,YAAlC,CAAiD,CAApE,CAEAR,WAAW,CAAC,SAAAU,CAAC,CAAI,CACf,sCACKA,CADL,MAEEpB,KAAK,CAAEA,KAFT,CAGEG,MAAM,CAAEA,MAAM,CAAGgB,UAHnB,GAKD,CANU,CAAX,CAOD,CAZD,CAcA;AACAlF,SAAS,CAAC8E,UAAD,CAAa,EAAb,CAAT,CAED9E,SAAS,CAAC,UAAI,CACb;AACA,GAAMoF,CAAAA,SAAS,0FAAG,iBAAOC,GAAP,qJACExE,CAAAA,KAAK,CAACC,SAAS,CAACuE,GAAD,CAAV,CAAiBtE,SAAjB,CADP,QACXuE,IADW,eAEXhD,GAFW,CAELH,MAAM,CAACC,IAAP,CAAYkD,IAAZ,EAAkB,CAAlB,CAFK,CAGjBtE,UAAU,CAACsE,IAAI,CAAChD,GAAD,CAAL,CAAV,CAAsBiD,IAAtB,CAA2B,SAACC,IAAD,CAAU,CAChC,GAAMC,CAAAA,QAAQ,CAAGxE,QAAQ,CAACuE,IAAD,CAAO1D,OAAP,CAAzB,CACA2D,QAAQ,CAACC,IAAT,CAAc,SAACC,CAAD,CAAGC,CAAH,QAAQhE,CAAAA,UAAU,CAACgE,CAAC,CAAC,QAAD,CAAF,CAAV,CAA0BhE,UAAU,CAAC+D,CAAC,CAAC,QAAD,CAAF,CAA5C,EAAd,EACJxC,OAAO,CAACsC,QAAD,CAAP,CACA,CAJD,EAHiB,sDAAH,kBAATL,CAAAA,SAAS,4CAAf,CASEA,SAAS,CAACzD,QAAD,CAAT,CAED,CAbO,CAaL,EAbK,CAAT,CAeC;AACA3B,SAAS,CAAC,UAAM,CACdgE,MAAM,CAAC6B,gBAAP,CAAwB,QAAxB,CAAkCf,UAAlC,EACA,MAAO,kBAAMd,CAAAA,MAAM,CAAC8B,mBAAP,CAA2B,QAA3B,CAAqChB,UAArC,CAAN,EAAP,CACD,CAHQ,CAGN,EAHM,CAAT,CAKA,GAAMiB,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,CAAD,CAAO,CAC5B,GAAMC,CAAAA,GAAG,CAAID,CAAC,CAACE,MAAH,CAAa,SAAb,CAAyB,MAArC,CACA7C,SAAS,CAAC4C,GAAD,CAAT,CACD,CAHD,CAKA,GAAME,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACjD,IAAD,CAAU,CAE5B,GAAMkD,CAAAA,IAAI,CAAGlD,IAAI,CAACwC,IAAL,CAAU,SAACC,CAAD,CAAGC,CAAH,QAASD,CAAAA,CAAC,CAAC,QAAD,CAAD,CAAcC,CAAC,CAAC,QAAD,CAAxB,EAAV,EAA8CS,GAA9C,CAAkD,SAACtE,CAAD,CAAGC,CAAH,CAAS,CACtE,MAAO,CAACM,GAAG,CAACN,CAAL,CAAQ2D,CAAC,CAAC5D,CAAC,CAAC,OAAD,CAAX,CAAsB6D,CAAC,CAAC7D,CAAC,CAAC,MAAD,CAAzB,CAAmCuE,CAAC,CAACvE,CAAC,CAAC,QAAD,CAAtC,CAAkDA,CAAC,CAACA,CAAC,CAAC,QAAD,CAArD,CAAiEiE,CAAC,CAACjE,CAAC,CAAC,KAAD,CAApE,CAAP,CACD,CAFY,CAAb,CAIA,mBACE,oBAAC,cAAD,EAAiB,SAAS,CAAEkB,UAAU,CAACR,KAAvC,CAA8C,SAAS,CAAEhB,KAAzD,eACE,oBAAC,KAAD,EAAO,IAAI,CAAC,OAAZ,CAAoB,aAAW,eAA/B,eACA,oBAAC,SAAD,mBACE,oBAAC,QAAD,mBACE,oBAAC,SAAD,EAAW,KAAK,CAAC,MAAjB,mCADF,cAEE,oBAAC,SAAD,EAAW,KAAK,CAAC,MAAjB,yCAFF,cAGE,oBAAC,SAAD,EAAW,KAAK,CAAC,MAAjB,6BAHF,cAIE,oBAAC,SAAD,EAAW,KAAK,CAAC,MAAjB,yCAJF,cAKE,oBAAC,SAAD,EAAW,KAAK,CAAC,MAAjB,uBALF,CADF,CADA,cAUA,oBAAC,SAAD,MACK2E,IAAI,CAACC,GAAL,CAAS,SAACE,GAAD,qBACV,oBAAC,QAAD,EAAU,GAAG,CAAEA,GAAG,CAACjE,GAAnB,eACI,oBAAC,SAAD,EAAW,KAAK,CAAC,MAAjB,EAAyBiE,GAAG,CAACZ,CAA7B,CADJ,cAEI,oBAAC,SAAD,EAAW,KAAK,CAAE,CAAC/C,UAAU,CAAC,MAAZ,CAAoB4D,KAAK,CAAC3E,cAAc,CAAC0E,GAAG,CAACD,CAAL,CAAxC,CAAlB,CAAoE,KAAK,CAAC,MAA1E,EAAkFC,GAAG,CAACD,CAAtF,CAFJ,cAGI,oBAAC,SAAD,EAAW,KAAK,CAAC,MAAjB,EAAyBC,GAAG,CAACX,CAA7B,CAHJ,cAII,oBAAC,SAAD,EAAW,KAAK,CAAC,MAAjB,EAAyBW,GAAG,CAACxE,CAA7B,CAJJ,cAKI,oBAAC,SAAD,EAAW,KAAK,CAAC,MAAjB,EAAyBwE,GAAG,CAACP,CAA7B,CALJ,CADU,EAAT,CADL,CAVA,CADF,CADF,CA2BD,CAjCD,CAmCA,GAAMS,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACT,CAAD,CAAO,CACjC,GAAM9C,CAAAA,IAAI,CAAG8C,CAAC,CAACE,MAAF,CAASQ,MAAT,EAAmB,CAACV,CAAC,CAACE,MAAH,CAAhC,CACA,GAAG,CAAChD,IAAJ,CAAU,OACV,GAAMyD,CAAAA,IAAI,CAAGR,WAAW,CAACjD,IAAD,CAAxB,CACAyB,YAAY,CAACgC,IAAD,CAAZ,CACA9B,YAAY,CAAC,IAAD,CAAZ,CACD,CAND,CAQA,GAAM+B,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAK,CAC1B/B,YAAY,CAAC,KAAD,CAAZ,CACD,CAFD,CAIA,mBACE,qDACE,2BAAK,EAAE,CAAC,QAAR,eACE,oBAAC,MAAD,EAAQ,QAAQ,CAAC,QAAjB,eACE,oBAAC,OAAD,mBACE,oBAAC,UAAD,EAAY,OAAO,CAAC,IAApB,kFADF,CADF,CADF,cAME,oBAAC,SAAD,EAAW,KAAK,CAAElB,aAAlB,CAAiC,QAAQ,CAAEC,gBAA3C,EANF,cAOE,oBAAC,WAAD,EAAa,IAAI,CAAEc,SAAnB,CAA8B,IAAI,CAAEE,SAApC,CAA+C,OAAO,CAAEgC,cAAxD,EAPF,CADF,cAUE,2BAAK,EAAE,CAAC,OAAR,EAVF,cAWE,2BAAK,EAAE,CAAC,KAAR,CAAc,GAAG,CAAE7D,MAAnB,eACE,oBAAC,KAAD,gBACE,KAAK,CAAE,EADT,EAEMyB,QAFN,EAGE,QAAQ,CAAE,kCAHZ,CAIE,oBAAoB,CAAE9C,YAJxB,CAKE,gBAAgB,CAAE,0BAAAyD,CAAC,QAAIV,CAAAA,WAAW,CAACU,CAAD,CAAf,EALrB,gBAOE,oBAAC,MAAD,EACA,SAAS,CAAE,2BAAM/B,CAAAA,MAAN,EADX,CAEE,MAAM,CAAE3C,MAAM,CAAC,CACbyC,IAAI,CAAJA,IADa,CAEbW,SAAS,CAACA,SAFG,CAGbF,aAAa,CAACA,aAHD,CAIbkD,OAAO,CAACd,cAJK,CAKbe,OAAO,CAACL,mBALK,CAAD,CAFhB,CASE,UAAU,CAAE,CAAEM,IAAI,CAAEvG,aAAR,CAAuBwG,UAAU,CAAE,KAAnC,CATd,CAUE,gBAAgB,CAAExC,QAVpB,EAPF,CADF,CAXF,cAmCE,2BAAK,EAAE,CAAC,QAAR,CAAiB,GAAG,CAAExB,OAAtB,eACE,oBAAC,SAAD,EAAW,KAAK,CAAEa,SAAlB,CAA6B,QAAQ,CAAEC,YAAvC,EADF,CAnCF,CADF,CAyCD,CAED,cAAehB,CAAAA,GAAf,CAEA","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport AppBar from \"@material-ui/core/AppBar\";\n\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Typography from \"@material-ui/core/Typography\";\n\nimport MapGL from \"react-map-gl\";\nimport DeckGL, { MapController } from \"deck.gl\";\nimport layers from \"./components/Layers\";\n\n\nimport CheckBoxs from \"./components/CheckBoxs\";\nimport BottomBtn from \"./components/BottomBtn\";\nimport SimpleModal from \"./components/modal\";\n\n\nimport { parse, fetchFile } from '@loaders.gl/core';\nimport { ZipLoader } from '@loaders.gl/zip';\nimport decodeText from './components/DecodeText.js';\nimport { csvParse } from 'd3-dsv';\n\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\n\n//mapboxのトークンは自分で取得したものに変更してください。\n//このトークンは突然使えなくなる可能性があります。\nconst MAPBOX_TOKEN =\n  \"pk.eyJ1Ijoic2hpbWl6dSIsImEiOiJjam95MDBhamYxMjA1M2tyemk2aHMwenp5In0.i2kMIJulhyPLwp3jiLlpsA\";\n\n  const DATA_URL = \"data/covid-19_daily_survey.zip\";\n\n  const data_order = {\n    \"通常\":3,\n    \"制限\":2,\n    \"停止\":1,\n    \"設置なし\":4,\n    \"未回答\":5,\n}\nconst tableFontColor = {\n  \"通常\": \"#17bebb\",\n  \"制限\":\"#FFA500\",\n  \"停止\":\"#d62246\",\n  \"設置なし\":\"#c0c0c0\",\n  \"未回答\":\"#898989\",\n}\n\n\n//data convert fnction\nconst  csvcast = (d, i) => {\n\td.id = d.code;\n\tObject.keys(d).forEach((key) => {\n\t\tif (!isNaN(+d[key]) && key !== 'id') d[key] = +d[key];\n\t});\n\treturn d;\n}\n\nconst tableStyles = makeStyles({\n  table: {\n    maxHeight:400,\n    overflow:\"auto\",\n    \"& th\": {\n      fontWeight:\"bold\",\n      whiteSpace:\"nowrap\",\n    },\n    \"& td\": {\n      whiteSpace:\"nowrap\",\n    }            \n  },\n});\n\n\nfunction App() {\n  const mapRef = useRef(null);\n  const bbtnRef = useRef(null);\n\n\n  const tableClass = tableStyles();\n\n  const [data, setData] = useState(null);\n\n  const [cursor, setCursor] = useState(\"move\");\n\n  const [hospitalState, setHospitalState]  = useState({\n    normal: true,\n    restriction: true,\n    stop: true,\n    nobeds: true,\n    unanswered: true\n  });\n\n  const [layerType, setLayerType]  = useState(\"point\");\n\n  const [viewport, setViewport] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    longitude: 139.0110974,\n    latitude: 36.3226885,\n    zoom: 6,\n    maxZoom: 20\n  });\n\n  const [modalBody, setModalbody]  = useState(null);\n  const [modalOpen, setModalOpen] = React.useState(false);\n\n  const getMapsize = () => {\n    const width = mapRef.current ? mapRef.current.offsetWidth : 0;\n    const height = mapRef.current ? mapRef.current.offsetHeight : 0;\n    const bbtnHeight = bbtnRef.current ? bbtnRef.current.offsetHeight : 0;\n\n    setViewport(v => {\n      return {\n        ...v,\n        width: width,\n        height: height - bbtnHeight\n      };\n    });\n  };\n\n  //ロード時にコンポネーントのwidth,heightを取得\n  useEffect(getMapsize, []);\n\n useEffect(()=>{\n\t\t//地価データ取得\n\t\tconst fetchData = async (url) => {\n\t\t\tconst buff = await parse(fetchFile(url), ZipLoader);\n\t\t\tconst key = Object.keys(buff)[0];\n\t\t\tdecodeText(buff[key]).then((text) => {\n        const loadData = csvParse(text, csvcast);\n        loadData.sort((a,b)=> data_order[b[\"医療区分回答\"]] - data_order[a[\"医療区分回答\"]]);\n\t\t\t\tsetData(loadData);\n\t\t\t});\n\t\t};\n    fetchData(DATA_URL);  \n    \n  }, []);\n\n  //resize\n  useEffect(() => {\n    window.addEventListener(\"resize\", getMapsize);\n    return () => window.removeEventListener(\"resize\", getMapsize);\n  }, []);\n\n  const handlerOnHover = (e) => {\n    const cur = (e.object) ? \"pointer\" : \"move\";\n    setCursor(cur);\n  }\n\n  const createTable = (data) => {\n    \n    const rows = data.sort((a,b) => a[\"医療機関ID\"] - b[\"医療機関ID\"]).map((d,i) => {\n      return {key:i, a:d[\"医療機関名\"], b:d[\"医療区分\"], c:d[\"医療区分回答\"], d:d[\"医療機関住所\"], e:d[\"提出日\"]}\n    });\n\n    return (\n      <TableContainer  className={tableClass.table} component={Paper}>\n        <Table size=\"small\" aria-label=\"a dense table\">\n        <TableHead>\n          <TableRow>\n            <TableCell align=\"left\">医療機関名</TableCell>\n            <TableCell align=\"left\">医療区分回答</TableCell>\n            <TableCell align=\"left\">医療区分</TableCell>\n            <TableCell align=\"left\">医療機関住所</TableCell>\n            <TableCell align=\"left\">提出日</TableCell>\n          </TableRow>\n        </TableHead>          \n        <TableBody>\n            {rows.map((row) => (\n            <TableRow key={row.key}>\n                <TableCell align=\"left\">{row.a}</TableCell>\n                <TableCell style={{fontWeight:\"bold\", color:tableFontColor[row.c]}} align=\"left\">{row.c}</TableCell>\n                <TableCell align=\"left\">{row.b}</TableCell>\n                <TableCell align=\"left\">{row.d}</TableCell>\n                <TableCell align=\"left\">{row.e}</TableCell>\n            </TableRow>\n            ))}\n        </TableBody>\n        </Table>\n        </TableContainer>\n      )\n\n  }\n\n  const handlerOnClickLayer = (e) => {\n    const data = e.object.points || [e.object] ; \n    if(!data) return ;\n    const body = createTable(data);\n    setModalbody(body);\n    setModalOpen(true)\n  }\n  \n  const handlerOnColse = ()=> {\n    setModalOpen(false)\n  }\n\n  return (\n    <>\n      <div id=\"header\">\n        <AppBar position=\"static\">\n          <Toolbar>\n            <Typography variant=\"h6\">医療提供体制の状況(2020/5/15時点)</Typography>\n          </Toolbar>\n        </AppBar>\n        <CheckBoxs value={hospitalState} onChange={setHospitalState} />\n        <SimpleModal body={modalBody} open={modalOpen} onClose={handlerOnColse}/>\n      </div>\n      <div id=\"panel\"></div>\n      <div id=\"map\" ref={mapRef}>\n        <MapGL\n          style={{}}\n          {...viewport}\n          mapStyle={\"mapbox://styles/mapbox/light-v10\"}\n          mapboxApiAccessToken={MAPBOX_TOKEN}\n          onViewportChange={v => setViewport(v)}\n        >\n          <DeckGL\n          getCursor={() => cursor}\n            layers={layers({\n              data,\n              layerType:layerType,\n              hospitalState:hospitalState,\n              onHover:handlerOnHover,\n              onClick:handlerOnClickLayer\n            })}\n            controller={{ type: MapController, dragRotate: false }}\n            initialViewState={viewport}\n          />\n        </MapGL>\n\n      </div>\n\n      <div id=\"bottom\" ref={bbtnRef}>\n        <BottomBtn value={layerType} onChange={setLayerType} />\n      </div>\n    </>\n  );\n}\n\nexport default App;\n\n/*\n \n\n        */\n"]},"metadata":{},"sourceType":"module"}