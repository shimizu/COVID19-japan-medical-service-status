{"version":3,"sources":["../../../../src/lib/table/row-table-batch.js"],"names":["RowTableBatch","schema","batchSize","rows","length","isChunkComplete","Array","isArray","_headers","key","index","name","row","convertRowToObject","slice","data","headers","Error","result","i"],"mappings":";;;IAAqBA,a;AACnB,yBAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAC7B,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,IAAL,GAAY,IAAZ;AACA,SAAKC,MAAL,GAAc,CAAd;AACA,SAAKC,eAAL,GAAuB,KAAvB;;AAIA,QAAI,CAACC,KAAK,CAACC,OAAN,CAAcN,MAAd,CAAL,EAA4B;AAC1B,WAAKO,QAAL,GAAgB,EAAhB;;AACA,WAAK,IAAMC,GAAX,IAAkBR,MAAlB,EAA0B;AACxB,aAAKO,QAAL,CAAcP,MAAM,CAACQ,GAAD,CAAN,CAAYC,KAA1B,IAAmCT,MAAM,CAACQ,GAAD,CAAN,CAAYE,IAA/C;AACD;AACF;AACF;;;;2BAEMC,G,EAAK;AACV,UAAI,CAAC,KAAKT,IAAV,EAAgB;AACd,aAAKA,IAAL,GAAY,IAAIG,KAAJ,CAAU,KAAKJ,SAAf,CAAZ;AACA,aAAKE,MAAL,GAAc,CAAd;AACD;;AACD,WAAKD,IAAL,CAAU,KAAKC,MAAf,IAAyBS,kBAAkB,CAACD,GAAD,EAAM,KAAKJ,QAAX,CAA3C;AACA,WAAKJ,MAAL;AACD;;;oCAEe;AACd,WAAKC,eAAL,GAAuB,IAAvB;AACD;;;6BAEQ;AACP,UAAI,KAAKH,SAAL,KAAmB,MAAvB,EAA+B;AAC7B,eAAO,KAAKG,eAAL,IAAwB,KAAKD,MAAL,GAAc,CAA7C;AACD;;AACD,aAAO,KAAKD,IAAL,IAAa,KAAKC,MAAL,IAAe,KAAKF,SAAxC;AACD;;;yCAEoB;AACnB,UAAI,KAAKC,IAAT,EAAe;AACb,YAAMA,IAAI,GAAG,KAAKA,IAAL,CAAUW,KAAV,CAAgB,CAAhB,EAAmB,KAAKV,MAAxB,CAAb;AACA,aAAKD,IAAL,GAAY,IAAZ;AACA,aAAKE,eAAL,GAAuB,KAAvB;AACA,eAAO;AAACU,UAAAA,IAAI,EAAEZ,IAAP;AAAaF,UAAAA,MAAM,EAAE,KAAKA,MAA1B;AAAkCG,UAAAA,MAAM,EAAED,IAAI,CAACC;AAA/C,SAAP;AACD;;AACD,aAAO,IAAP;AACD;;;;;;SA9CkBJ,a;;AAiDrB,SAASa,kBAAT,CAA4BD,GAA5B,EAAiCI,OAAjC,EAA0C;AACxC,MAAI,CAACJ,GAAL,EAAU;AACR,UAAM,IAAIK,KAAJ,CAAU,UAAV,CAAN;AACD;;AACD,MAAI,CAACX,KAAK,CAACC,OAAN,CAAcK,GAAd,CAAL,EAAyB;AACvB,WAAOA,GAAP;AACD;;AAED,MAAI,CAACI,OAAL,EAAc;AACZ,WAAOJ,GAAP;AACD;;AACD,MAAMM,MAAM,GAAG,EAAf;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,OAAO,CAACZ,MAA5B,EAAoCe,CAAC,EAArC,EAAyC;AACvCD,IAAAA,MAAM,CAACF,OAAO,CAACG,CAAD,CAAR,CAAN,GAAqBP,GAAG,CAACO,CAAD,CAAxB;AACD;;AACD,SAAOD,MAAP;AACD","sourcesContent":["export default class RowTableBatch {\n  constructor(schema, batchSize) {\n    this.schema = schema;\n    this.batchSize = batchSize;\n    this.rows = null;\n    this.length = 0;\n    this.isChunkComplete = false;\n\n    // schema is an array if there're no headers\n    // object if there are headers\n    if (!Array.isArray(schema)) {\n      this._headers = [];\n      for (const key in schema) {\n        this._headers[schema[key].index] = schema[key].name;\n      }\n    }\n  }\n\n  addRow(row) {\n    if (!this.rows) {\n      this.rows = new Array(this.batchSize);\n      this.length = 0;\n    }\n    this.rows[this.length] = convertRowToObject(row, this._headers);\n    this.length++;\n  }\n\n  chunkComplete() {\n    this.isChunkComplete = true;\n  }\n\n  isFull() {\n    if (this.batchSize === 'auto') {\n      return this.isChunkComplete && this.length > 0;\n    }\n    return this.rows && this.length >= this.batchSize;\n  }\n\n  getNormalizedBatch() {\n    if (this.rows) {\n      const rows = this.rows.slice(0, this.length);\n      this.rows = null;\n      this.isChunkComplete = false;\n      return {data: rows, schema: this.schema, length: rows.length};\n    }\n    return null;\n  }\n}\n\nfunction convertRowToObject(row, headers) {\n  if (!row) {\n    throw new Error('null row');\n  }\n  if (!Array.isArray(row)) {\n    return row;\n  }\n\n  if (!headers) {\n    return row;\n  }\n  const result = {};\n  for (let i = 0; i < headers.length; i++) {\n    result[headers[i]] = row[i];\n  }\n  return result;\n}\n"],"file":"row-table-batch.js"}